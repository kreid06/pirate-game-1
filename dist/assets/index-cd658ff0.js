var nt=Object.defineProperty;var ot=(N,d,m)=>d in N?nt(N,d,{enumerable:!0,configurable:!0,writable:!0,value:m}):N[d]=m;var W=(N,d,m)=>(ot(N,typeof d!="symbol"?d+"":d,m),m);(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))A(h);new MutationObserver(h=>{for(const t of h)if(t.type==="childList")for(const a of t.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&A(a)}).observe(document,{childList:!0,subtree:!0});function m(h){const t={};return h.integrity&&(t.integrity=h.integrity),h.referrerPolicy&&(t.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?t.credentials="include":h.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function A(h){if(h.ep)return;h.ep=!0;const t=m(h);fetch(h.href,t)}})();var Z=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function at(N){return N&&N.__esModule&&Object.prototype.hasOwnProperty.call(N,"default")?N.default:N}var tt={exports:{}};/*!
 * matter-js 0.17.1 by @liabru
 * http://brm.io/matter-js/
 * License MIT
 * 
 * The MIT License (MIT)
 * 
 * Copyright (c) Liam Brummitt and contributors.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */(function(N,d){(function(A,h){N.exports=h()})(Z,function(){return function(m){var A={};function h(t){if(A[t])return A[t].exports;var a=A[t]={i:t,l:!1,exports:{}};return m[t].call(a.exports,a,a.exports,h),a.l=!0,a.exports}return h.m=m,h.c=A,h.d=function(t,a,n){h.o(t,a)||Object.defineProperty(t,a,{enumerable:!0,get:n})},h.r=function(t){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},h.t=function(t,a){if(a&1&&(t=h(t)),a&8||a&4&&typeof t=="object"&&t&&t.__esModule)return t;var n=Object.create(null);if(h.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),a&2&&typeof t!="string")for(var s in t)h.d(n,s,(function(c){return t[c]}).bind(null,s));return n},h.n=function(t){var a=t&&t.__esModule?function(){return t.default}:function(){return t};return h.d(a,"a",a),a},h.o=function(t,a){return Object.prototype.hasOwnProperty.call(t,a)},h.p="",h(h.s=22)}([function(m,A){var h={};m.exports=h,function(){h._nextId=0,h._seed=0,h._nowStartTime=+new Date,h._warnedOnce={},h._decomp=null,h.extend=function(a,n){var s,c;typeof n=="boolean"?(s=2,c=n):(s=1,c=!0);for(var r=s;r<arguments.length;r++){var l=arguments[r];if(l)for(var o in l)c&&l[o]&&l[o].constructor===Object&&(!a[o]||a[o].constructor===Object)?(a[o]=a[o]||{},h.extend(a[o],c,l[o])):a[o]=l[o]}return a},h.clone=function(a,n){return h.extend({},n,a)},h.keys=function(a){if(Object.keys)return Object.keys(a);var n=[];for(var s in a)n.push(s);return n},h.values=function(a){var n=[];if(Object.keys){for(var s=Object.keys(a),c=0;c<s.length;c++)n.push(a[s[c]]);return n}for(var r in a)n.push(a[r]);return n},h.get=function(a,n,s,c){n=n.split(".").slice(s,c);for(var r=0;r<n.length;r+=1)a=a[n[r]];return a},h.set=function(a,n,s,c,r){var l=n.split(".").slice(c,r);return h.get(a,n,0,-1)[l[l.length-1]]=s,s},h.shuffle=function(a){for(var n=a.length-1;n>0;n--){var s=Math.floor(h.random()*(n+1)),c=a[n];a[n]=a[s],a[s]=c}return a},h.choose=function(a){return a[Math.floor(h.random()*a.length)]},h.isElement=function(a){return typeof HTMLElement<"u"?a instanceof HTMLElement:!!(a&&a.nodeType&&a.nodeName)},h.isArray=function(a){return Object.prototype.toString.call(a)==="[object Array]"},h.isFunction=function(a){return typeof a=="function"},h.isPlainObject=function(a){return typeof a=="object"&&a.constructor===Object},h.isString=function(a){return toString.call(a)==="[object String]"},h.clamp=function(a,n,s){return a<n?n:a>s?s:a},h.sign=function(a){return a<0?-1:1},h.now=function(){if(typeof window<"u"&&window.performance){if(window.performance.now)return window.performance.now();if(window.performance.webkitNow)return window.performance.webkitNow()}return Date.now?Date.now():new Date-h._nowStartTime},h.random=function(a,n){return a=typeof a<"u"?a:0,n=typeof n<"u"?n:1,a+t()*(n-a)};var t=function(){return h._seed=(h._seed*9301+49297)%233280,h._seed/233280};h.colorToNumber=function(a){return a=a.replace("#",""),a.length==3&&(a=a.charAt(0)+a.charAt(0)+a.charAt(1)+a.charAt(1)+a.charAt(2)+a.charAt(2)),parseInt(a,16)},h.logLevel=1,h.log=function(){console&&h.logLevel>0&&h.logLevel<=3&&console.log.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},h.info=function(){console&&h.logLevel>0&&h.logLevel<=2&&console.info.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},h.warn=function(){console&&h.logLevel>0&&h.logLevel<=3&&console.warn.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},h.warnOnce=function(){var a=Array.prototype.slice.call(arguments).join(" ");h._warnedOnce[a]||(h.warn(a),h._warnedOnce[a]=!0)},h.deprecated=function(a,n,s){a[n]=h.chain(function(){h.warnOnce("🔅 deprecated 🔅",s)},a[n])},h.nextId=function(){return h._nextId++},h.indexOf=function(a,n){if(a.indexOf)return a.indexOf(n);for(var s=0;s<a.length;s++)if(a[s]===n)return s;return-1},h.map=function(a,n){if(a.map)return a.map(n);for(var s=[],c=0;c<a.length;c+=1)s.push(n(a[c]));return s},h.topologicalSort=function(a){var n=[],s=[],c=[];for(var r in a)!s[r]&&!c[r]&&h._topologicalSort(r,s,c,a,n);return n},h._topologicalSort=function(a,n,s,c,r){var l=c[a]||[];s[a]=!0;for(var o=0;o<l.length;o+=1){var e=l[o];s[e]||n[e]||h._topologicalSort(e,n,s,c,r)}s[a]=!1,n[a]=!0,r.push(a)},h.chain=function(){for(var a=[],n=0;n<arguments.length;n+=1){var s=arguments[n];s._chained?a.push.apply(a,s._chained):a.push(s)}var c=function(){for(var r,l=new Array(arguments.length),o=0,e=arguments.length;o<e;o++)l[o]=arguments[o];for(o=0;o<a.length;o+=1){var i=a[o].apply(r,l);typeof i<"u"&&(r=i)}return r};return c._chained=a,c},h.chainPathBefore=function(a,n,s){return h.set(a,n,h.chain(s,h.get(a,n)))},h.chainPathAfter=function(a,n,s){return h.set(a,n,h.chain(h.get(a,n),s))},h.setDecomp=function(a){h._decomp=a},h.getDecomp=function(){var a=h._decomp;try{!a&&typeof window<"u"&&(a=window.decomp),!a&&typeof Z<"u"&&(a=Z.decomp)}catch{a=null}return a}}()},function(m,A){var h={};m.exports=h,function(){h.create=function(t){var a={min:{x:0,y:0},max:{x:0,y:0}};return t&&h.update(a,t),a},h.update=function(t,a,n){t.min.x=1/0,t.max.x=-1/0,t.min.y=1/0,t.max.y=-1/0;for(var s=0;s<a.length;s++){var c=a[s];c.x>t.max.x&&(t.max.x=c.x),c.x<t.min.x&&(t.min.x=c.x),c.y>t.max.y&&(t.max.y=c.y),c.y<t.min.y&&(t.min.y=c.y)}n&&(n.x>0?t.max.x+=n.x:t.min.x+=n.x,n.y>0?t.max.y+=n.y:t.min.y+=n.y)},h.contains=function(t,a){return a.x>=t.min.x&&a.x<=t.max.x&&a.y>=t.min.y&&a.y<=t.max.y},h.overlaps=function(t,a){return t.min.x<=a.max.x&&t.max.x>=a.min.x&&t.max.y>=a.min.y&&t.min.y<=a.max.y},h.translate=function(t,a){t.min.x+=a.x,t.max.x+=a.x,t.min.y+=a.y,t.max.y+=a.y},h.shift=function(t,a){var n=t.max.x-t.min.x,s=t.max.y-t.min.y;t.min.x=a.x,t.max.x=a.x+n,t.min.y=a.y,t.max.y=a.y+s}}()},function(m,A){var h={};m.exports=h,function(){h.create=function(t,a){return{x:t||0,y:a||0}},h.clone=function(t){return{x:t.x,y:t.y}},h.magnitude=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},h.magnitudeSquared=function(t){return t.x*t.x+t.y*t.y},h.rotate=function(t,a,n){var s=Math.cos(a),c=Math.sin(a);n||(n={});var r=t.x*s-t.y*c;return n.y=t.x*c+t.y*s,n.x=r,n},h.rotateAbout=function(t,a,n,s){var c=Math.cos(a),r=Math.sin(a);s||(s={});var l=n.x+((t.x-n.x)*c-(t.y-n.y)*r);return s.y=n.y+((t.x-n.x)*r+(t.y-n.y)*c),s.x=l,s},h.normalise=function(t){var a=h.magnitude(t);return a===0?{x:0,y:0}:{x:t.x/a,y:t.y/a}},h.dot=function(t,a){return t.x*a.x+t.y*a.y},h.cross=function(t,a){return t.x*a.y-t.y*a.x},h.cross3=function(t,a,n){return(a.x-t.x)*(n.y-t.y)-(a.y-t.y)*(n.x-t.x)},h.add=function(t,a,n){return n||(n={}),n.x=t.x+a.x,n.y=t.y+a.y,n},h.sub=function(t,a,n){return n||(n={}),n.x=t.x-a.x,n.y=t.y-a.y,n},h.mult=function(t,a){return{x:t.x*a,y:t.y*a}},h.div=function(t,a){return{x:t.x/a,y:t.y/a}},h.perp=function(t,a){return a=a===!0?-1:1,{x:a*-t.y,y:a*t.x}},h.neg=function(t){return{x:-t.x,y:-t.y}},h.angle=function(t,a){return Math.atan2(a.y-t.y,a.x-t.x)},h._temp=[h.create(),h.create(),h.create(),h.create(),h.create(),h.create()]}()},function(m,A,h){var t={};m.exports=t;var a=h(2),n=h(0);(function(){t.create=function(s,c){for(var r=[],l=0;l<s.length;l++){var o=s[l],e={x:o.x,y:o.y,index:l,body:c,isInternal:!1};r.push(e)}return r},t.fromPath=function(s,c){var r=/L?\s*([-\d.e]+)[\s,]*([-\d.e]+)*/ig,l=[];return s.replace(r,function(o,e,i){l.push({x:parseFloat(e),y:parseFloat(i)})}),t.create(l,c)},t.centre=function(s){for(var c=t.area(s,!0),r={x:0,y:0},l,o,e,i=0;i<s.length;i++)e=(i+1)%s.length,l=a.cross(s[i],s[e]),o=a.mult(a.add(s[i],s[e]),l),r=a.add(r,o);return a.div(r,6*c)},t.mean=function(s){for(var c={x:0,y:0},r=0;r<s.length;r++)c.x+=s[r].x,c.y+=s[r].y;return a.div(c,s.length)},t.area=function(s,c){for(var r=0,l=s.length-1,o=0;o<s.length;o++)r+=(s[l].x-s[o].x)*(s[l].y+s[o].y),l=o;return c?r/2:Math.abs(r)/2},t.inertia=function(s,c){for(var r=0,l=0,o=s,e,i,f=0;f<o.length;f++)i=(f+1)%o.length,e=Math.abs(a.cross(o[i],o[f])),r+=e*(a.dot(o[i],o[i])+a.dot(o[i],o[f])+a.dot(o[f],o[f])),l+=e;return c/6*(r/l)},t.translate=function(s,c,r){var l;if(r)for(l=0;l<s.length;l++)s[l].x+=c.x*r,s[l].y+=c.y*r;else for(l=0;l<s.length;l++)s[l].x+=c.x,s[l].y+=c.y;return s},t.rotate=function(s,c,r){if(c!==0){for(var l=Math.cos(c),o=Math.sin(c),e=0;e<s.length;e++){var i=s[e],f=i.x-r.x,u=i.y-r.y;i.x=r.x+(f*l-u*o),i.y=r.y+(f*o+u*l)}return s}},t.contains=function(s,c){for(var r=0;r<s.length;r++){var l=s[r],o=s[(r+1)%s.length];if((c.x-l.x)*(o.y-l.y)+(c.y-l.y)*(l.x-o.x)>0)return!1}return!0},t.scale=function(s,c,r,l){if(c===1&&r===1)return s;l=l||t.centre(s);for(var o,e,i=0;i<s.length;i++)o=s[i],e=a.sub(o,l),s[i].x=l.x+e.x*c,s[i].y=l.y+e.y*r;return s},t.chamfer=function(s,c,r,l,o){typeof c=="number"?c=[c]:c=c||[8],r=typeof r<"u"?r:-1,l=l||2,o=o||14;for(var e=[],i=0;i<s.length;i++){var f=s[i-1>=0?i-1:s.length-1],u=s[i],g=s[(i+1)%s.length],S=c[i<c.length?i:c.length-1];if(S===0){e.push(u);continue}var w=a.normalise({x:u.y-f.y,y:f.x-u.x}),p=a.normalise({x:g.y-u.y,y:u.x-g.x}),v=Math.sqrt(2*Math.pow(S,2)),x=a.mult(n.clone(w),S),y=a.normalise(a.mult(a.add(w,p),.5)),P=a.sub(u,a.mult(y,v)),C=r;r===-1&&(C=Math.pow(S,.32)*1.75),C=n.clamp(C,l,o),C%2===1&&(C+=1);for(var T=Math.acos(a.dot(w,p)),M=T/C,I=0;I<C;I++)e.push(a.add(a.rotate(x,M*I),P))}return e},t.clockwiseSort=function(s){var c=t.mean(s);return s.sort(function(r,l){return a.angle(c,r)-a.angle(c,l)}),s},t.isConvex=function(s){var c=0,r=s.length,l,o,e,i;if(r<3)return null;for(l=0;l<r;l++)if(o=(l+1)%r,e=(l+2)%r,i=(s[o].x-s[l].x)*(s[e].y-s[o].y),i-=(s[o].y-s[l].y)*(s[e].x-s[o].x),i<0?c|=1:i>0&&(c|=2),c===3)return!1;return c!==0?!0:null},t.hull=function(s){var c=[],r=[],l,o;for(s=s.slice(0),s.sort(function(e,i){var f=e.x-i.x;return f!==0?f:e.y-i.y}),o=0;o<s.length;o+=1){for(l=s[o];r.length>=2&&a.cross3(r[r.length-2],r[r.length-1],l)<=0;)r.pop();r.push(l)}for(o=s.length-1;o>=0;o-=1){for(l=s[o];c.length>=2&&a.cross3(c[c.length-2],c[c.length-1],l)<=0;)c.pop();c.push(l)}return c.pop(),r.pop(),c.concat(r)}})()},function(m,A,h){var t={};m.exports=t;var a=h(0);(function(){t.on=function(n,s,c){for(var r=s.split(" "),l,o=0;o<r.length;o++)l=r[o],n.events=n.events||{},n.events[l]=n.events[l]||[],n.events[l].push(c);return c},t.off=function(n,s,c){if(!s){n.events={};return}typeof s=="function"&&(c=s,s=a.keys(n.events).join(" "));for(var r=s.split(" "),l=0;l<r.length;l++){var o=n.events[r[l]],e=[];if(c&&o)for(var i=0;i<o.length;i++)o[i]!==c&&e.push(o[i]);n.events[r[l]]=e}},t.trigger=function(n,s,c){var r,l,o,e,i=n.events;if(i&&a.keys(i).length>0){c||(c={}),r=s.split(" ");for(var f=0;f<r.length;f++)if(l=r[f],o=i[l],o){e=a.clone(c,!1),e.name=l,e.source=n;for(var u=0;u<o.length;u++)o[u].apply(n,[e])}}}})()},function(m,A,h){var t={};m.exports=t;var a=h(4),n=h(0),s=h(1),c=h(6);(function(){t.create=function(r){return n.extend({id:n.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite",plugin:{}},r)},t.setModified=function(r,l,o,e){if(r.isModified=l,o&&r.parent&&t.setModified(r.parent,l,o,e),e)for(var i=0;i<r.composites.length;i++){var f=r.composites[i];t.setModified(f,l,o,e)}},t.add=function(r,l){var o=[].concat(l);a.trigger(r,"beforeAdd",{object:l});for(var e=0;e<o.length;e++){var i=o[e];switch(i.type){case"body":if(i.parent!==i){n.warn("Composite.add: skipped adding a compound body part (you must add its parent instead)");break}t.addBody(r,i);break;case"constraint":t.addConstraint(r,i);break;case"composite":t.addComposite(r,i);break;case"mouseConstraint":t.addConstraint(r,i.constraint);break}}return a.trigger(r,"afterAdd",{object:l}),r},t.remove=function(r,l,o){var e=[].concat(l);a.trigger(r,"beforeRemove",{object:l});for(var i=0;i<e.length;i++){var f=e[i];switch(f.type){case"body":t.removeBody(r,f,o);break;case"constraint":t.removeConstraint(r,f,o);break;case"composite":t.removeComposite(r,f,o);break;case"mouseConstraint":t.removeConstraint(r,f.constraint);break}}return a.trigger(r,"afterRemove",{object:l}),r},t.addComposite=function(r,l){return r.composites.push(l),l.parent=r,t.setModified(r,!0,!0,!1),r},t.removeComposite=function(r,l,o){var e=n.indexOf(r.composites,l);if(e!==-1&&(t.removeCompositeAt(r,e),t.setModified(r,!0,!0,!1)),o)for(var i=0;i<r.composites.length;i++)t.removeComposite(r.composites[i],l,!0);return r},t.removeCompositeAt=function(r,l){return r.composites.splice(l,1),t.setModified(r,!0,!0,!1),r},t.addBody=function(r,l){return r.bodies.push(l),t.setModified(r,!0,!0,!1),r},t.removeBody=function(r,l,o){var e=n.indexOf(r.bodies,l);if(e!==-1&&(t.removeBodyAt(r,e),t.setModified(r,!0,!0,!1)),o)for(var i=0;i<r.composites.length;i++)t.removeBody(r.composites[i],l,!0);return r},t.removeBodyAt=function(r,l){return r.bodies.splice(l,1),t.setModified(r,!0,!0,!1),r},t.addConstraint=function(r,l){return r.constraints.push(l),t.setModified(r,!0,!0,!1),r},t.removeConstraint=function(r,l,o){var e=n.indexOf(r.constraints,l);if(e!==-1&&t.removeConstraintAt(r,e),o)for(var i=0;i<r.composites.length;i++)t.removeConstraint(r.composites[i],l,!0);return r},t.removeConstraintAt=function(r,l){return r.constraints.splice(l,1),t.setModified(r,!0,!0,!1),r},t.clear=function(r,l,o){if(o)for(var e=0;e<r.composites.length;e++)t.clear(r.composites[e],l,!0);return l?r.bodies=r.bodies.filter(function(i){return i.isStatic}):r.bodies.length=0,r.constraints.length=0,r.composites.length=0,t.setModified(r,!0,!0,!1),r},t.allBodies=function(r){for(var l=[].concat(r.bodies),o=0;o<r.composites.length;o++)l=l.concat(t.allBodies(r.composites[o]));return l},t.allConstraints=function(r){for(var l=[].concat(r.constraints),o=0;o<r.composites.length;o++)l=l.concat(t.allConstraints(r.composites[o]));return l},t.allComposites=function(r){for(var l=[].concat(r.composites),o=0;o<r.composites.length;o++)l=l.concat(t.allComposites(r.composites[o]));return l},t.get=function(r,l,o){var e,i;switch(o){case"body":e=t.allBodies(r);break;case"constraint":e=t.allConstraints(r);break;case"composite":e=t.allComposites(r).concat(r);break}return e?(i=e.filter(function(f){return f.id.toString()===l.toString()}),i.length===0?null:i[0]):null},t.move=function(r,l,o){return t.remove(r,l),t.add(o,l),r},t.rebase=function(r){for(var l=t.allBodies(r).concat(t.allConstraints(r)).concat(t.allComposites(r)),o=0;o<l.length;o++)l[o].id=n.nextId();return t.setModified(r,!0,!0,!1),r},t.translate=function(r,l,o){for(var e=o?t.allBodies(r):r.bodies,i=0;i<e.length;i++)c.translate(e[i],l);return t.setModified(r,!0,!0,!1),r},t.rotate=function(r,l,o,e){for(var i=Math.cos(l),f=Math.sin(l),u=e?t.allBodies(r):r.bodies,g=0;g<u.length;g++){var S=u[g],w=S.position.x-o.x,p=S.position.y-o.y;c.setPosition(S,{x:o.x+(w*i-p*f),y:o.y+(w*f+p*i)}),c.rotate(S,l)}return t.setModified(r,!0,!0,!1),r},t.scale=function(r,l,o,e,i){for(var f=i?t.allBodies(r):r.bodies,u=0;u<f.length;u++){var g=f[u],S=g.position.x-e.x,w=g.position.y-e.y;c.setPosition(g,{x:e.x+S*l,y:e.y+w*o}),c.scale(g,l,o)}return t.setModified(r,!0,!0,!1),r},t.bounds=function(r){for(var l=t.allBodies(r),o=[],e=0;e<l.length;e+=1){var i=l[e];o.push(i.bounds.min,i.bounds.max)}return s.create(o)}})()},function(m,A,h){var t={};m.exports=t;var a=h(3),n=h(2),s=h(7);h(16);var c=h(0),r=h(1),l=h(10);(function(){t._inertiaScale=4,t._nextCollidingGroupId=1,t._nextNonCollidingGroupId=-1,t._nextCategory=1,t.create=function(e){var i={id:c.nextId(),type:"body",label:"Body",parts:[],plugin:{},angle:0,vertices:a.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,opacity:1,strokeStyle:null,fillStyle:null,lineWidth:null,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0}},events:null,bounds:null,chamfer:null,circleRadius:0,positionPrev:null,anglePrev:0,parent:null,axes:null,area:0,mass:0,inertia:0,_original:null},f=c.extend(i,e);return o(f,e),f},t.nextGroup=function(e){return e?t._nextNonCollidingGroupId--:t._nextCollidingGroupId++},t.nextCategory=function(){return t._nextCategory=t._nextCategory<<1,t._nextCategory};var o=function(e,i){i=i||{},t.set(e,{bounds:e.bounds||r.create(e.vertices),positionPrev:e.positionPrev||n.clone(e.position),anglePrev:e.anglePrev||e.angle,vertices:e.vertices,parts:e.parts||[e],isStatic:e.isStatic,isSleeping:e.isSleeping,parent:e.parent||e}),a.rotate(e.vertices,e.angle,e.position),l.rotate(e.axes,e.angle),r.update(e.bounds,e.vertices,e.velocity),t.set(e,{axes:i.axes||e.axes,area:i.area||e.area,mass:i.mass||e.mass,inertia:i.inertia||e.inertia});var f=e.isStatic?"#14151f":c.choose(["#f19648","#f5d259","#f55a3c","#063e7b","#ececd1"]),u=e.isStatic?"#555":"#ccc",g=e.isStatic&&e.render.fillStyle===null?1:0;e.render.fillStyle=e.render.fillStyle||f,e.render.strokeStyle=e.render.strokeStyle||u,e.render.lineWidth=e.render.lineWidth||g,e.render.sprite.xOffset+=-(e.bounds.min.x-e.position.x)/(e.bounds.max.x-e.bounds.min.x),e.render.sprite.yOffset+=-(e.bounds.min.y-e.position.y)/(e.bounds.max.y-e.bounds.min.y)};t.set=function(e,i,f){var u;typeof i=="string"&&(u=i,i={},i[u]=f);for(u in i)if(Object.prototype.hasOwnProperty.call(i,u))switch(f=i[u],u){case"isStatic":t.setStatic(e,f);break;case"isSleeping":s.set(e,f);break;case"mass":t.setMass(e,f);break;case"density":t.setDensity(e,f);break;case"inertia":t.setInertia(e,f);break;case"vertices":t.setVertices(e,f);break;case"position":t.setPosition(e,f);break;case"angle":t.setAngle(e,f);break;case"velocity":t.setVelocity(e,f);break;case"angularVelocity":t.setAngularVelocity(e,f);break;case"parts":t.setParts(e,f);break;case"centre":t.setCentre(e,f);break;default:e[u]=f}},t.setStatic=function(e,i){for(var f=0;f<e.parts.length;f++){var u=e.parts[f];u.isStatic=i,i?(u._original={restitution:u.restitution,friction:u.friction,mass:u.mass,inertia:u.inertia,density:u.density,inverseMass:u.inverseMass,inverseInertia:u.inverseInertia},u.restitution=0,u.friction=1,u.mass=u.inertia=u.density=1/0,u.inverseMass=u.inverseInertia=0,u.positionPrev.x=u.position.x,u.positionPrev.y=u.position.y,u.anglePrev=u.angle,u.angularVelocity=0,u.speed=0,u.angularSpeed=0,u.motion=0):u._original&&(u.restitution=u._original.restitution,u.friction=u._original.friction,u.mass=u._original.mass,u.inertia=u._original.inertia,u.density=u._original.density,u.inverseMass=u._original.inverseMass,u.inverseInertia=u._original.inverseInertia,u._original=null)}},t.setMass=function(e,i){var f=e.inertia/(e.mass/6);e.inertia=f*(i/6),e.inverseInertia=1/e.inertia,e.mass=i,e.inverseMass=1/e.mass,e.density=e.mass/e.area},t.setDensity=function(e,i){t.setMass(e,i*e.area),e.density=i},t.setInertia=function(e,i){e.inertia=i,e.inverseInertia=1/e.inertia},t.setVertices=function(e,i){i[0].body===e?e.vertices=i:e.vertices=a.create(i,e),e.axes=l.fromVertices(e.vertices),e.area=a.area(e.vertices),t.setMass(e,e.density*e.area);var f=a.centre(e.vertices);a.translate(e.vertices,f,-1),t.setInertia(e,t._inertiaScale*a.inertia(e.vertices,e.mass)),a.translate(e.vertices,e.position),r.update(e.bounds,e.vertices,e.velocity)},t.setParts=function(e,i,f){var u;for(i=i.slice(0),e.parts.length=0,e.parts.push(e),e.parent=e,u=0;u<i.length;u++){var g=i[u];g!==e&&(g.parent=e,e.parts.push(g))}if(e.parts.length!==1){if(f=typeof f<"u"?f:!0,f){var S=[];for(u=0;u<i.length;u++)S=S.concat(i[u].vertices);a.clockwiseSort(S);var w=a.hull(S),p=a.centre(w);t.setVertices(e,w),a.translate(e.vertices,p)}var v=t._totalProperties(e);e.area=v.area,e.parent=e,e.position.x=v.centre.x,e.position.y=v.centre.y,e.positionPrev.x=v.centre.x,e.positionPrev.y=v.centre.y,t.setMass(e,v.mass),t.setInertia(e,v.inertia),t.setPosition(e,v.centre)}},t.setCentre=function(e,i,f){f?(e.positionPrev.x+=i.x,e.positionPrev.y+=i.y,e.position.x+=i.x,e.position.y+=i.y):(e.positionPrev.x=i.x-(e.position.x-e.positionPrev.x),e.positionPrev.y=i.y-(e.position.y-e.positionPrev.y),e.position.x=i.x,e.position.y=i.y)},t.setPosition=function(e,i){var f=n.sub(i,e.position);e.positionPrev.x+=f.x,e.positionPrev.y+=f.y;for(var u=0;u<e.parts.length;u++){var g=e.parts[u];g.position.x+=f.x,g.position.y+=f.y,a.translate(g.vertices,f),r.update(g.bounds,g.vertices,e.velocity)}},t.setAngle=function(e,i){var f=i-e.angle;e.anglePrev+=f;for(var u=0;u<e.parts.length;u++){var g=e.parts[u];g.angle+=f,a.rotate(g.vertices,f,e.position),l.rotate(g.axes,f),r.update(g.bounds,g.vertices,e.velocity),u>0&&n.rotateAbout(g.position,f,e.position,g.position)}},t.setVelocity=function(e,i){e.positionPrev.x=e.position.x-i.x,e.positionPrev.y=e.position.y-i.y,e.velocity.x=i.x,e.velocity.y=i.y,e.speed=n.magnitude(e.velocity)},t.setAngularVelocity=function(e,i){e.anglePrev=e.angle-i,e.angularVelocity=i,e.angularSpeed=Math.abs(e.angularVelocity)},t.translate=function(e,i){t.setPosition(e,n.add(e.position,i))},t.rotate=function(e,i,f){if(!f)t.setAngle(e,e.angle+i);else{var u=Math.cos(i),g=Math.sin(i),S=e.position.x-f.x,w=e.position.y-f.y;t.setPosition(e,{x:f.x+(S*u-w*g),y:f.y+(S*g+w*u)}),t.setAngle(e,e.angle+i)}},t.scale=function(e,i,f,u){var g=0,S=0;u=u||e.position;for(var w=0;w<e.parts.length;w++){var p=e.parts[w];a.scale(p.vertices,i,f,u),p.axes=l.fromVertices(p.vertices),p.area=a.area(p.vertices),t.setMass(p,e.density*p.area),a.translate(p.vertices,{x:-p.position.x,y:-p.position.y}),t.setInertia(p,t._inertiaScale*a.inertia(p.vertices,p.mass)),a.translate(p.vertices,{x:p.position.x,y:p.position.y}),w>0&&(g+=p.area,S+=p.inertia),p.position.x=u.x+(p.position.x-u.x)*i,p.position.y=u.y+(p.position.y-u.y)*f,r.update(p.bounds,p.vertices,e.velocity)}e.parts.length>1&&(e.area=g,e.isStatic||(t.setMass(e,e.density*g),t.setInertia(e,S))),e.circleRadius&&(i===f?e.circleRadius*=i:e.circleRadius=null)},t.update=function(e,i,f,u){var g=Math.pow(i*f*e.timeScale,2),S=1-e.frictionAir*f*e.timeScale,w=e.position.x-e.positionPrev.x,p=e.position.y-e.positionPrev.y;e.velocity.x=w*S*u+e.force.x/e.mass*g,e.velocity.y=p*S*u+e.force.y/e.mass*g,e.positionPrev.x=e.position.x,e.positionPrev.y=e.position.y,e.position.x+=e.velocity.x,e.position.y+=e.velocity.y,e.angularVelocity=(e.angle-e.anglePrev)*S*u+e.torque/e.inertia*g,e.anglePrev=e.angle,e.angle+=e.angularVelocity,e.speed=n.magnitude(e.velocity),e.angularSpeed=Math.abs(e.angularVelocity);for(var v=0;v<e.parts.length;v++){var x=e.parts[v];a.translate(x.vertices,e.velocity),v>0&&(x.position.x+=e.velocity.x,x.position.y+=e.velocity.y),e.angularVelocity!==0&&(a.rotate(x.vertices,e.angularVelocity,e.position),l.rotate(x.axes,e.angularVelocity),v>0&&n.rotateAbout(x.position,e.angularVelocity,e.position,x.position)),r.update(x.bounds,x.vertices,e.velocity)}},t.applyForce=function(e,i,f){e.force.x+=f.x,e.force.y+=f.y;var u={x:i.x-e.position.x,y:i.y-e.position.y};e.torque+=u.x*f.y-u.y*f.x},t._totalProperties=function(e){for(var i={mass:0,area:0,inertia:0,centre:{x:0,y:0}},f=e.parts.length===1?0:1;f<e.parts.length;f++){var u=e.parts[f],g=u.mass!==1/0?u.mass:1;i.mass+=g,i.area+=u.area,i.inertia+=u.inertia,i.centre=n.add(i.centre,n.mult(u.position,g))}return i.centre=n.div(i.centre,i.mass),i}})()},function(m,A,h){var t={};m.exports=t;var a=h(4);(function(){t._motionWakeThreshold=.18,t._motionSleepThreshold=.08,t._minBias=.9,t.update=function(n,s){for(var c=s*s*s,r=0;r<n.length;r++){var l=n[r],o=l.speed*l.speed+l.angularSpeed*l.angularSpeed;if(l.force.x!==0||l.force.y!==0){t.set(l,!1);continue}var e=Math.min(l.motion,o),i=Math.max(l.motion,o);l.motion=t._minBias*e+(1-t._minBias)*i,l.sleepThreshold>0&&l.motion<t._motionSleepThreshold*c?(l.sleepCounter+=1,l.sleepCounter>=l.sleepThreshold&&t.set(l,!0)):l.sleepCounter>0&&(l.sleepCounter-=1)}},t.afterCollisions=function(n,s){for(var c=s*s*s,r=0;r<n.length;r++){var l=n[r];if(l.isActive){var o=l.collision,e=o.bodyA.parent,i=o.bodyB.parent;if(!(e.isSleeping&&i.isSleeping||e.isStatic||i.isStatic)&&(e.isSleeping||i.isSleeping)){var f=e.isSleeping&&!e.isStatic?e:i,u=f===e?i:e;!f.isStatic&&u.motion>t._motionWakeThreshold*c&&t.set(f,!1)}}}},t.set=function(n,s){var c=n.isSleeping;s?(n.isSleeping=!0,n.sleepCounter=n.sleepThreshold,n.positionImpulse.x=0,n.positionImpulse.y=0,n.positionPrev.x=n.position.x,n.positionPrev.y=n.position.y,n.anglePrev=n.angle,n.speed=0,n.angularSpeed=0,n.motion=0,c||a.trigger(n,"sleepStart")):(n.isSleeping=!1,n.sleepCounter=0,c&&a.trigger(n,"sleepEnd"))}})()},function(m,A,h){var t={};m.exports=t;var a=h(3),n=h(2),s=h(7),c=h(1),r=h(10),l=h(0);(function(){t._warming=.4,t._torqueDampen=1,t._minLength=1e-6,t.create=function(o){var e=o;e.bodyA&&!e.pointA&&(e.pointA={x:0,y:0}),e.bodyB&&!e.pointB&&(e.pointB={x:0,y:0});var i=e.bodyA?n.add(e.bodyA.position,e.pointA):e.pointA,f=e.bodyB?n.add(e.bodyB.position,e.pointB):e.pointB,u=n.magnitude(n.sub(i,f));e.length=typeof e.length<"u"?e.length:u,e.id=e.id||l.nextId(),e.label=e.label||"Constraint",e.type="constraint",e.stiffness=e.stiffness||(e.length>0?1:.7),e.damping=e.damping||0,e.angularStiffness=e.angularStiffness||0,e.angleA=e.bodyA?e.bodyA.angle:e.angleA,e.angleB=e.bodyB?e.bodyB.angle:e.angleB,e.plugin={};var g={visible:!0,lineWidth:2,strokeStyle:"#ffffff",type:"line",anchors:!0};return e.length===0&&e.stiffness>.1?(g.type="pin",g.anchors=!1):e.stiffness<.9&&(g.type="spring"),e.render=l.extend(g,e.render),e},t.preSolveAll=function(o){for(var e=0;e<o.length;e+=1){var i=o[e],f=i.constraintImpulse;i.isStatic||f.x===0&&f.y===0&&f.angle===0||(i.position.x+=f.x,i.position.y+=f.y,i.angle+=f.angle)}},t.solveAll=function(o,e){for(var i=0;i<o.length;i+=1){var f=o[i],u=!f.bodyA||f.bodyA&&f.bodyA.isStatic,g=!f.bodyB||f.bodyB&&f.bodyB.isStatic;(u||g)&&t.solve(o[i],e)}for(i=0;i<o.length;i+=1)f=o[i],u=!f.bodyA||f.bodyA&&f.bodyA.isStatic,g=!f.bodyB||f.bodyB&&f.bodyB.isStatic,!u&&!g&&t.solve(o[i],e)},t.solve=function(o,e){var i=o.bodyA,f=o.bodyB,u=o.pointA,g=o.pointB;if(!(!i&&!f)){i&&!i.isStatic&&(n.rotate(u,i.angle-o.angleA,u),o.angleA=i.angle),f&&!f.isStatic&&(n.rotate(g,f.angle-o.angleB,g),o.angleB=f.angle);var S=u,w=g;if(i&&(S=n.add(i.position,u)),f&&(w=n.add(f.position,g)),!(!S||!w)){var p=n.sub(S,w),v=n.magnitude(p);v<t._minLength&&(v=t._minLength);var x=(v-o.length)/v,y=o.stiffness<1?o.stiffness*e:o.stiffness,P=n.mult(p,x*y),C=(i?i.inverseMass:0)+(f?f.inverseMass:0),T=(i?i.inverseInertia:0)+(f?f.inverseInertia:0),M=C+T,I,k,B,E,b;if(o.damping){var O=n.create();B=n.div(p,v),b=n.sub(f&&n.sub(f.position,f.positionPrev)||O,i&&n.sub(i.position,i.positionPrev)||O),E=n.dot(B,b)}i&&!i.isStatic&&(k=i.inverseMass/C,i.constraintImpulse.x-=P.x*k,i.constraintImpulse.y-=P.y*k,i.position.x-=P.x*k,i.position.y-=P.y*k,o.damping&&(i.positionPrev.x-=o.damping*B.x*E*k,i.positionPrev.y-=o.damping*B.y*E*k),I=n.cross(u,P)/M*t._torqueDampen*i.inverseInertia*(1-o.angularStiffness),i.constraintImpulse.angle-=I,i.angle-=I),f&&!f.isStatic&&(k=f.inverseMass/C,f.constraintImpulse.x+=P.x*k,f.constraintImpulse.y+=P.y*k,f.position.x+=P.x*k,f.position.y+=P.y*k,o.damping&&(f.positionPrev.x+=o.damping*B.x*E*k,f.positionPrev.y+=o.damping*B.y*E*k),I=n.cross(g,P)/M*t._torqueDampen*f.inverseInertia*(1-o.angularStiffness),f.constraintImpulse.angle+=I,f.angle+=I)}}},t.postSolveAll=function(o){for(var e=0;e<o.length;e++){var i=o[e],f=i.constraintImpulse;if(!(i.isStatic||f.x===0&&f.y===0&&f.angle===0)){s.set(i,!1);for(var u=0;u<i.parts.length;u++){var g=i.parts[u];a.translate(g.vertices,f),u>0&&(g.position.x+=f.x,g.position.y+=f.y),f.angle!==0&&(a.rotate(g.vertices,f.angle,i.position),r.rotate(g.axes,f.angle),u>0&&n.rotateAbout(g.position,f.angle,i.position,g.position)),c.update(g.bounds,g.vertices,i.velocity)}f.angle*=t._warming,f.x*=t._warming,f.y*=t._warming}}},t.pointAWorld=function(o){return{x:(o.bodyA?o.bodyA.position.x:0)+o.pointA.x,y:(o.bodyA?o.bodyA.position.y:0)+o.pointA.y}},t.pointBWorld=function(o){return{x:(o.bodyB?o.bodyB.position.x:0)+o.pointB.x,y:(o.bodyB?o.bodyB.position.y:0)+o.pointB.y}}})()},function(m,A,h){var t={};m.exports=t;var a=h(17);(function(){t.create=function(n,s){var c=n.bodyA,r=n.bodyB,l=n.parentA,o=n.parentB,e={id:t.id(c,r),bodyA:c,bodyB:r,contacts:{},activeContacts:[],separation:0,isActive:!0,confirmedActive:!0,isSensor:c.isSensor||r.isSensor,timeCreated:s,timeUpdated:s,inverseMass:l.inverseMass+o.inverseMass,friction:Math.min(l.friction,o.friction),frictionStatic:Math.max(l.frictionStatic,o.frictionStatic),restitution:Math.max(l.restitution,o.restitution),slop:Math.max(l.slop,o.slop)};return t.update(e,n,s),e},t.update=function(n,s,c){var r=n.contacts,l=s.supports,o=n.activeContacts,e=s.parentA,i=s.parentB;if(n.collision=s,n.inverseMass=e.inverseMass+i.inverseMass,n.friction=Math.min(e.friction,i.friction),n.frictionStatic=Math.max(e.frictionStatic,i.frictionStatic),n.restitution=Math.max(e.restitution,i.restitution),n.slop=Math.max(e.slop,i.slop),o.length=0,s.collided){for(var f=0;f<l.length;f++){var u=l[f],g=a.id(u),S=r[g];S?o.push(S):o.push(r[g]=a.create(u))}n.separation=s.depth,t.setActive(n,!0,c)}else n.isActive===!0&&t.setActive(n,!1,c)},t.setActive=function(n,s,c){s?(n.isActive=!0,n.timeUpdated=c):(n.isActive=!1,n.activeContacts.length=0)},t.id=function(n,s){return n.id<s.id?"A"+n.id+"B"+s.id:"A"+s.id+"B"+n.id}})()},function(m,A,h){var t={};m.exports=t;var a=h(2),n=h(0);(function(){t.fromVertices=function(s){for(var c={},r=0;r<s.length;r++){var l=(r+1)%s.length,o=a.normalise({x:s[l].y-s[r].y,y:s[r].x-s[l].x}),e=o.y===0?1/0:o.x/o.y;e=e.toFixed(3).toString(),c[e]=o}return n.values(c)},t.rotate=function(s,c){if(c!==0)for(var r=Math.cos(c),l=Math.sin(c),o=0;o<s.length;o++){var e=s[o],i;i=e.x*r-e.y*l,e.y=e.x*l+e.y*r,e.x=i}}})()},function(m,A,h){var t={};m.exports=t;var a=h(3),n=h(0),s=h(6),c=h(1),r=h(2);(function(){t.rectangle=function(l,o,e,i,f){f=f||{};var u={label:"Rectangle Body",position:{x:l,y:o},vertices:a.fromPath("L 0 0 L "+e+" 0 L "+e+" "+i+" L 0 "+i)};if(f.chamfer){var g=f.chamfer;u.vertices=a.chamfer(u.vertices,g.radius,g.quality,g.qualityMin,g.qualityMax),delete f.chamfer}return s.create(n.extend({},u,f))},t.trapezoid=function(l,o,e,i,f,u){u=u||{},f*=.5;var g=(1-f*2)*e,S=e*f,w=S+g,p=w+S,v;f<.5?v="L 0 0 L "+S+" "+-i+" L "+w+" "+-i+" L "+p+" 0":v="L 0 0 L "+w+" "+-i+" L "+p+" 0";var x={label:"Trapezoid Body",position:{x:l,y:o},vertices:a.fromPath(v)};if(u.chamfer){var y=u.chamfer;x.vertices=a.chamfer(x.vertices,y.radius,y.quality,y.qualityMin,y.qualityMax),delete u.chamfer}return s.create(n.extend({},x,u))},t.circle=function(l,o,e,i,f){i=i||{};var u={label:"Circle Body",circleRadius:e};f=f||25;var g=Math.ceil(Math.max(10,Math.min(f,e)));return g%2===1&&(g+=1),t.polygon(l,o,g,e,n.extend({},u,i))},t.polygon=function(l,o,e,i,f){if(f=f||{},e<3)return t.circle(l,o,i,f);for(var u=2*Math.PI/e,g="",S=u*.5,w=0;w<e;w+=1){var p=S+w*u,v=Math.cos(p)*i,x=Math.sin(p)*i;g+="L "+v.toFixed(3)+" "+x.toFixed(3)+" "}var y={label:"Polygon Body",position:{x:l,y:o},vertices:a.fromPath(g)};if(f.chamfer){var P=f.chamfer;y.vertices=a.chamfer(y.vertices,P.radius,P.quality,P.qualityMin,P.qualityMax),delete f.chamfer}return s.create(n.extend({},y,f))},t.fromVertices=function(l,o,e,i,f,u,g,S){var w=n.getDecomp(),p,v,x,y,P,C,T,M,I,k,B;for(p=!!(w&&w.quickDecomp),i=i||{},x=[],f=typeof f<"u"?f:!1,u=typeof u<"u"?u:.01,g=typeof g<"u"?g:10,S=typeof S<"u"?S:.01,n.isArray(e[0])||(e=[e]),k=0;k<e.length;k+=1)if(C=e[k],y=a.isConvex(C),P=!y,P&&!p&&n.warnOnce("Bodies.fromVertices: Install the 'poly-decomp' library and use Common.setDecomp or provide 'decomp' as a global to decompose concave vertices."),y||!p)y?C=a.clockwiseSort(C):C=a.hull(C),x.push({position:{x:l,y:o},vertices:C});else{var E=C.map(function(Y){return[Y.x,Y.y]});w.makeCCW(E),u!==!1&&w.removeCollinearPoints(E,u),S!==!1&&w.removeDuplicatePoints&&w.removeDuplicatePoints(E,S);var b=w.quickDecomp(E);for(T=0;T<b.length;T++){var O=b[T],F=O.map(function(Y){return{x:Y[0],y:Y[1]}});g>0&&a.area(F)<g||x.push({position:a.centre(F),vertices:F})}}for(T=0;T<x.length;T++)x[T]=s.create(n.extend(x[T],i));if(f){var z=5;for(T=0;T<x.length;T++){var V=x[T];for(M=T+1;M<x.length;M++){var L=x[M];if(c.overlaps(V.bounds,L.bounds)){var X=V.vertices,H=L.vertices;for(I=0;I<V.vertices.length;I++)for(B=0;B<L.vertices.length;B++){var U=r.magnitudeSquared(r.sub(X[(I+1)%X.length],H[B])),$=r.magnitudeSquared(r.sub(X[I],H[(B+1)%H.length]));U<z&&$<z&&(X[I].isInternal=!0,H[B].isInternal=!0)}}}}}return x.length>1?(v=s.create(n.extend({parts:x.slice(0)},i)),s.setPosition(v,{x:l,y:o}),v):x[0]}})()},function(m,A,h){var t={};m.exports=t;var a=h(0);(function(){t.create=function(n){var s={};return n||a.log("Mouse.create: element was undefined, defaulting to document.body","warn"),s.element=n||document.body,s.absolute={x:0,y:0},s.position={x:0,y:0},s.mousedownPosition={x:0,y:0},s.mouseupPosition={x:0,y:0},s.offset={x:0,y:0},s.scale={x:1,y:1},s.wheelDelta=0,s.button=-1,s.pixelRatio=parseInt(s.element.getAttribute("data-pixel-ratio"),10)||1,s.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null},s.mousemove=function(c){var r=t._getRelativeMousePosition(c,s.element,s.pixelRatio),l=c.changedTouches;l&&(s.button=0,c.preventDefault()),s.absolute.x=r.x,s.absolute.y=r.y,s.position.x=s.absolute.x*s.scale.x+s.offset.x,s.position.y=s.absolute.y*s.scale.y+s.offset.y,s.sourceEvents.mousemove=c},s.mousedown=function(c){var r=t._getRelativeMousePosition(c,s.element,s.pixelRatio),l=c.changedTouches;l?(s.button=0,c.preventDefault()):s.button=c.button,s.absolute.x=r.x,s.absolute.y=r.y,s.position.x=s.absolute.x*s.scale.x+s.offset.x,s.position.y=s.absolute.y*s.scale.y+s.offset.y,s.mousedownPosition.x=s.position.x,s.mousedownPosition.y=s.position.y,s.sourceEvents.mousedown=c},s.mouseup=function(c){var r=t._getRelativeMousePosition(c,s.element,s.pixelRatio),l=c.changedTouches;l&&c.preventDefault(),s.button=-1,s.absolute.x=r.x,s.absolute.y=r.y,s.position.x=s.absolute.x*s.scale.x+s.offset.x,s.position.y=s.absolute.y*s.scale.y+s.offset.y,s.mouseupPosition.x=s.position.x,s.mouseupPosition.y=s.position.y,s.sourceEvents.mouseup=c},s.mousewheel=function(c){s.wheelDelta=Math.max(-1,Math.min(1,c.wheelDelta||-c.detail)),c.preventDefault()},t.setElement(s,s.element),s},t.setElement=function(n,s){n.element=s,s.addEventListener("mousemove",n.mousemove),s.addEventListener("mousedown",n.mousedown),s.addEventListener("mouseup",n.mouseup),s.addEventListener("mousewheel",n.mousewheel),s.addEventListener("DOMMouseScroll",n.mousewheel),s.addEventListener("touchmove",n.mousemove),s.addEventListener("touchstart",n.mousedown),s.addEventListener("touchend",n.mouseup)},t.clearSourceEvents=function(n){n.sourceEvents.mousemove=null,n.sourceEvents.mousedown=null,n.sourceEvents.mouseup=null,n.sourceEvents.mousewheel=null,n.wheelDelta=0},t.setOffset=function(n,s){n.offset.x=s.x,n.offset.y=s.y,n.position.x=n.absolute.x*n.scale.x+n.offset.x,n.position.y=n.absolute.y*n.scale.y+n.offset.y},t.setScale=function(n,s){n.scale.x=s.x,n.scale.y=s.y,n.position.x=n.absolute.x*n.scale.x+n.offset.x,n.position.y=n.absolute.y*n.scale.y+n.offset.y},t._getRelativeMousePosition=function(n,s,c){var r=s.getBoundingClientRect(),l=document.documentElement||document.body.parentNode||document.body,o=window.pageXOffset!==void 0?window.pageXOffset:l.scrollLeft,e=window.pageYOffset!==void 0?window.pageYOffset:l.scrollTop,i=n.changedTouches,f,u;return i?(f=i[0].pageX-r.left-o,u=i[0].pageY-r.top-e):(f=n.pageX-r.left-o,u=n.pageY-r.top-e),{x:f/(s.clientWidth/(s.width||s.clientWidth)*c),y:u/(s.clientHeight/(s.height||s.clientHeight)*c)}}})()},function(m,A,h){var t={};m.exports=t;var a=h(14),n=h(9),s=h(1);(function(){t.collisions=function(c,r){for(var l=[],o=r.pairs.table,e=0;e<c.length;e++){var i=c[e][0],f=c[e][1];if(!((i.isStatic||i.isSleeping)&&(f.isStatic||f.isSleeping))&&t.canCollide(i.collisionFilter,f.collisionFilter)&&s.overlaps(i.bounds,f.bounds))for(var u=i.parts.length>1?1:0;u<i.parts.length;u++)for(var g=i.parts[u],S=f.parts.length>1?1:0;S<f.parts.length;S++){var w=f.parts[S];if(g===i&&w===f||s.overlaps(g.bounds,w.bounds)){var p=n.id(g,w),v=o[p],x;v&&v.isActive?x=v.collision:x=null;var y=a.collides(g,w,x);y.collided&&l.push(y)}}}return l},t.canCollide=function(c,r){return c.group===r.group&&c.group!==0?c.group>0:(c.mask&r.category)!==0&&(r.mask&c.category)!==0}})()},function(m,A,h){var t={};m.exports=t;var a=h(3),n=h(2);(function(){t.collides=function(s,c,r){var l,o,e,i,f=!1;if(r){var u=s.parent,g=c.parent,S=u.speed*u.speed+u.angularSpeed*u.angularSpeed+g.speed*g.speed+g.angularSpeed*g.angularSpeed;f=r&&r.collided&&S<.2,i=r}else i={collided:!1,bodyA:s,bodyB:c};if(r&&f){var w=i.axisBody,p=w===s?c:s,v=[w.axes[r.axisNumber]];if(e=t._overlapAxes(w.vertices,p.vertices,v),i.reused=!0,e.overlap<=0)return i.collided=!1,i}else{if(l=t._overlapAxes(s.vertices,c.vertices,s.axes),l.overlap<=0||(o=t._overlapAxes(c.vertices,s.vertices,c.axes),o.overlap<=0))return i.collided=!1,i;l.overlap<o.overlap?(e=l,i.axisBody=s):(e=o,i.axisBody=c),i.axisNumber=e.axisNumber}i.bodyA=s.id<c.id?s:c,i.bodyB=s.id<c.id?c:s,i.collided=!0,i.depth=e.overlap,i.parentA=i.bodyA.parent,i.parentB=i.bodyB.parent,s=i.bodyA,c=i.bodyB,n.dot(e.axis,n.sub(c.position,s.position))<0?i.normal={x:e.axis.x,y:e.axis.y}:i.normal={x:-e.axis.x,y:-e.axis.y},i.tangent=n.perp(i.normal),i.penetration=i.penetration||{},i.penetration.x=i.normal.x*i.depth,i.penetration.y=i.normal.y*i.depth;var x=t._findSupports(s,c,i.normal),y=[];if(a.contains(s.vertices,x[0])&&y.push(x[0]),a.contains(s.vertices,x[1])&&y.push(x[1]),y.length<2){var P=t._findSupports(c,s,n.neg(i.normal));a.contains(c.vertices,P[0])&&y.push(P[0]),y.length<2&&a.contains(c.vertices,P[1])&&y.push(P[1])}return y.length<1&&(y=[x[0]]),i.supports=y,i},t._overlapAxes=function(s,c,r){for(var l=n._temp[0],o=n._temp[1],e={overlap:Number.MAX_VALUE},i,f,u=0;u<r.length;u++){if(f=r[u],t._projectToAxis(l,s,f),t._projectToAxis(o,c,f),i=Math.min(l.max-o.min,o.max-l.min),i<=0)return e.overlap=i,e;i<e.overlap&&(e.overlap=i,e.axis=f,e.axisNumber=u)}return e},t._projectToAxis=function(s,c,r){for(var l=n.dot(c[0],r),o=l,e=1;e<c.length;e+=1){var i=n.dot(c[e],r);i>o?o=i:i<l&&(l=i)}s.min=l,s.max=o},t._findSupports=function(s,c,r){for(var l=Number.MAX_VALUE,o=n._temp[0],e=c.vertices,i=s.position,f,u,g,S,w=0;w<e.length;w++)u=e[w],o.x=u.x-i.x,o.y=u.y-i.y,f=-n.dot(r,o),f<l&&(l=f,g=u);var p=g.index-1>=0?g.index-1:e.length-1;u=e[p],o.x=u.x-i.x,o.y=u.y-i.y,l=-n.dot(r,o),S=u;var v=(g.index+1)%e.length;return u=e[v],o.x=u.x-i.x,o.y=u.y-i.y,f=-n.dot(r,o),f<l&&(S=u),[g,S]}})()},function(m,A,h){var t={};m.exports=t;var a=h(0);(function(){t._registry={},t.register=function(n){if(t.isPlugin(n)||a.warn("Plugin.register:",t.toString(n),"does not implement all required fields."),n.name in t._registry){var s=t._registry[n.name],c=t.versionParse(n.version).number,r=t.versionParse(s.version).number;c>r?(a.warn("Plugin.register:",t.toString(s),"was upgraded to",t.toString(n)),t._registry[n.name]=n):c<r?a.warn("Plugin.register:",t.toString(s),"can not be downgraded to",t.toString(n)):n!==s&&a.warn("Plugin.register:",t.toString(n),"is already registered to different plugin object")}else t._registry[n.name]=n;return n},t.resolve=function(n){return t._registry[t.dependencyParse(n).name]},t.toString=function(n){return typeof n=="string"?n:(n.name||"anonymous")+"@"+(n.version||n.range||"0.0.0")},t.isPlugin=function(n){return n&&n.name&&n.version&&n.install},t.isUsed=function(n,s){return n.used.indexOf(s)>-1},t.isFor=function(n,s){var c=n.for&&t.dependencyParse(n.for);return!n.for||s.name===c.name&&t.versionSatisfies(s.version,c.range)},t.use=function(n,s){if(n.uses=(n.uses||[]).concat(s||[]),n.uses.length===0){a.warn("Plugin.use:",t.toString(n),"does not specify any dependencies to install.");return}for(var c=t.dependencies(n),r=a.topologicalSort(c),l=[],o=0;o<r.length;o+=1)if(r[o]!==n.name){var e=t.resolve(r[o]);if(!e){l.push("❌ "+r[o]);continue}t.isUsed(n,e.name)||(t.isFor(e,n)||(a.warn("Plugin.use:",t.toString(e),"is for",e.for,"but installed on",t.toString(n)+"."),e._warned=!0),e.install?e.install(n):(a.warn("Plugin.use:",t.toString(e),"does not specify an install function."),e._warned=!0),e._warned?(l.push("🔶 "+t.toString(e)),delete e._warned):l.push("✅ "+t.toString(e)),n.used.push(e.name))}l.length>0&&a.info(l.join("  "))},t.dependencies=function(n,s){var c=t.dependencyParse(n),r=c.name;if(s=s||{},!(r in s)){n=t.resolve(n)||n,s[r]=a.map(n.uses||[],function(o){t.isPlugin(o)&&t.register(o);var e=t.dependencyParse(o),i=t.resolve(o);return i&&!t.versionSatisfies(i.version,e.range)?(a.warn("Plugin.dependencies:",t.toString(i),"does not satisfy",t.toString(e),"used by",t.toString(c)+"."),i._warned=!0,n._warned=!0):i||(a.warn("Plugin.dependencies:",t.toString(o),"used by",t.toString(c),"could not be resolved."),n._warned=!0),e.name});for(var l=0;l<s[r].length;l+=1)t.dependencies(s[r][l],s);return s}},t.dependencyParse=function(n){if(a.isString(n)){var s=/^[\w-]+(@(\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-]+)?))?$/;return s.test(n)||a.warn("Plugin.dependencyParse:",n,"is not a valid dependency string."),{name:n.split("@")[0],range:n.split("@")[1]||"*"}}return{name:n.name,range:n.range||n.version}},t.versionParse=function(n){var s=/^(\*)|(\^|~|>=|>)?\s*((\d+)\.(\d+)\.(\d+))(-[0-9A-Za-z-]+)?$/;s.test(n)||a.warn("Plugin.versionParse:",n,"is not a valid version or range.");var c=s.exec(n),r=Number(c[4]),l=Number(c[5]),o=Number(c[6]);return{isRange:!!(c[1]||c[2]),version:c[3],range:n,operator:c[1]||c[2]||"",major:r,minor:l,patch:o,parts:[r,l,o],prerelease:c[7],number:r*1e8+l*1e4+o}},t.versionSatisfies=function(n,s){s=s||"*";var c=t.versionParse(s),r=t.versionParse(n);if(c.isRange){if(c.operator==="*"||n==="*")return!0;if(c.operator===">")return r.number>c.number;if(c.operator===">=")return r.number>=c.number;if(c.operator==="~")return r.major===c.major&&r.minor===c.minor&&r.patch>=c.patch;if(c.operator==="^")return c.major>0?r.major===c.major&&r.number>=c.number:c.minor>0?r.minor===c.minor&&r.patch>=c.patch:r.patch===c.patch}return n===s||n==="*"}})()},function(m,A,h){var t={};m.exports=t;var a=h(0),n=h(5),s=h(1),c=h(4),r=h(2),l=h(12);(function(){var o,e;typeof window<"u"&&(o=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(p){window.setTimeout(function(){p(a.now())},1e3/60)},e=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),t._goodFps=30,t._goodDelta=1e3/60,t.create=function(p){var v={controller:t,engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,timing:{historySize:60,delta:0,deltaHistory:[],lastTime:0,lastTimestamp:0,lastElapsed:0,timestampElapsed:0,timestampElapsedHistory:[],engineDeltaHistory:[],engineElapsedHistory:[],elapsedHistory:[]},options:{width:800,height:600,pixelRatio:1,background:"#14151f",wireframeBackground:"#14151f",hasBounds:!!p.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showStats:!1,showPerformance:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},x=a.extend(v,p);return x.canvas&&(x.canvas.width=x.options.width||x.canvas.width,x.canvas.height=x.options.height||x.canvas.height),x.mouse=p.mouse,x.engine=p.engine,x.canvas=x.canvas||u(x.options.width,x.options.height),x.context=x.canvas.getContext("2d"),x.textures={},x.bounds=x.bounds||{min:{x:0,y:0},max:{x:x.canvas.width,y:x.canvas.height}},x.options.pixelRatio!==1&&t.setPixelRatio(x,x.options.pixelRatio),a.isElement(x.element)?x.element.appendChild(x.canvas):x.canvas.parentNode||a.log("Render.create: options.element was undefined, render.canvas was created but not appended","warn"),x},t.run=function(p){(function v(x){p.frameRequestId=o(v),i(p,x),t.world(p,x),(p.options.showStats||p.options.showDebug)&&t.stats(p,p.context,x),(p.options.showPerformance||p.options.showDebug)&&t.performance(p,p.context,x)})()},t.stop=function(p){e(p.frameRequestId)},t.setPixelRatio=function(p,v){var x=p.options,y=p.canvas;v==="auto"&&(v=g(y)),x.pixelRatio=v,y.setAttribute("data-pixel-ratio",v),y.width=x.width*v,y.height=x.height*v,y.style.width=x.width+"px",y.style.height=x.height+"px"},t.lookAt=function(p,v,x,y){y=typeof y<"u"?y:!0,v=a.isArray(v)?v:[v],x=x||{x:0,y:0};for(var P={min:{x:1/0,y:1/0},max:{x:-1/0,y:-1/0}},C=0;C<v.length;C+=1){var T=v[C],M=T.bounds?T.bounds.min:T.min||T.position||T,I=T.bounds?T.bounds.max:T.max||T.position||T;M&&I&&(M.x<P.min.x&&(P.min.x=M.x),I.x>P.max.x&&(P.max.x=I.x),M.y<P.min.y&&(P.min.y=M.y),I.y>P.max.y&&(P.max.y=I.y))}var k=P.max.x-P.min.x+2*x.x,B=P.max.y-P.min.y+2*x.y,E=p.canvas.height,b=p.canvas.width,O=b/E,F=k/B,z=1,V=1;F>O?V=F/O:z=O/F,p.options.hasBounds=!0,p.bounds.min.x=P.min.x,p.bounds.max.x=P.min.x+k*z,p.bounds.min.y=P.min.y,p.bounds.max.y=P.min.y+B*V,y&&(p.bounds.min.x+=k*.5-k*z*.5,p.bounds.max.x+=k*.5-k*z*.5,p.bounds.min.y+=B*.5-B*V*.5,p.bounds.max.y+=B*.5-B*V*.5),p.bounds.min.x-=x.x,p.bounds.max.x-=x.x,p.bounds.min.y-=x.y,p.bounds.max.y-=x.y,p.mouse&&(l.setScale(p.mouse,{x:(p.bounds.max.x-p.bounds.min.x)/p.canvas.width,y:(p.bounds.max.y-p.bounds.min.y)/p.canvas.height}),l.setOffset(p.mouse,p.bounds.min))},t.startViewTransform=function(p){var v=p.bounds.max.x-p.bounds.min.x,x=p.bounds.max.y-p.bounds.min.y,y=v/p.options.width,P=x/p.options.height;p.context.setTransform(p.options.pixelRatio/y,0,0,p.options.pixelRatio/P,0,0),p.context.translate(-p.bounds.min.x,-p.bounds.min.y)},t.endViewTransform=function(p){p.context.setTransform(p.options.pixelRatio,0,0,p.options.pixelRatio,0,0)},t.world=function(p,v){var x=a.now(),y=p.engine,P=y.world,C=p.canvas,T=p.context,M=p.options,I=p.timing,k=n.allBodies(P),B=n.allConstraints(P),E=M.wireframes?M.wireframeBackground:M.background,b=[],O=[],F,z={timestamp:y.timing.timestamp};if(c.trigger(p,"beforeRender",z),p.currentBackground!==E&&w(p,E),T.globalCompositeOperation="source-in",T.fillStyle="transparent",T.fillRect(0,0,C.width,C.height),T.globalCompositeOperation="source-over",M.hasBounds){for(F=0;F<k.length;F++){var V=k[F];s.overlaps(V.bounds,p.bounds)&&b.push(V)}for(F=0;F<B.length;F++){var L=B[F],X=L.bodyA,H=L.bodyB,U=L.pointA,$=L.pointB;X&&(U=r.add(X.position,L.pointA)),H&&($=r.add(H.position,L.pointB)),!(!U||!$)&&(s.contains(p.bounds,U)||s.contains(p.bounds,$))&&O.push(L)}t.startViewTransform(p),p.mouse&&(l.setScale(p.mouse,{x:(p.bounds.max.x-p.bounds.min.x)/p.options.width,y:(p.bounds.max.y-p.bounds.min.y)/p.options.height}),l.setOffset(p.mouse,p.bounds.min))}else O=B,b=k,p.options.pixelRatio!==1&&p.context.setTransform(p.options.pixelRatio,0,0,p.options.pixelRatio,0,0);!M.wireframes||y.enableSleeping&&M.showSleeping?t.bodies(p,b,T):(M.showConvexHulls&&t.bodyConvexHulls(p,b,T),t.bodyWireframes(p,b,T)),M.showBounds&&t.bodyBounds(p,b,T),(M.showAxes||M.showAngleIndicator)&&t.bodyAxes(p,b,T),M.showPositions&&t.bodyPositions(p,b,T),M.showVelocity&&t.bodyVelocity(p,b,T),M.showIds&&t.bodyIds(p,b,T),M.showSeparations&&t.separations(p,y.pairs.list,T),M.showCollisions&&t.collisions(p,y.pairs.list,T),M.showVertexNumbers&&t.vertexNumbers(p,b,T),M.showMousePosition&&t.mousePosition(p,p.mouse,T),t.constraints(O,T),M.showBroadphase&&t.grid(p,y.grid,T),M.hasBounds&&t.endViewTransform(p),c.trigger(p,"afterRender",z),I.lastElapsed=a.now()-x},t.stats=function(p,v,x){for(var y=p.engine,P=y.world,C=n.allBodies(P),T=0,M=55,I=44,k=0,B=0,E=0;E<C.length;E+=1)T+=C[E].parts.length;var b={Part:T,Body:C.length,Cons:n.allConstraints(P).length,Comp:n.allComposites(P).length,Pair:y.pairs.list.length};v.fillStyle="#0e0f19",v.fillRect(k,B,M*5.5,I),v.font="12px Arial",v.textBaseline="top",v.textAlign="right";for(var O in b){var F=b[O];v.fillStyle="#aaa",v.fillText(O,k+M,B+8),v.fillStyle="#eee",v.fillText(F,k+M,B+26),k+=M}},t.performance=function(p,v){var x=p.engine,y=p.timing,P=y.deltaHistory,C=y.elapsedHistory,T=y.timestampElapsedHistory,M=y.engineDeltaHistory,I=y.engineElapsedHistory,k=x.timing.lastDelta,B=f(P),E=f(C),b=f(M),O=f(I),F=f(T),z=F/B||0,V=1e3/B||0,L=4,X=12,H=60,U=34,$=10,Y=69;v.fillStyle="#0e0f19",v.fillRect(0,50,X*4+H*5+22,U),t.status(v,$,Y,H,L,P.length,Math.round(V)+" fps",V/t._goodFps,function(G){return P[G]/B-1}),t.status(v,$+X+H,Y,H,L,M.length,k.toFixed(2)+" dt",t._goodDelta/k,function(G){return M[G]/b-1}),t.status(v,$+(X+H)*2,Y,H,L,I.length,O.toFixed(2)+" ut",1-O/t._goodFps,function(G){return I[G]/O-1}),t.status(v,$+(X+H)*3,Y,H,L,C.length,E.toFixed(2)+" rt",1-E/t._goodFps,function(G){return C[G]/E-1}),t.status(v,$+(X+H)*4,Y,H,L,T.length,z.toFixed(2)+" x",z*z*z,function(G){return(T[G]/P[G]/z||0)-1})},t.status=function(p,v,x,y,P,C,T,M,I){p.strokeStyle="#888",p.fillStyle="#444",p.lineWidth=1,p.fillRect(v,x+7,y,1),p.beginPath(),p.moveTo(v,x+7-P*a.clamp(.4*I(0),-2,2));for(var k=0;k<y;k+=1)p.lineTo(v+k,x+7-(k<C?P*a.clamp(.4*I(k),-2,2):0));p.stroke(),p.fillStyle="hsl("+a.clamp(25+95*M,0,120)+",100%,60%)",p.fillRect(v,x-7,4,4),p.font="12px Arial",p.textBaseline="middle",p.textAlign="right",p.fillStyle="#eee",p.fillText(T,v+y,x-5)},t.constraints=function(p,v){for(var x=v,y=0;y<p.length;y++){var P=p[y];if(!(!P.render.visible||!P.pointA||!P.pointB)){var C=P.bodyA,T=P.bodyB,M,I;if(C?M=r.add(C.position,P.pointA):M=P.pointA,P.render.type==="pin")x.beginPath(),x.arc(M.x,M.y,3,0,2*Math.PI),x.closePath();else{if(T?I=r.add(T.position,P.pointB):I=P.pointB,x.beginPath(),x.moveTo(M.x,M.y),P.render.type==="spring")for(var k=r.sub(I,M),B=r.perp(r.normalise(k)),E=Math.ceil(a.clamp(P.length/5,12,20)),b,O=1;O<E;O+=1)b=O%2===0?1:-1,x.lineTo(M.x+k.x*(O/E)+B.x*b*4,M.y+k.y*(O/E)+B.y*b*4);x.lineTo(I.x,I.y)}P.render.lineWidth&&(x.lineWidth=P.render.lineWidth,x.strokeStyle=P.render.strokeStyle,x.stroke()),P.render.anchors&&(x.fillStyle=P.render.strokeStyle,x.beginPath(),x.arc(M.x,M.y,3,0,2*Math.PI),x.arc(I.x,I.y,3,0,2*Math.PI),x.closePath(),x.fill())}}},t.bodies=function(p,v,x){var y=x;p.engine;var P=p.options,C=P.showInternalEdges||!P.wireframes,T,M,I,k;for(I=0;I<v.length;I++)if(T=v[I],!!T.render.visible){for(k=T.parts.length>1?1:0;k<T.parts.length;k++)if(M=T.parts[k],!!M.render.visible){if(P.showSleeping&&T.isSleeping?y.globalAlpha=.5*M.render.opacity:M.render.opacity!==1&&(y.globalAlpha=M.render.opacity),M.render.sprite&&M.render.sprite.texture&&!P.wireframes){var B=M.render.sprite,E=S(p,B.texture);y.translate(M.position.x,M.position.y),y.rotate(M.angle),y.drawImage(E,E.width*-B.xOffset*B.xScale,E.height*-B.yOffset*B.yScale,E.width*B.xScale,E.height*B.yScale),y.rotate(-M.angle),y.translate(-M.position.x,-M.position.y)}else{if(M.circleRadius)y.beginPath(),y.arc(M.position.x,M.position.y,M.circleRadius,0,2*Math.PI);else{y.beginPath(),y.moveTo(M.vertices[0].x,M.vertices[0].y);for(var b=1;b<M.vertices.length;b++)!M.vertices[b-1].isInternal||C?y.lineTo(M.vertices[b].x,M.vertices[b].y):y.moveTo(M.vertices[b].x,M.vertices[b].y),M.vertices[b].isInternal&&!C&&y.moveTo(M.vertices[(b+1)%M.vertices.length].x,M.vertices[(b+1)%M.vertices.length].y);y.lineTo(M.vertices[0].x,M.vertices[0].y),y.closePath()}P.wireframes?(y.lineWidth=1,y.strokeStyle="#bbb",y.stroke()):(y.fillStyle=M.render.fillStyle,M.render.lineWidth&&(y.lineWidth=M.render.lineWidth,y.strokeStyle=M.render.strokeStyle,y.stroke()),y.fill())}y.globalAlpha=1}}},t.bodyWireframes=function(p,v,x){var y=x,P=p.options.showInternalEdges,C,T,M,I,k;for(y.beginPath(),M=0;M<v.length;M++)if(C=v[M],!!C.render.visible)for(k=C.parts.length>1?1:0;k<C.parts.length;k++){for(T=C.parts[k],y.moveTo(T.vertices[0].x,T.vertices[0].y),I=1;I<T.vertices.length;I++)!T.vertices[I-1].isInternal||P?y.lineTo(T.vertices[I].x,T.vertices[I].y):y.moveTo(T.vertices[I].x,T.vertices[I].y),T.vertices[I].isInternal&&!P&&y.moveTo(T.vertices[(I+1)%T.vertices.length].x,T.vertices[(I+1)%T.vertices.length].y);y.lineTo(T.vertices[0].x,T.vertices[0].y)}y.lineWidth=1,y.strokeStyle="#bbb",y.stroke()},t.bodyConvexHulls=function(p,v,x){var y=x,P,C,T;for(y.beginPath(),C=0;C<v.length;C++)if(P=v[C],!(!P.render.visible||P.parts.length===1)){for(y.moveTo(P.vertices[0].x,P.vertices[0].y),T=1;T<P.vertices.length;T++)y.lineTo(P.vertices[T].x,P.vertices[T].y);y.lineTo(P.vertices[0].x,P.vertices[0].y)}y.lineWidth=1,y.strokeStyle="rgba(255,255,255,0.2)",y.stroke()},t.vertexNumbers=function(p,v,x){var y=x,P,C,T;for(P=0;P<v.length;P++){var M=v[P].parts;for(T=M.length>1?1:0;T<M.length;T++){var I=M[T];for(C=0;C<I.vertices.length;C++)y.fillStyle="rgba(255,255,255,0.2)",y.fillText(P+"_"+C,I.position.x+(I.vertices[C].x-I.position.x)*.8,I.position.y+(I.vertices[C].y-I.position.y)*.8)}}},t.mousePosition=function(p,v,x){var y=x;y.fillStyle="rgba(255,255,255,0.8)",y.fillText(v.position.x+"  "+v.position.y,v.position.x+5,v.position.y-5)},t.bodyBounds=function(p,v,x){var y=x;p.engine;var P=p.options;y.beginPath();for(var C=0;C<v.length;C++){var T=v[C];if(T.render.visible)for(var M=v[C].parts,I=M.length>1?1:0;I<M.length;I++){var k=M[I];y.rect(k.bounds.min.x,k.bounds.min.y,k.bounds.max.x-k.bounds.min.x,k.bounds.max.y-k.bounds.min.y)}}P.wireframes?y.strokeStyle="rgba(255,255,255,0.08)":y.strokeStyle="rgba(0,0,0,0.1)",y.lineWidth=1,y.stroke()},t.bodyAxes=function(p,v,x){var y=x;p.engine;var P=p.options,C,T,M,I;for(y.beginPath(),T=0;T<v.length;T++){var k=v[T],B=k.parts;if(k.render.visible)if(P.showAxes)for(M=B.length>1?1:0;M<B.length;M++)for(C=B[M],I=0;I<C.axes.length;I++){var E=C.axes[I];y.moveTo(C.position.x,C.position.y),y.lineTo(C.position.x+E.x*20,C.position.y+E.y*20)}else for(M=B.length>1?1:0;M<B.length;M++)for(C=B[M],I=0;I<C.axes.length;I++)y.moveTo(C.position.x,C.position.y),y.lineTo((C.vertices[0].x+C.vertices[C.vertices.length-1].x)/2,(C.vertices[0].y+C.vertices[C.vertices.length-1].y)/2)}P.wireframes?(y.strokeStyle="indianred",y.lineWidth=1):(y.strokeStyle="rgba(255, 255, 255, 0.4)",y.globalCompositeOperation="overlay",y.lineWidth=2),y.stroke(),y.globalCompositeOperation="source-over"},t.bodyPositions=function(p,v,x){var y=x;p.engine;var P=p.options,C,T,M,I;for(y.beginPath(),M=0;M<v.length;M++)if(C=v[M],!!C.render.visible)for(I=0;I<C.parts.length;I++)T=C.parts[I],y.arc(T.position.x,T.position.y,3,0,2*Math.PI,!1),y.closePath();for(P.wireframes?y.fillStyle="indianred":y.fillStyle="rgba(0,0,0,0.5)",y.fill(),y.beginPath(),M=0;M<v.length;M++)C=v[M],C.render.visible&&(y.arc(C.positionPrev.x,C.positionPrev.y,2,0,2*Math.PI,!1),y.closePath());y.fillStyle="rgba(255,165,0,0.8)",y.fill()},t.bodyVelocity=function(p,v,x){var y=x;y.beginPath();for(var P=0;P<v.length;P++){var C=v[P];C.render.visible&&(y.moveTo(C.position.x,C.position.y),y.lineTo(C.position.x+(C.position.x-C.positionPrev.x)*2,C.position.y+(C.position.y-C.positionPrev.y)*2))}y.lineWidth=3,y.strokeStyle="cornflowerblue",y.stroke()},t.bodyIds=function(p,v,x){var y=x,P,C;for(P=0;P<v.length;P++)if(v[P].render.visible){var T=v[P].parts;for(C=T.length>1?1:0;C<T.length;C++){var M=T[C];y.font="12px Arial",y.fillStyle="rgba(255,255,255,0.5)",y.fillText(M.id,M.position.x+10,M.position.y-10)}}},t.collisions=function(p,v,x){var y=x,P=p.options,C,T,M,I;for(y.beginPath(),M=0;M<v.length;M++)if(C=v[M],!!C.isActive)for(T=C.collision,I=0;I<C.activeContacts.length;I++){var k=C.activeContacts[I],B=k.vertex;y.rect(B.x-1.5,B.y-1.5,3.5,3.5)}for(P.wireframes?y.fillStyle="rgba(255,255,255,0.7)":y.fillStyle="orange",y.fill(),y.beginPath(),M=0;M<v.length;M++)if(C=v[M],!!C.isActive&&(T=C.collision,C.activeContacts.length>0)){var E=C.activeContacts[0].vertex.x,b=C.activeContacts[0].vertex.y;C.activeContacts.length===2&&(E=(C.activeContacts[0].vertex.x+C.activeContacts[1].vertex.x)/2,b=(C.activeContacts[0].vertex.y+C.activeContacts[1].vertex.y)/2),T.bodyB===T.supports[0].body||T.bodyA.isStatic===!0?y.moveTo(E-T.normal.x*8,b-T.normal.y*8):y.moveTo(E+T.normal.x*8,b+T.normal.y*8),y.lineTo(E,b)}P.wireframes?y.strokeStyle="rgba(255,165,0,0.7)":y.strokeStyle="orange",y.lineWidth=1,y.stroke()},t.separations=function(p,v,x){var y=x,P=p.options,C,T,M,I,k;for(y.beginPath(),k=0;k<v.length;k++)if(C=v[k],!!C.isActive){T=C.collision,M=T.bodyA,I=T.bodyB;var B=1;!I.isStatic&&!M.isStatic&&(B=.5),I.isStatic&&(B=0),y.moveTo(I.position.x,I.position.y),y.lineTo(I.position.x-T.penetration.x*B,I.position.y-T.penetration.y*B),B=1,!I.isStatic&&!M.isStatic&&(B=.5),M.isStatic&&(B=0),y.moveTo(M.position.x,M.position.y),y.lineTo(M.position.x+T.penetration.x*B,M.position.y+T.penetration.y*B)}P.wireframes?y.strokeStyle="rgba(255,165,0,0.5)":y.strokeStyle="orange",y.stroke()},t.grid=function(p,v,x){var y=x,P=p.options;P.wireframes?y.strokeStyle="rgba(255,180,0,0.1)":y.strokeStyle="rgba(255,180,0,0.5)",y.beginPath();for(var C=a.keys(v.buckets),T=0;T<C.length;T++){var M=C[T];if(!(v.buckets[M].length<2)){var I=M.split(/C|R/);y.rect(.5+parseInt(I[1],10)*v.bucketWidth,.5+parseInt(I[2],10)*v.bucketHeight,v.bucketWidth,v.bucketHeight)}}y.lineWidth=1,y.stroke()},t.inspector=function(p,v){p.engine;var x=p.selected,y=p.render,P=y.options,C;if(P.hasBounds){var T=y.bounds.max.x-y.bounds.min.x,M=y.bounds.max.y-y.bounds.min.y,I=T/y.options.width,k=M/y.options.height;v.scale(1/I,1/k),v.translate(-y.bounds.min.x,-y.bounds.min.y)}for(var B=0;B<x.length;B++){var E=x[B].data;switch(v.translate(.5,.5),v.lineWidth=1,v.strokeStyle="rgba(255,165,0,0.9)",v.setLineDash([1,2]),E.type){case"body":C=E.bounds,v.beginPath(),v.rect(Math.floor(C.min.x-3),Math.floor(C.min.y-3),Math.floor(C.max.x-C.min.x+6),Math.floor(C.max.y-C.min.y+6)),v.closePath(),v.stroke();break;case"constraint":var b=E.pointA;E.bodyA&&(b=E.pointB),v.beginPath(),v.arc(b.x,b.y,10,0,2*Math.PI),v.closePath(),v.stroke();break}v.setLineDash([]),v.translate(-.5,-.5)}p.selectStart!==null&&(v.translate(.5,.5),v.lineWidth=1,v.strokeStyle="rgba(255,165,0,0.6)",v.fillStyle="rgba(255,165,0,0.1)",C=p.selectBounds,v.beginPath(),v.rect(Math.floor(C.min.x),Math.floor(C.min.y),Math.floor(C.max.x-C.min.x),Math.floor(C.max.y-C.min.y)),v.closePath(),v.stroke(),v.fill(),v.translate(-.5,-.5)),P.hasBounds&&v.setTransform(1,0,0,1,0,0)};var i=function(p,v){var x=p.engine,y=p.timing,P=y.historySize,C=x.timing.timestamp;y.delta=v-y.lastTime||t._goodDelta,y.lastTime=v,y.timestampElapsed=C-y.lastTimestamp||0,y.lastTimestamp=C,y.deltaHistory.unshift(y.delta),y.deltaHistory.length=Math.min(y.deltaHistory.length,P),y.engineDeltaHistory.unshift(x.timing.lastDelta),y.engineDeltaHistory.length=Math.min(y.engineDeltaHistory.length,P),y.timestampElapsedHistory.unshift(y.timestampElapsed),y.timestampElapsedHistory.length=Math.min(y.timestampElapsedHistory.length,P),y.engineElapsedHistory.unshift(x.timing.lastElapsed),y.engineElapsedHistory.length=Math.min(y.engineElapsedHistory.length,P),y.elapsedHistory.unshift(y.lastElapsed),y.elapsedHistory.length=Math.min(y.elapsedHistory.length,P)},f=function(p){for(var v=0,x=0;x<p.length;x+=1)v+=p[x];return v/p.length||0},u=function(p,v){var x=document.createElement("canvas");return x.width=p,x.height=v,x.oncontextmenu=function(){return!1},x.onselectstart=function(){return!1},x},g=function(p){var v=p.getContext("2d"),x=window.devicePixelRatio||1,y=v.webkitBackingStorePixelRatio||v.mozBackingStorePixelRatio||v.msBackingStorePixelRatio||v.oBackingStorePixelRatio||v.backingStorePixelRatio||1;return x/y},S=function(p,v){var x=p.textures[v];return x||(x=p.textures[v]=new Image,x.src=v,x)},w=function(p,v){var x=v;/(jpg|gif|png)$/.test(v)&&(x="url("+v+")"),p.canvas.style.background=x,p.canvas.style.backgroundSize="contain",p.currentBackground=v}})()},function(m,A){var h={};m.exports=h,function(){h.create=function(t){return{id:h.id(t),vertex:t,normalImpulse:0,tangentImpulse:0}},h.id=function(t){return t.body.id+"_"+t.index}}()},function(m,A,h){var t={};m.exports=t;var a=h(7),n=h(19),s=h(13),c=h(20),r=h(21),l=h(4),o=h(5),e=h(8),i=h(0),f=h(6);(function(){t.create=function(u){u=u||{};var g={positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],plugin:{},grid:null,gravity:{x:0,y:1,scale:.001},timing:{timestamp:0,timeScale:1,lastDelta:0,lastElapsed:0}},S=i.extend(g,u);return S.world=u.world||o.create({label:"World"}),S.grid=r.create(u.grid||u.broadphase),S.pairs=c.create(),S.world.gravity=S.gravity,S.broadphase=S.grid,S.metrics={},S},t.update=function(u,g,S){var w=i.now();g=g||1e3/60,S=S||1;var p=u.world,v=u.timing,x=u.grid,y=[],P;v.timestamp+=g*v.timeScale,v.lastDelta=g*v.timeScale;var C={timestamp:v.timestamp};l.trigger(u,"beforeUpdate",C);var T=o.allBodies(p),M=o.allConstraints(p);for(u.enableSleeping&&a.update(T,v.timeScale),t._bodiesApplyGravity(T,u.gravity),t._bodiesUpdate(T,g,v.timeScale,S,p.bounds),e.preSolveAll(T),P=0;P<u.constraintIterations;P++)e.solveAll(M,v.timeScale);e.postSolveAll(T),p.isModified&&r.clear(x),r.update(x,T,u,p.isModified),y=x.pairsList,p.isModified&&o.setModified(p,!1,!1,!0);var I=s.collisions(y,u),k=u.pairs,B=v.timestamp;for(c.update(k,I,B),c.removeOld(k,B),u.enableSleeping&&a.afterCollisions(k.list,v.timeScale),k.collisionStart.length>0&&l.trigger(u,"collisionStart",{pairs:k.collisionStart}),n.preSolvePosition(k.list),P=0;P<u.positionIterations;P++)n.solvePosition(k.list,v.timeScale);for(n.postSolvePosition(T),e.preSolveAll(T),P=0;P<u.constraintIterations;P++)e.solveAll(M,v.timeScale);for(e.postSolveAll(T),n.preSolveVelocity(k.list),P=0;P<u.velocityIterations;P++)n.solveVelocity(k.list,v.timeScale);return k.collisionActive.length>0&&l.trigger(u,"collisionActive",{pairs:k.collisionActive}),k.collisionEnd.length>0&&l.trigger(u,"collisionEnd",{pairs:k.collisionEnd}),t._bodiesClearForces(T),l.trigger(u,"afterUpdate",C),u.timing.lastElapsed=i.now()-w,u},t.merge=function(u,g){if(i.extend(u,g),g.world){u.world=g.world,t.clear(u);for(var S=o.allBodies(u.world),w=0;w<S.length;w++){var p=S[w];a.set(p,!1),p.id=i.nextId()}}},t.clear=function(u){var g=u.world,S=o.allBodies(g);c.clear(u.pairs),r.clear(u.grid),r.update(u.grid,S,u,!0)},t._bodiesClearForces=function(u){for(var g=0;g<u.length;g++){var S=u[g];S.force.x=0,S.force.y=0,S.torque=0}},t._bodiesApplyGravity=function(u,g){var S=typeof g.scale<"u"?g.scale:.001;if(!(g.x===0&&g.y===0||S===0))for(var w=0;w<u.length;w++){var p=u[w];p.isStatic||p.isSleeping||(p.force.y+=p.mass*g.y*S,p.force.x+=p.mass*g.x*S)}},t._bodiesUpdate=function(u,g,S,w,p){for(var v=0;v<u.length;v++){var x=u[v];x.isStatic||x.isSleeping||f.update(x,g,S,w)}}})()},function(m,A,h){var t={};m.exports=t;var a=h(3),n=h(2),s=h(0),c=h(1);(function(){t._restingThresh=4,t._restingThreshTangent=6,t._positionDampen=.9,t._positionWarming=.8,t._frictionNormalMultiplier=5,t.preSolvePosition=function(r){var l,o,e;for(l=0;l<r.length;l++)o=r[l],o.isActive&&(e=o.activeContacts.length,o.collision.parentA.totalContacts+=e,o.collision.parentB.totalContacts+=e)},t.solvePosition=function(r,l){var o,e,i,f,u,g,S,w,p,v=n._temp[0],x=n._temp[1],y=n._temp[2],P=n._temp[3];for(o=0;o<r.length;o++)e=r[o],!(!e.isActive||e.isSensor)&&(i=e.collision,f=i.parentA,u=i.parentB,g=i.normal,S=n.sub(n.add(u.positionImpulse,u.position,v),n.add(f.positionImpulse,n.sub(u.position,i.penetration,x),y),P),e.separation=n.dot(g,S));for(o=0;o<r.length;o++)e=r[o],!(!e.isActive||e.isSensor)&&(i=e.collision,f=i.parentA,u=i.parentB,g=i.normal,p=(e.separation-e.slop)*l,(f.isStatic||u.isStatic)&&(p*=2),f.isStatic||f.isSleeping||(w=t._positionDampen/f.totalContacts,f.positionImpulse.x+=g.x*p*w,f.positionImpulse.y+=g.y*p*w),u.isStatic||u.isSleeping||(w=t._positionDampen/u.totalContacts,u.positionImpulse.x-=g.x*p*w,u.positionImpulse.y-=g.y*p*w))},t.postSolvePosition=function(r){for(var l=0;l<r.length;l++){var o=r[l];if(o.totalContacts=0,o.positionImpulse.x!==0||o.positionImpulse.y!==0){for(var e=0;e<o.parts.length;e++){var i=o.parts[e];a.translate(i.vertices,o.positionImpulse),c.update(i.bounds,i.vertices,o.velocity),i.position.x+=o.positionImpulse.x,i.position.y+=o.positionImpulse.y}o.positionPrev.x+=o.positionImpulse.x,o.positionPrev.y+=o.positionImpulse.y,n.dot(o.positionImpulse,o.velocity)<0?(o.positionImpulse.x=0,o.positionImpulse.y=0):(o.positionImpulse.x*=t._positionWarming,o.positionImpulse.y*=t._positionWarming)}}},t.preSolveVelocity=function(r){var l,o,e,i,f,u,g,S,w,p,v,x,y,P,C=n._temp[0],T=n._temp[1];for(l=0;l<r.length;l++)if(e=r[l],!(!e.isActive||e.isSensor))for(i=e.activeContacts,f=e.collision,u=f.parentA,g=f.parentB,S=f.normal,w=f.tangent,o=0;o<i.length;o++)p=i[o],v=p.vertex,x=p.normalImpulse,y=p.tangentImpulse,(x!==0||y!==0)&&(C.x=S.x*x+w.x*y,C.y=S.y*x+w.y*y,u.isStatic||u.isSleeping||(P=n.sub(v,u.position,T),u.positionPrev.x+=C.x*u.inverseMass,u.positionPrev.y+=C.y*u.inverseMass,u.anglePrev+=n.cross(P,C)*u.inverseInertia),g.isStatic||g.isSleeping||(P=n.sub(v,g.position,T),g.positionPrev.x-=C.x*g.inverseMass,g.positionPrev.y-=C.y*g.inverseMass,g.anglePrev-=n.cross(P,C)*g.inverseInertia))},t.solveVelocity=function(r,l){for(var o=l*l,e=n._temp[0],i=n._temp[1],f=n._temp[2],u=n._temp[3],g=n._temp[4],S=n._temp[5],w=0;w<r.length;w++){var p=r[w];if(!(!p.isActive||p.isSensor)){var v=p.collision,x=v.parentA,y=v.parentB,P=v.normal,C=v.tangent,T=p.activeContacts,M=1/T.length;x.velocity.x=x.position.x-x.positionPrev.x,x.velocity.y=x.position.y-x.positionPrev.y,y.velocity.x=y.position.x-y.positionPrev.x,y.velocity.y=y.position.y-y.positionPrev.y,x.angularVelocity=x.angle-x.anglePrev,y.angularVelocity=y.angle-y.anglePrev;for(var I=0;I<T.length;I++){var k=T[I],B=k.vertex,E=n.sub(B,x.position,i),b=n.sub(B,y.position,f),O=n.add(x.velocity,n.mult(n.perp(E),x.angularVelocity),u),F=n.add(y.velocity,n.mult(n.perp(b),y.angularVelocity),g),z=n.sub(O,F,S),V=n.dot(P,z),L=n.dot(C,z),X=Math.abs(L),H=s.sign(L),U=(1+p.restitution)*V,$=s.clamp(p.separation+V,0,1)*t._frictionNormalMultiplier,Y=L,G=1/0;X>p.friction*p.frictionStatic*$*o&&(G=X,Y=s.clamp(p.friction*H*o,-G,G));var j=n.cross(E,P),q=n.cross(b,P),_=M/(x.inverseMass+y.inverseMass+x.inverseInertia*j*j+y.inverseInertia*q*q);if(U*=_,Y*=_,V<0&&V*V>t._restingThresh*o)k.normalImpulse=0;else{var it=k.normalImpulse;k.normalImpulse=Math.min(k.normalImpulse+U,0),U=k.normalImpulse-it}if(L*L>t._restingThreshTangent*o)k.tangentImpulse=0;else{var st=k.tangentImpulse;k.tangentImpulse=s.clamp(k.tangentImpulse+Y,-G,G),Y=k.tangentImpulse-st}e.x=P.x*U+C.x*Y,e.y=P.y*U+C.y*Y,x.isStatic||x.isSleeping||(x.positionPrev.x+=e.x*x.inverseMass,x.positionPrev.y+=e.y*x.inverseMass,x.anglePrev+=n.cross(E,e)*x.inverseInertia),y.isStatic||y.isSleeping||(y.positionPrev.x-=e.x*y.inverseMass,y.positionPrev.y-=e.y*y.inverseMass,y.anglePrev-=n.cross(b,e)*y.inverseInertia)}}}}})()},function(m,A,h){var t={};m.exports=t;var a=h(9),n=h(0);(function(){t._pairMaxIdleLife=1e3,t.create=function(s){return n.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},s)},t.update=function(s,c,r){var l=s.list,o=s.table,e=s.collisionStart,i=s.collisionEnd,f=s.collisionActive,u,g,S,w;for(e.length=0,i.length=0,f.length=0,w=0;w<l.length;w++)l[w].confirmedActive=!1;for(w=0;w<c.length;w++)u=c[w],u.collided&&(g=a.id(u.bodyA,u.bodyB),S=o[g],S?(S.isActive?f.push(S):e.push(S),a.update(S,u,r),S.confirmedActive=!0):(S=a.create(u,r),o[g]=S,e.push(S),l.push(S)));for(w=0;w<l.length;w++)S=l[w],S.isActive&&!S.confirmedActive&&(a.setActive(S,!1,r),i.push(S))},t.removeOld=function(s,c){var r=s.list,l=s.table,o=[],e,i,f,u;for(u=0;u<r.length;u++){if(e=r[u],i=e.collision,i.bodyA.isSleeping||i.bodyB.isSleeping){e.timeUpdated=c;continue}c-e.timeUpdated>t._pairMaxIdleLife&&o.push(u)}for(u=0;u<o.length;u++)f=o[u]-u,e=r[f],delete l[e.id],r.splice(f,1)},t.clear=function(s){return s.table={},s.list.length=0,s.collisionStart.length=0,s.collisionActive.length=0,s.collisionEnd.length=0,s}})()},function(m,A,h){var t={};m.exports=t;var a=h(9),n=h(0);(function(){t.create=function(s){var c={buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48};return n.extend(c,s)},t.update=function(s,c,r,l){var o,e,i,f=r.world,u=s.buckets,g,S,w=!1;for(o=0;o<c.length;o++){var p=c[o];if(!(p.isSleeping&&!l)&&!(f.bounds&&(p.bounds.max.x<f.bounds.min.x||p.bounds.min.x>f.bounds.max.x||p.bounds.max.y<f.bounds.min.y||p.bounds.min.y>f.bounds.max.y))){var v=t._getRegion(s,p);if(!p.region||v.id!==p.region.id||l){(!p.region||l)&&(p.region=v);var x=t._regionUnion(v,p.region);for(e=x.startCol;e<=x.endCol;e++)for(i=x.startRow;i<=x.endRow;i++){S=t._getBucketId(e,i),g=u[S];var y=e>=v.startCol&&e<=v.endCol&&i>=v.startRow&&i<=v.endRow,P=e>=p.region.startCol&&e<=p.region.endCol&&i>=p.region.startRow&&i<=p.region.endRow;!y&&P&&P&&g&&t._bucketRemoveBody(s,g,p),(p.region===v||y&&!P||l)&&(g||(g=t._createBucket(u,S)),t._bucketAddBody(s,g,p))}p.region=v,w=!0}}}w&&(s.pairsList=t._createActivePairsList(s))},t.clear=function(s){s.buckets={},s.pairs={},s.pairsList=[]},t._regionUnion=function(s,c){var r=Math.min(s.startCol,c.startCol),l=Math.max(s.endCol,c.endCol),o=Math.min(s.startRow,c.startRow),e=Math.max(s.endRow,c.endRow);return t._createRegion(r,l,o,e)},t._getRegion=function(s,c){var r=c.bounds,l=Math.floor(r.min.x/s.bucketWidth),o=Math.floor(r.max.x/s.bucketWidth),e=Math.floor(r.min.y/s.bucketHeight),i=Math.floor(r.max.y/s.bucketHeight);return t._createRegion(l,o,e,i)},t._createRegion=function(s,c,r,l){return{id:s+","+c+","+r+","+l,startCol:s,endCol:c,startRow:r,endRow:l}},t._getBucketId=function(s,c){return"C"+s+"R"+c},t._createBucket=function(s,c){var r=s[c]=[];return r},t._bucketAddBody=function(s,c,r){for(var l=0;l<c.length;l++){var o=c[l];if(!(r.id===o.id||r.isStatic&&o.isStatic)){var e=a.id(r,o),i=s.pairs[e];i?i[2]+=1:s.pairs[e]=[r,o,1]}}c.push(r)},t._bucketRemoveBody=function(s,c,r){c.splice(n.indexOf(c,r),1);for(var l=0;l<c.length;l++){var o=c[l],e=a.id(r,o),i=s.pairs[e];i&&(i[2]-=1)}},t._createActivePairsList=function(s){var c,r,l=[];c=n.keys(s.pairs);for(var o=0;o<c.length;o++)r=s.pairs[c[o]],r[2]>0?l.push(r):delete s.pairs[c[o]];return l}})()},function(m,A,h){var t=m.exports=h(23);t.Axes=h(10),t.Bodies=h(11),t.Body=h(6),t.Bounds=h(1),t.Common=h(0),t.Composite=h(5),t.Composites=h(24),t.Constraint=h(8),t.Contact=h(17),t.Detector=h(13),t.Engine=h(18),t.Events=h(4),t.Grid=h(21),t.Mouse=h(12),t.MouseConstraint=h(25),t.Pair=h(9),t.Pairs=h(20),t.Plugin=h(15),t.Query=h(26),t.Render=h(16),t.Resolver=h(19),t.Runner=h(27),t.SAT=h(14),t.Sleeping=h(7),t.Svg=h(28),t.Vector=h(2),t.Vertices=h(3),t.World=h(29),t.Engine.run=t.Runner.run,t.Common.deprecated(t.Engine,"run","Engine.run ➤ use Matter.Runner.run(engine) instead")},function(m,A,h){var t={};m.exports=t;var a=h(15),n=h(0);(function(){t.name="matter-js",t.version="0.17.1",t.uses=[],t.used=[],t.use=function(){a.use(t,Array.prototype.slice.call(arguments))},t.before=function(s,c){return s=s.replace(/^Matter./,""),n.chainPathBefore(t,s,c)},t.after=function(s,c){return s=s.replace(/^Matter./,""),n.chainPathAfter(t,s,c)}})()},function(m,A,h){var t={};m.exports=t;var a=h(5),n=h(8),s=h(0),c=h(6),r=h(11),l=s.deprecated;(function(){t.stack=function(o,e,i,f,u,g,S){for(var w=a.create({label:"Stack"}),p=o,v=e,x,y=0,P=0;P<f;P++){for(var C=0,T=0;T<i;T++){var M=S(p,v,T,P,x,y);if(M){var I=M.bounds.max.y-M.bounds.min.y,k=M.bounds.max.x-M.bounds.min.x;I>C&&(C=I),c.translate(M,{x:k*.5,y:I*.5}),p=M.bounds.max.x+u,a.addBody(w,M),x=M,y+=1}else p+=u}v+=C+g,p=o}return w},t.chain=function(o,e,i,f,u,g){for(var S=o.bodies,w=1;w<S.length;w++){var p=S[w-1],v=S[w],x=p.bounds.max.y-p.bounds.min.y,y=p.bounds.max.x-p.bounds.min.x,P=v.bounds.max.y-v.bounds.min.y,C=v.bounds.max.x-v.bounds.min.x,T={bodyA:p,pointA:{x:y*e,y:x*i},bodyB:v,pointB:{x:C*f,y:P*u}},M=s.extend(T,g);a.addConstraint(o,n.create(M))}return o.label+=" Chain",o},t.mesh=function(o,e,i,f,u){var g=o.bodies,S,w,p,v,x;for(S=0;S<i;S++){for(w=1;w<e;w++)p=g[w-1+S*e],v=g[w+S*e],a.addConstraint(o,n.create(s.extend({bodyA:p,bodyB:v},u)));if(S>0)for(w=0;w<e;w++)p=g[w+(S-1)*e],v=g[w+S*e],a.addConstraint(o,n.create(s.extend({bodyA:p,bodyB:v},u))),f&&w>0&&(x=g[w-1+(S-1)*e],a.addConstraint(o,n.create(s.extend({bodyA:x,bodyB:v},u)))),f&&w<e-1&&(x=g[w+1+(S-1)*e],a.addConstraint(o,n.create(s.extend({bodyA:x,bodyB:v},u))))}return o.label+=" Mesh",o},t.pyramid=function(o,e,i,f,u,g,S){return t.stack(o,e,i,f,u,g,function(w,p,v,x,y,P){var C=Math.min(f,Math.ceil(i/2)),T=y?y.bounds.max.x-y.bounds.min.x:0;if(!(x>C)){x=C-x;var M=x,I=i-1-x;if(!(v<M||v>I)){P===1&&c.translate(y,{x:(v+(i%2===1?1:-1))*T,y:0});var k=y?v*T:0;return S(o+k+v*u,p,v,x,y,P)}}})},t.newtonsCradle=function(o,e,i,f,u){for(var g=a.create({label:"Newtons Cradle"}),S=0;S<i;S++){var w=1.9,p=r.circle(o+S*(f*w),e+u,f,{inertia:1/0,restitution:1,friction:0,frictionAir:1e-4,slop:1}),v=n.create({pointA:{x:o+S*(f*w),y:e},bodyB:p});a.addBody(g,p),a.addConstraint(g,v)}return g},l(t,"newtonsCradle","Composites.newtonsCradle ➤ moved to newtonsCradle example"),t.car=function(o,e,i,f,u){var g=c.nextGroup(!0),S=20,w=-i*.5+S,p=i*.5-S,v=0,x=a.create({label:"Car"}),y=r.rectangle(o,e,i,f,{collisionFilter:{group:g},chamfer:{radius:f*.5},density:2e-4}),P=r.circle(o+w,e+v,u,{collisionFilter:{group:g},friction:.8}),C=r.circle(o+p,e+v,u,{collisionFilter:{group:g},friction:.8}),T=n.create({bodyB:y,pointB:{x:w,y:v},bodyA:P,stiffness:1,length:0}),M=n.create({bodyB:y,pointB:{x:p,y:v},bodyA:C,stiffness:1,length:0});return a.addBody(x,y),a.addBody(x,P),a.addBody(x,C),a.addConstraint(x,T),a.addConstraint(x,M),x},l(t,"car","Composites.car ➤ moved to car example"),t.softBody=function(o,e,i,f,u,g,S,w,p,v){p=s.extend({inertia:1/0},p),v=s.extend({stiffness:.2,render:{type:"line",anchors:!1}},v);var x=t.stack(o,e,i,f,u,g,function(y,P){return r.circle(y,P,w,p)});return t.mesh(x,i,f,S,v),x.label="Soft Body",x},l(t,"softBody","Composites.softBody ➤ moved to softBody and cloth examples")})()},function(m,A,h){var t={};m.exports=t;var a=h(3),n=h(7),s=h(12),c=h(4),r=h(13),l=h(8),o=h(5),e=h(0),i=h(1);(function(){t.create=function(f,u){var g=(f?f.mouse:null)||(u?u.mouse:null);g||(f&&f.render&&f.render.canvas?g=s.create(f.render.canvas):u&&u.element?g=s.create(u.element):(g=s.create(),e.warn("MouseConstraint.create: options.mouse was undefined, options.element was undefined, may not function as expected")));var S=l.create({label:"Mouse Constraint",pointA:g.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),w={type:"mouseConstraint",mouse:g,element:null,body:null,constraint:S,collisionFilter:{category:1,mask:4294967295,group:0}},p=e.extend(w,u);return c.on(f,"beforeUpdate",function(){var v=o.allBodies(f.world);t.update(p,v),t._triggerEvents(p)}),p},t.update=function(f,u){var g=f.mouse,S=f.constraint,w=f.body;if(g.button===0){if(S.bodyB)n.set(S.bodyB,!1),S.pointA=g.position;else for(var p=0;p<u.length;p++)if(w=u[p],i.contains(w.bounds,g.position)&&r.canCollide(w.collisionFilter,f.collisionFilter))for(var v=w.parts.length>1?1:0;v<w.parts.length;v++){var x=w.parts[v];if(a.contains(x.vertices,g.position)){S.pointA=g.position,S.bodyB=f.body=w,S.pointB={x:g.position.x-w.position.x,y:g.position.y-w.position.y},S.angleB=w.angle,n.set(w,!1),c.trigger(f,"startdrag",{mouse:g,body:w});break}}}else S.bodyB=f.body=null,S.pointB=null,w&&c.trigger(f,"enddrag",{mouse:g,body:w})},t._triggerEvents=function(f){var u=f.mouse,g=u.sourceEvents;g.mousemove&&c.trigger(f,"mousemove",{mouse:u}),g.mousedown&&c.trigger(f,"mousedown",{mouse:u}),g.mouseup&&c.trigger(f,"mouseup",{mouse:u}),s.clearSourceEvents(u)}})()},function(m,A,h){var t={};m.exports=t;var a=h(2),n=h(14),s=h(1),c=h(11),r=h(3);(function(){t.collides=function(l,o){for(var e=[],i=0;i<o.length;i++){var f=o[i];if(s.overlaps(f.bounds,l.bounds))for(var u=f.parts.length===1?0:1;u<f.parts.length;u++){var g=f.parts[u];if(s.overlaps(g.bounds,l.bounds)){var S=n.collides(g,l);if(S.collided){e.push(S);break}}}}return e},t.ray=function(l,o,e,i){i=i||1e-100;for(var f=a.angle(o,e),u=a.magnitude(a.sub(o,e)),g=(e.x+o.x)*.5,S=(e.y+o.y)*.5,w=c.rectangle(g,S,u,i,{angle:f}),p=t.collides(w,l),v=0;v<p.length;v+=1){var x=p[v];x.body=x.bodyB=x.bodyA}return p},t.region=function(l,o,e){for(var i=[],f=0;f<l.length;f++){var u=l[f],g=s.overlaps(u.bounds,o);(g&&!e||!g&&e)&&i.push(u)}return i},t.point=function(l,o){for(var e=[],i=0;i<l.length;i++){var f=l[i];if(s.contains(f.bounds,o))for(var u=f.parts.length===1?0:1;u<f.parts.length;u++){var g=f.parts[u];if(s.contains(g.bounds,o)&&r.contains(g.vertices,o)){e.push(f);break}}}return e}})()},function(m,A,h){var t={};m.exports=t;var a=h(4),n=h(18),s=h(0);(function(){var c,r;if(typeof window<"u"&&(c=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame,r=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),!c){var l;c=function(o){l=setTimeout(function(){o(s.now())},1e3/60)},r=function(){clearTimeout(l)}}t.create=function(o){var e={fps:60,correction:1,deltaSampleSize:60,counterTimestamp:0,frameCounter:0,deltaHistory:[],timePrev:null,timeScalePrev:1,frameRequestId:null,isFixed:!1,enabled:!0},i=s.extend(e,o);return i.delta=i.delta||1e3/i.fps,i.deltaMin=i.deltaMin||1e3/i.fps,i.deltaMax=i.deltaMax||1e3/(i.fps*.5),i.fps=1e3/i.delta,i},t.run=function(o,e){return typeof o.positionIterations<"u"&&(e=o,o=t.create()),function i(f){o.frameRequestId=c(i),f&&o.enabled&&t.tick(o,e,f)}(),o},t.tick=function(o,e,i){var f=e.timing,u=1,g,S={timestamp:f.timestamp};a.trigger(o,"beforeTick",S),o.isFixed?g=o.delta:(g=i-o.timePrev||o.delta,o.timePrev=i,o.deltaHistory.push(g),o.deltaHistory=o.deltaHistory.slice(-o.deltaSampleSize),g=Math.min.apply(null,o.deltaHistory),g=g<o.deltaMin?o.deltaMin:g,g=g>o.deltaMax?o.deltaMax:g,u=g/o.delta,o.delta=g),o.timeScalePrev!==0&&(u*=f.timeScale/o.timeScalePrev),f.timeScale===0&&(u=0),o.timeScalePrev=f.timeScale,o.correction=u,o.frameCounter+=1,i-o.counterTimestamp>=1e3&&(o.fps=o.frameCounter*((i-o.counterTimestamp)/1e3),o.counterTimestamp=i,o.frameCounter=0),a.trigger(o,"tick",S),a.trigger(o,"beforeUpdate",S),n.update(e,g,u),a.trigger(o,"afterUpdate",S),a.trigger(o,"afterTick",S)},t.stop=function(o){r(o.frameRequestId)},t.start=function(o,e){t.run(o,e)}})()},function(m,A,h){var t={};m.exports=t,h(1);var a=h(0);(function(){t.pathToVertices=function(n,s){typeof window<"u"&&!("SVGPathSeg"in window)&&a.warn("Svg.pathToVertices: SVGPathSeg not defined, a polyfill is required.");var c,r,l,o,e,i,f,u,g,S,w=[],p,v,x=0,y=0,P=0;s=s||15;var C=function(M,I,k){var B=k%2===1&&k>1;if(!g||M!=g.x||I!=g.y){g&&B?(p=g.x,v=g.y):(p=0,v=0);var E={x:p+M,y:v+I};(B||!g)&&(g=E),w.push(E),y=p+M,P=v+I}},T=function(M){var I=M.pathSegTypeAsLetter.toUpperCase();if(I!=="Z"){switch(I){case"M":case"L":case"T":case"C":case"S":case"Q":y=M.x,P=M.y;break;case"H":y=M.x;break;case"V":P=M.y;break}C(y,P,M.pathSegType)}};for(t._svgPathToAbsolute(n),l=n.getTotalLength(),i=[],c=0;c<n.pathSegList.numberOfItems;c+=1)i.push(n.pathSegList.getItem(c));for(f=i.concat();x<l;){if(S=n.getPathSegAtLength(x),e=i[S],e!=u){for(;f.length&&f[0]!=e;)T(f.shift());u=e}switch(e.pathSegTypeAsLetter.toUpperCase()){case"C":case"T":case"S":case"Q":case"A":o=n.getPointAtLength(x),C(o.x,o.y,0);break}x+=s}for(c=0,r=f.length;c<r;++c)T(f[c]);return w},t._svgPathToAbsolute=function(n){for(var s,c,r,l,o,e,i=n.pathSegList,f=0,u=0,g=i.numberOfItems,S=0;S<g;++S){var w=i.getItem(S),p=w.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(p))"x"in w&&(f=w.x),"y"in w&&(u=w.y);else switch("x1"in w&&(r=f+w.x1),"x2"in w&&(o=f+w.x2),"y1"in w&&(l=u+w.y1),"y2"in w&&(e=u+w.y2),"x"in w&&(f+=w.x),"y"in w&&(u+=w.y),p){case"m":i.replaceItem(n.createSVGPathSegMovetoAbs(f,u),S);break;case"l":i.replaceItem(n.createSVGPathSegLinetoAbs(f,u),S);break;case"h":i.replaceItem(n.createSVGPathSegLinetoHorizontalAbs(f),S);break;case"v":i.replaceItem(n.createSVGPathSegLinetoVerticalAbs(u),S);break;case"c":i.replaceItem(n.createSVGPathSegCurvetoCubicAbs(f,u,r,l,o,e),S);break;case"s":i.replaceItem(n.createSVGPathSegCurvetoCubicSmoothAbs(f,u,o,e),S);break;case"q":i.replaceItem(n.createSVGPathSegCurvetoQuadraticAbs(f,u,r,l),S);break;case"t":i.replaceItem(n.createSVGPathSegCurvetoQuadraticSmoothAbs(f,u),S);break;case"a":i.replaceItem(n.createSVGPathSegArcAbs(f,u,w.r1,w.r2,w.angle,w.largeArcFlag,w.sweepFlag),S);break;case"z":case"Z":f=s,u=c;break}(p=="M"||p=="m")&&(s=f,c=u)}}})()},function(m,A,h){var t={};m.exports=t;var a=h(5);h(0),function(){t.create=a.create,t.add=a.add,t.remove=a.remove,t.clear=a.clear,t.addComposite=a.addComposite,t.addBody=a.addBody,t.addConstraint=a.addConstraint}()}])})})(tt);var K=tt.exports;const D=at(K);class rt{constructor(d,m){W(this,"position");W(this,"health");W(this,"body");W(this,"onShip");W(this,"atShipWheel");this.position={x:d,y:m},this.health=100,this.body=D.Bodies.circle(d,m,15,{label:"player",density:.002,frictionAir:.1}),this.onShip=!1,this.atShipWheel=!1}move(d,m){this.position.x+=d,this.position.y+=m}takeDamage(d){this.health-=d,this.health<0&&(this.health=0)}isAlive(){return this.health>0}setOnShip(d,m=!1){this.onShip=d,this.atShipWheel=m,D.Body.set(this.body,"isSensor",d&&m)}setAtShipWheel(d){this.onShip&&(this.atShipWheel=d,D.Body.set(this.body,"isSensor",d))}}const R=class R{constructor(d,m,A,h,t){W(this,"position");W(this,"size");W(this,"speed");W(this,"health");W(this,"body");W(this,"modules",new Map);W(this,"planks",[]);W(this,"waterLevel",0);W(this,"rudderAngle",0);W(this,"sailsOpenness",0);W(this,"currentWindDirection",0);W(this,"currentWindPower",0);W(this,"forwardForce",0);W(this,"turningForce",0);W(this,"momentum",0);W(this,"path",null);W(this,"moduleVisualPositions",new Map);W(this,"playerAtWheel",!1);this.position={x:d,y:m},this.speed=t,this.health=100,this.forwardForce=0,this.turningForce=0,this.momentum=0;const a=620;this.body=D.Bodies.rectangle(d,m,a,180,{label:"ship",density:5e-4,frictionAir:.05,friction:.03,restitution:.1,inertia:1/0,angle:0,sleepThreshold:15,slop:.05}),this.size={width:a,height:180},this.createPlankStructure()}static createHullPath(){const d=R.HULL_POINTS,m=new Path2D;return m.moveTo(d.bow.x,d.bow.y),m.quadraticCurveTo(d.bowTip.x,d.bowTip.y,d.bow.x,d.bowBottom.y),m.lineTo(d.sternBottom.x,d.sternBottom.y),m.quadraticCurveTo(d.sternTip.x,d.sternTip.y,d.stern.x,d.stern.y),m.closePath(),m}createPlankStructure(){for(let m=0;m<40;m++){const A=m/40*Math.PI*2,h=225,t=90;this.addPlank(this.position.x+Math.cos(A)*h,this.position.y+Math.sin(A)*t)}for(let m=-150;m<=150;m+=50)this.addPlank(this.position.x+m,this.position.y),this.addPlank(this.position.x+m,this.position.y-40),this.addPlank(this.position.x+m,this.position.y+40)}addPlank(d,m){const h=D.Bodies.rectangle(d,m,15,15,{label:"plank",isSensor:!0,density:.001});this.planks.push({position:{x:d,y:m},health:100,body:h})}addModule(d,m){return this.ensureModuleVisualPosition(d,m),this.modules.set(d,m),!0}ensureModuleVisualPosition(d,m){if(this.moduleVisualPositions.set(d,{...m.position}),m.type==="wheel"&&R.WHEEL.x===m.position.x&&R.WHEEL.y===m.position.y)m.position={x:R.WHEEL.x,y:R.WHEEL.y};else if(m.type==="sail"){const A=R.MASTS.find(h=>Math.abs(h.x-m.position.x)<20&&Math.abs(h.y-m.position.y)<20);A&&(m.position={x:A.x,y:A.y})}else if(m.type==="cannon"){const A=R.CANNONS.find(h=>Math.abs(h.x-m.position.x)<20&&Math.abs(h.y-m.position.y)<20);A&&(m.position={x:A.x,y:A.y})}}getModuleVisualPosition(d){if(this.moduleVisualPositions.has(d))return this.moduleVisualPositions.get(d);const m=this.modules.get(d);return m?m.position:{x:0,y:0}}removeModule(d){return this.modules.has(d)?(this.modules.delete(d),!0):!1}updateModules(){this.modules.forEach((d,m)=>{this.moduleVisualPositions.has(m)&&(d.type==="sail"||d.type==="cannon"||d.type==="wheel")&&this.ensureModuleVisualPosition(m,d),d.update()})}calculateWaterIntake(){let d=0;for(const m of this.planks)m.health<50&&d++;return d*.05}updateWaterLevel(){const d=this.calculateWaterIntake();this.waterLevel+=d,this.waterLevel>=100&&this.sink()}sink(){}damagePlank(d,m){d>=0&&d<this.planks.length&&(this.planks[d].health-=m,this.planks[d].health<0&&(this.planks[d].health=0))}applyRudder(d){const A=Math.sqrt(this.body.velocity.x**2+this.body.velocity.y**2);this.momentum=Math.min(1,this.momentum*.95+A*.01);const t=.5*(.5+Math.min(.7,A/3));switch(d){case"left":this.rudderAngle=Math.max(-30,this.rudderAngle-t);break;case"right":this.rudderAngle=Math.min(30,this.rudderAngle+t);break;case"center":this.rudderAngle>0?this.rudderAngle=Math.max(0,this.rudderAngle-t):this.rudderAngle<0&&(this.rudderAngle=Math.min(0,this.rudderAngle+t));break}let a=0,n=0;this.modules.forEach(o=>{o.type==="sail"&&o.openness!==void 0&&o.openness>0&&(a+=o.openness,n+=1)});const s=n>0?a/(n*100):0,c=15e-6,r=Math.max(.3,1-this.momentum*.7),l=.3+.7*s;this.turningForce=this.rudderAngle*c*r*l,(A>.05||s>0)&&D.Body.setAngularVelocity(this.body,this.body.angularVelocity+this.turningForce),this.position.x=this.body.position.x,this.position.y=this.body.position.y}calculateSailEfficiency(){let d=0,m=0;return this.modules.forEach(A=>{if(A.type==="sail"&&(A.openness||0)>0){const h=A.angle||0,t=h*Math.PI/180,a=this.body.angle+t+Math.PI/2,n=Math.cos(a),s=Math.sin(a),c=this.currentWindDirection,r=Math.cos(c),l=Math.sin(c),o=r*n+l*s;let e=Math.acos(Math.min(1,Math.max(-1,o))),i=0;const f=e*180/Math.PI;f<=90?i=1-.65*f/90:i=.35,i=Math.min(1,Math.max(.35,i));const u=(A.openness||0)/100;let g=0;i>0&&(g=Math.min(.2,Math.abs(h)/75*.2)),d+=(i+g)*u,m++}}),m>0?Math.min(1.5,d/m):0}rotateSails(d){this.modules.forEach(A=>{if(A.type==="sail")switch(A.angle===void 0&&(A.angle=0),d){case"left":A.angle=Math.max(-75,A.angle-1.25);break;case"right":A.angle=Math.min(75,A.angle+1.25);break;case"center":A.angle>0?A.angle=Math.max(0,A.angle-1.25):A.angle<0&&(A.angle=Math.min(0,A.angle+1.25));break}})}fireCannon(){const d=Array.from(this.modules.values()).filter(m=>m.type==="cannon");d.length!==0&&d.forEach(m=>{m.use()})}takeDamage(d){this.health-=d,this.health<=0&&this.destroy()}applyWindForce(d,m){this.currentWindDirection=d,this.currentWindPower=m;let A=0,h=0,t=!1;this.modules.forEach(c=>{if(c.type==="sail"){const r=c.openness||0;A+=r,h++,r>0&&(t=!0)}});const a=h>0?A/h:0,n=Math.min(.05,this.momentum*.05),s=t?.85+a/100*.13+n:.85;if(D.Body.setVelocity(this.body,{x:this.body.velocity.x*s,y:this.body.velocity.y*s}),!t&&Math.abs(this.body.velocity.x)<.05&&Math.abs(this.body.velocity.y)<.05&&(D.Body.setVelocity(this.body,{x:0,y:0}),this.momentum=0),t){const c=this.calculateSailEfficiency(),r=d,l=Math.cos(r),o=Math.sin(r),e=Math.cos(this.body.angle),i=Math.sin(this.body.angle),f=Math.atan2(o*e-l*i,l*e+o*i);this.forwardForce=m*c*.024;let u;const S=Math.abs(f)*180/Math.PI;S<=90?u=1-.65*S/90:u=.35*Math.max(0,1-(S-90)/90),u=Math.max(.1,u);const w=c>0?this.forwardForce*u:0,p={x:e*w,y:i*w};D.Body.applyForce(this.body,this.body.position,p)}}adjustSails(d){this.modules.forEach(m=>{if(m.type==="sail"){const A=Math.max(0,Math.min(100,d));m.openness=A}})}openSails(){Array.from(this.modules.values()).filter(m=>m.type==="sail").forEach(m=>{if(m.openness!==void 0){const A=Math.min(100,m.openness+10);m.openness=A}})}closeSails(){Array.from(this.modules.values()).filter(m=>m.type==="sail").forEach(m=>{if(m.openness!==void 0){const A=Math.max(0,m.openness-10);m.openness=A}})}update(){this.position.x=this.body.position.x,this.position.y=this.body.position.y;const d=Math.sqrt(this.body.velocity.x**2+this.body.velocity.y**2);let m=!1;this.modules.forEach(A=>{A.type==="sail"&&(A.openness||0)>0&&(m=!0)}),m?this.momentum=Math.min(1,this.momentum*.99+d*.01):this.momentum=Math.max(0,this.momentum-.01),m?D.Body.setVelocity(this.body,{x:this.body.velocity.x*.997,y:this.body.velocity.y*.997}):(D.Body.setVelocity(this.body,{x:this.body.velocity.x*.985,y:this.body.velocity.y*.985}),Math.abs(this.body.velocity.x)<.08&&Math.abs(this.body.velocity.y)<.08&&(D.Body.setVelocity(this.body,{x:this.body.velocity.x*.85,y:this.body.velocity.y*.85}),Math.abs(this.body.velocity.x)<.005&&Math.abs(this.body.velocity.y)<.005&&(D.Body.setVelocity(this.body,{x:0,y:0}),this.momentum=0))),this.updateWaterLevel(),this.updateModules()}setPlayerOnBoard(d,m=!1){this.playerAtWheel=m,d?D.Body.set(this.body,{collisionFilter:{...this.body.collisionFilter,group:-1}}):(D.Body.set(this.body,{collisionFilter:{...this.body.collisionFilter,group:0}}),this.playerAtWheel=!1)}togglePlayerAtWheel(d){this.playerAtWheel=d}isPositionOnDeck(d,m,A){const h=d-this.position.x,t=m-this.position.y,a=Math.cos(-this.body.angle),n=Math.sin(-this.body.angle),s=h*a-t*n,c=h*n+t*a;if(this.path&&A){if(!A.isPointInPath(this.path,s,c))return!1}else if(s<-345||s>415||c<-90||c>90)return!1;for(const i of R.MASTS){const f=s-i.x,u=c-i.y;if(f*f+u*u<i.r*i.r)return!1}const r=R.WHEEL.x,l=R.WHEEL.y,o=R.WHEEL.w,e=R.WHEEL.h;if(s>r-o/2&&s<r+o/2&&c>l-e/2&&c<l+e/2)return!1;for(const i of R.CANNONS)if(s>i.x-i.w/2&&s<i.x+i.w/2&&c>i.y-i.h/2&&c<i.y+i.h/2)return!1;for(const[i,f]of this.modules.entries())if(!(f.type==="wheel"&&f.position.x===R.WHEEL.x&&f.position.y===R.WHEEL.y||f.type==="cannon"&&R.CANNONS.some(g=>g.x===f.position.x&&g.y===f.position.y))){const g=this.getModuleVisualPosition(i),S=20;if(s>g.x-S/2&&s<g.x+S/2&&c>g.y-S/2&&c<g.y+S/2)return!1}return!0}destroy(){}draw(d){d.save(),d.translate(this.position.x,this.position.y),d.rotate(this.body.angle),this.path||(this.path=R.createHullPath()),d.fillStyle="#D2B48C",d.strokeStyle="#8B4513",d.lineWidth=10,d.fill(this.path),d.stroke(this.path);for(const m of R.CANNONS)this.drawCannon(d,m.x,m.y,m.y>0?Math.PI:0);for(const m of R.MASTS)this.drawMastAndSail(d,m.x,m.y,this.getSailOpennessAt(m.x,m.y));this.drawSteeringWheel(d,R.WHEEL.x,R.WHEEL.y),d.restore()}drawDebugCollision(d){}drawDebugCollisionBox(d){}drawMastAndSail(d,m,A,h){let t=0;for(const[a,n]of this.modules.entries())if(n.type==="sail"){const s=this.getModuleVisualPosition(a);if(s.x===m&&s.y===A){n.angle!==void 0&&(t=n.angle);break}}if(d.save(),d.translate(m,A),d.beginPath(),d.arc(0,0,15,0,Math.PI*2),d.fillStyle="#D2B48C",d.strokeStyle="#8B4513",d.lineWidth=4,d.fill(),d.stroke(),h>0){d.save(),d.rotate(t*Math.PI/180),d.beginPath(),d.moveTo(0,130);const a=10+h*90;d.quadraticCurveTo(a,0,0,-130),d.closePath();let n=.35;const s=this.currentWindDirection,r=this.body.angle+t*Math.PI/180+Math.PI/2,l=Math.cos(r),o=Math.sin(r),e=Math.cos(s),i=Math.sin(s),f=e*l+i*o,u=Math.acos(Math.min(1,Math.max(-1,f)))*180/Math.PI;u<=90&&(n=1-.65*u/90);const g=Math.floor(255*(1-n)),S=Math.floor(255*n),w=Math.floor(255*.8),p=`rgba(${g}, ${S}, ${w}, 0.8)`,v=d.createLinearGradient(-a/2,0,a/2,0);v.addColorStop(0,"white"),v.addColorStop(.5,p),v.addColorStop(1,"white"),d.fillStyle=v,d.strokeStyle="#000000",d.lineWidth=2,d.fill(),d.stroke(),d.strokeStyle="rgba(255, 255, 255, 0.8)",d.lineWidth=1.5;for(let x=1;x<=4;x++){const y=x/5;d.beginPath();const P=130-260*y;d.moveTo(0,P);const C=a*(1-y*.5);d.quadraticCurveTo(C,0,0,-P),d.stroke()}d.restore()}d.restore()}drawSteeringWheel(d,m,A){d.save(),d.translate(m,A);const h=new Path2D;h.moveTo(-45,-20),h.lineTo(-25,-20),h.lineTo(-25,20),h.lineTo(-45,20),h.closePath(),d.fillStyle="#8B4513",d.fill(h),d.beginPath(),d.arc(-30,0,15,0,Math.PI*2),d.fillStyle="#654321",d.fill(),d.strokeStyle="#432100",d.lineWidth=2;for(let t=0;t<8;t++){const a=t/8*Math.PI*2;d.beginPath(),d.moveTo(-30,0),d.lineTo(-30+Math.cos(a)*14,Math.sin(a)*14),d.stroke()}d.restore()}drawCannon(d,m,A,h){d.save(),d.translate(m,A),d.rotate(h),d.fillStyle="#8B4513",d.strokeStyle="#000000",d.lineWidth=2,d.fillRect(-15,-10,30,20),d.strokeRect(-15,-10,30,20),d.fillStyle="#333333",d.beginPath(),d.moveTo(-8,0),d.lineTo(-8,-40),d.lineTo(8,-40),d.lineTo(8,0),d.closePath(),d.fill(),d.fillStyle="#654321",d.beginPath(),d.arc(-10,10,5,0,Math.PI*2),d.fill(),d.beginPath(),d.arc(10,10,5,0,Math.PI*2),d.fill(),d.restore()}testWalkableArea(d,m){d.save(),d.translate(this.position.x,this.position.y),d.rotate(this.body.angle);const A=this.size.width*1.1,h=this.size.height*1.1;this.path||(this.path=R.createHullPath()),d.strokeStyle="rgba(255, 255, 255, 0.7)",d.lineWidth=2,d.stroke(this.path),d.strokeStyle="rgba(255, 255, 0, 0.5)",d.strokeRect(-this.size.width/2,-this.size.height/2,this.size.width,this.size.height);const t=A/2,a=h/2;for(let l=-t;l<=t;l+=m)for(let o=-a;o<=a;o+=m){const e=this.position.x+l*Math.cos(this.body.angle)-o*Math.sin(this.body.angle),i=this.position.y+l*Math.sin(this.body.angle)+o*Math.cos(this.body.angle);this.isPositionOnDeck(e,i,d)?d.fillStyle="rgba(0, 255, 0, 0.5)":d.isPointInPath(this.path,l,o)?d.fillStyle="rgba(255, 0, 0, 0.5)":d.fillStyle="rgba(0, 0, 255, 0.2)",d.beginPath(),d.arc(l,o,m/3,0,Math.PI*2),d.fill()}d.fillStyle="rgba(139, 69, 19, 0.7)";for(const l of R.MASTS)d.beginPath(),d.arc(l.x,l.y,l.r,0,Math.PI*2),d.fill(),d.fillStyle="white",d.font="12px Arial",d.fillText("Mast",l.x-15,l.y),d.fillStyle="rgba(139, 69, 19, 0.7)";const n=R.WHEEL.x,s=R.WHEEL.y,c=R.WHEEL.w,r=R.WHEEL.h;d.fillStyle="rgba(255, 215, 0, 0.7)",d.fillRect(n-c/2,s-r/2,c,r),d.fillStyle="white",d.font="12px Arial",d.fillText("Wheel",n-20,s),d.fillStyle="rgba(169, 169, 169, 0.7)";for(const l of R.CANNONS)d.fillRect(l.x-l.w/2,l.y-l.h/2,l.w,l.h);this.modules.forEach((l,o)=>{if(!(l.type==="wheel"&&l.position.x===R.WHEEL.x&&l.position.y===R.WHEEL.y||l.type==="cannon"&&R.CANNONS.some(i=>i.x===l.position.x&&i.y===l.position.y))){d.fillStyle="rgba(255, 0, 255, 0.7)";const i=20,f=this.getModuleVisualPosition(o);d.fillRect(f.x-i/2,f.y-i/2,i,i),d.fillStyle="white",d.font="10px Arial",d.fillText(l.type,f.x-15,f.y)}}),d.setTransform(1,0,0,1,0,0),d.fillStyle="rgba(0, 0, 0, 0.7)",d.fillRect(10,250,160,140),d.font="12px Arial",d.fillStyle="white",d.fillText("Walkable Area Legend:",20,270),d.fillStyle="rgba(0, 255, 0, 0.5)",d.fillRect(20,280,20,20),d.fillStyle="white",d.fillText("Walkable",50,295),d.fillStyle="rgba(255, 0, 0, 0.5)",d.fillRect(20,310,20,20),d.fillStyle="white",d.fillText("Obstacles",50,325),d.fillStyle="rgba(0, 0, 255, 0.2)",d.fillRect(20,340,20,20),d.fillStyle="white",d.fillText("Outside Ship",50,355),d.fillStyle="rgba(255, 0, 255, 0.7)",d.fillRect(20,370,20,20),d.fillStyle="white",d.fillText("Added Modules",50,385),d.restore()}getSailOpennessAt(d,m){for(const[A,h]of this.modules.entries())if(h.type==="sail"&&h.openness!==void 0){const t=this.getModuleVisualPosition(A);if(t.x===d&&t.y===m)return h.openness/100}return 0}};W(R,"HULL_POINTS",{bow:{x:190,y:90},bowTip:{x:415,y:0},bowBottom:{x:190,y:-90},sternBottom:{x:-260,y:-90},sternTip:{x:-345,y:0},stern:{x:-260,y:90}}),W(R,"MASTS",[{x:165,y:0,r:30},{x:-35,y:0,r:30},{x:-235,y:0,r:30}]),W(R,"WHEEL",{x:-50,y:0,w:20,h:40}),W(R,"CANNONS",[{x:-35,y:75,w:30,h:30},{x:65,y:75,w:30,h:30},{x:-135,y:75,w:30,h:30},{x:-35,y:-75,w:30,h:30},{x:65,y:-75,w:30,h:30},{x:-135,y:-75,w:30,h:30}]);let J=R;class lt{constructor(d,m,A,h,t){W(this,"position");W(this,"health");W(this,"speed");W(this,"aiBehavior");W(this,"body");this.position={x:d,y:m},this.health=A,this.speed=h,this.aiBehavior=t,this.body=D.Bodies.circle(d,m,15,{label:"enemy",density:.002,frictionAir:.05})}moveTowards(d,m){const A=d-this.position.x,h=m-this.position.y,t=Math.sqrt(A*A+h*h);if(t>0){const a=A/t,n=h/t;this.position.x+=a*this.speed,this.position.y+=n*this.speed,D.Body.setPosition(this.body,{x:this.position.x,y:this.position.y})}}attack(){}takeDamage(d){this.health-=d,this.health<=0&&this.die()}die(){}}class ht{constructor(){W(this,"engine");W(this,"world");W(this,"windDirection",0);W(this,"windPower",1);W(this,"islands",[]);W(this,"boundaries",[]);W(this,"windSystemStartTime",Date.now());this.engine=D.Engine.create(),this.world=this.engine.world,this.setupWorld()}setupWorld(){this.setupBoundaries(),this.generateIslands(5),this.setupWind()}setupBoundaries(){const A=D.Bodies.rectangle(2500,-25,5e3,50,{isStatic:!0}),h=D.Bodies.rectangle(5e3/2,5e3+50/2,5e3,50,{isStatic:!0}),t=D.Bodies.rectangle(-50/2,5e3/2,50,5e3,{isStatic:!0}),a=D.Bodies.rectangle(5e3+50/2,5e3/2,50,5e3,{isStatic:!0});this.boundaries=[A,h,t,a],D.World.add(this.world,this.boundaries)}generateIslands(d){for(let A=0;A<d;A++){const h={width:200+Math.random()*400,height:200+Math.random()*400},t={x:500+Math.random()*(5e3-1e3),y:500+Math.random()*(5e3-1e3)},a=D.Bodies.rectangle(t.x,t.y,h.width,h.height,{isStatic:!0,label:"island"});this.islands.push({position:t,size:h,body:a}),D.World.add(this.world,a)}}setupWind(){this.windDirection=Math.random()*Math.PI*2,this.windPower=1,this.windSystemStartTime=Date.now()}updateWind(){const m=Date.now()-this.windSystemStartTime,A=5*60*1e3,h=m%A/A;for(this.windDirection=h*Math.PI*2;this.windDirection<0;)this.windDirection+=Math.PI*2;for(;this.windDirection>=Math.PI*2;)this.windDirection-=Math.PI*2;const a=1-Math.min(Math.abs(this.windDirection%Math.PI),Math.abs((this.windDirection-Math.PI)%Math.PI))/(Math.PI/2),s=Math.abs(this.windDirection-Math.PI/2)<Math.PI/6||Math.abs(this.windDirection-3*Math.PI/2)<Math.PI/6?.75:.5;this.windPower=s+a*(2-s),this.windPower+=(Math.random()-.5)*.1,this.windPower<.5&&(this.windPower=.5),this.windPower>2&&(this.windPower=2)}getWindDirection(){return this.windDirection}getWindPower(){return this.windPower}update(){D.Engine.update(this.engine),this.updateWind()}addEntity(d){D.World.add(this.world,d)}removeEntity(d){D.World.remove(this.world,d)}getEngine(){return this.engine}getIslands(){return this.islands}}class ft{constructor(d){W(this,"engine");W(this,"player");W(this,"ship");W(this,"enemies",[]);W(this,"world");W(this,"canvas");W(this,"ctx");W(this,"keysPressed",new Set);W(this,"playerOnShip",!1);W(this,"mousePosition",{x:0,y:0});W(this,"screenMousePosition",{x:0,y:0});W(this,"debugMode",!1);W(this,"showWalkableTest",!1);W(this,"viewport",{x:0,y:0,width:window.innerWidth,height:window.innerHeight,scale:1});this.engine=d,this.canvas=document.getElementById("game-canvas"),this.ctx=this.canvas.getContext("2d"),this.debugMode=!1,this.viewport.width=this.canvas.width,this.viewport.height=this.canvas.height,this.world=new ht,this.player=new rt(400,300),this.player.setOnShip(this.playerOnShip),this.ship=new J(400,350,450,180,1),this.addInitialShipModules(),this.setupInputHandlers()}updateViewportDimensions(d,m){this.viewport.width=d,this.viewport.height=m}addInitialShipModules(){this.ship.addModule("wheel",{type:"wheel",position:{x:-50,y:0},rotation:0,health:100,update(){},use(){}}),this.ship.addModule("sail1",{type:"sail",position:{x:165,y:0},rotation:0,health:100,openness:0,angle:0,update(){},use(){}}),this.ship.addModule("sail2",{type:"sail",position:{x:-35,y:0},rotation:0,health:100,openness:0,angle:0,update(){},use(){}}),this.ship.addModule("sail3",{type:"sail",position:{x:-235,y:0},rotation:0,health:100,openness:0,angle:0,update(){},use(){}}),this.ship.addModule("cannon1",{type:"cannon",position:{x:-35,y:75},rotation:Math.PI,health:100,update(){},use(){}}),this.ship.addModule("cannon2",{type:"cannon",position:{x:65,y:75},rotation:Math.PI,health:100,update(){},use(){}}),this.ship.addModule("cannon3",{type:"cannon",position:{x:-135,y:75},rotation:Math.PI,health:100,update(){},use(){}}),this.ship.addModule("cannon4",{type:"cannon",position:{x:-35,y:-75},rotation:0,health:100,update(){},use(){}}),this.ship.addModule("cannon5",{type:"cannon",position:{x:65,y:-75},rotation:0,health:100,update(){},use(){}}),this.ship.addModule("cannon6",{type:"cannon",position:{x:-135,y:-75},rotation:0,health:100,update(){},use(){}})}setupInputHandlers(){document.addEventListener("keydown",d=>{this.keysPressed.add(d.key.toLowerCase())}),document.addEventListener("keyup",d=>{this.keysPressed.delete(d.key.toLowerCase())}),this.canvas.addEventListener("mousemove",d=>{const m=this.canvas.getBoundingClientRect(),A=d.clientX-m.left,h=d.clientY-m.top;this.screenMousePosition={x:A,y:h},this.mousePosition=this.screenToWorldCoordinates(A,h)}),this.canvas.addEventListener("wheel",d=>{d.preventDefault();const m=d.deltaY>0?.9:1.1,A=Math.max(.5,Math.min(2,this.viewport.scale*m));A!==this.viewport.scale&&(this.viewport.scale=A,this.mousePosition=this.screenToWorldCoordinates(this.screenMousePosition.x,this.screenMousePosition.y))},{passive:!1}),document.addEventListener("keypress",d=>{d.key.toLowerCase()==="f"?this.togglePlayerOnShip():d.key.toLowerCase()==="e"?this.togglePlayerAtWheel():d.key.toLowerCase()==="l"?this.debugMode=!this.debugMode:d.key.toLowerCase()==="g"&&(this.showWalkableTest=!this.showWalkableTest)})}screenToWorldCoordinates(d,m){return{x:this.viewport.x+(d-this.viewport.width/2)/this.viewport.scale,y:this.viewport.y+(m-this.viewport.height/2)/this.viewport.scale}}worldToShipCoordinates(d,m){const A=d-this.ship.position.x,h=m-this.ship.position.y,t=-this.ship.body.angle,a=A*Math.cos(t)-h*Math.sin(t),n=A*Math.sin(t)+h*Math.cos(t);return{x:a,y:n}}shipToWorldCoordinates(d,m){const A=this.ship.body.angle,h=this.ship.position.x+d*Math.cos(A)-m*Math.sin(A),t=this.ship.position.y+d*Math.sin(A)+m*Math.cos(A);return{x:h,y:t}}togglePlayerOnShip(){const d=this.player.position.x-this.ship.position.x,m=this.player.position.y-this.ship.position.y,A=Math.sqrt(d*d+m*m);if(this.playerOnShip){this.playerOnShip=!1,this.player.setOnShip(!1,!1),this.ship.setPlayerOnBoard(!1,!1),this.player.position.x=this.ship.position.x+200,this.player.position.y=this.ship.position.y,D.Body.setPosition(this.player.body,{x:this.player.position.x,y:this.player.position.y}),D.Body.set(this.player.body,{collisionFilter:{...this.player.body.collisionFilter,group:0}});return}if(A<200){this.playerOnShip=!0,this.player.setOnShip(!0,!1),this.ship.setPlayerOnBoard(!0,!1);const h=this.ship.size.width,t=this.ship.size.height,a=d/A,n=m/A,s=this.ship.position.x+a*(h/2*.9),c=this.ship.position.y+n*(t/2*.9);this.ship.isPositionOnDeck(s,c)?(this.player.position.x=s,this.player.position.y=c):(this.player.position.x=this.ship.position.x+150,this.player.position.y=this.ship.position.y),D.Body.setPosition(this.player.body,{x:this.player.position.x,y:this.player.position.y}),D.Body.set(this.player.body,{collisionFilter:{...this.player.body.collisionFilter,group:-1}})}}togglePlayerAtWheel(){if(!this.playerOnShip)return;const d=this.ship.position.x-50,m=this.ship.position.y,A=this.player.position.x-d,h=this.player.position.y-m,t=Math.sqrt(A*A+h*h);this.player.atShipWheel?(this.player.setAtShipWheel(!1),this.ship.togglePlayerAtWheel(!1)):t<50&&(this.player.setAtShipWheel(!0),this.ship.togglePlayerAtWheel(!0),this.player.position.x=d,this.player.position.y=m,D.Body.setPosition(this.player.body,{x:this.player.position.x,y:this.player.position.y}))}start(){this.setupWorld();const d=D.Runner.create();D.Runner.run(d,this.engine),this.gameLoop()}setupWorld(){D.Body.set(this.player.body,{collisionFilter:{category:2,mask:1}}),D.Body.set(this.ship.body,{collisionFilter:{category:4,mask:3}}),K.World.add(this.engine.world,[this.player.body,this.ship.body]),this.spawnEnemies(3)}spawnEnemies(d){for(let m=0;m<d;m++){const A=500+Math.random()*1e3,h=500+Math.random()*1e3,t=new lt(A,h,100,.5,"aggressive");this.enemies.push(t),K.World.add(this.engine.world,t.body)}}handlePlayerMovement(){if(this.playerOnShip)if(this.player.atShipWheel){this.keysPressed.has("w")&&!this.keysPressed.has("s")?(this.ship.openSails(),this.keysPressed.delete("w")):this.keysPressed.has("s")&&!this.keysPressed.has("w")&&(this.ship.closeSails(),this.keysPressed.delete("s")),this.keysPressed.has("a")&&!this.keysPressed.has("d")&&!this.keysPressed.has("shift")?this.ship.applyRudder("left"):this.keysPressed.has("d")&&!this.keysPressed.has("a")&&!this.keysPressed.has("shift")?this.ship.applyRudder("right"):!this.keysPressed.has("a")&&!this.keysPressed.has("d")&&this.ship.applyRudder("center"),this.keysPressed.has("shift")&&(this.keysPressed.has("a")&&!this.keysPressed.has("d")?this.ship.rotateSails("left"):this.keysPressed.has("d")&&!this.keysPressed.has("a")&&this.ship.rotateSails("right"));const m=this.ship.position.x-50,A=this.ship.position.y;this.player.position.x=m,this.player.position.y=A,D.Body.setPosition(this.player.body,{x:m,y:A}),D.Body.setVelocity(this.player.body,{x:this.ship.body.velocity.x,y:this.ship.body.velocity.y}),this.player.body.isSensor||D.Body.set(this.player.body,"isSensor",!0)}else{const m=this.mousePosition.x-this.player.position.x,A=this.mousePosition.y-this.player.position.y,h=Math.atan2(A,m);let t=0,a=0;if(this.keysPressed.has("w")&&(t+=Math.cos(h)*5,a+=Math.sin(h)*5),this.keysPressed.has("s")&&(t-=Math.cos(h)*5,a-=Math.sin(h)*5),this.keysPressed.has("a")&&(t+=Math.cos(h-Math.PI/2)*5,a+=Math.sin(h-Math.PI/2)*5),this.keysPressed.has("d")&&(t+=Math.cos(h+Math.PI/2)*5,a+=Math.sin(h+Math.PI/2)*5),t!==0||a!==0){const n=this.player.position.x+t,s=this.player.position.y+a;if(this.ship.isPositionOnDeck(n,s))this.player.position.x=n,this.player.position.y=s,D.Body.setPosition(this.player.body,{x:n,y:s});else{const c={x:this.player.position.x+t,y:this.player.position.y};this.ship.isPositionOnDeck(c.x,c.y)&&(this.player.position.x=c.x,D.Body.setPosition(this.player.body,{x:c.x,y:this.player.position.y}));const r={x:this.player.position.x,y:this.player.position.y+a};this.ship.isPositionOnDeck(r.x,r.y)&&(this.player.position.y=r.y,D.Body.setPosition(this.player.body,{x:this.player.position.x,y:r.y}))}this.player.body.isSensor&&D.Body.set(this.player.body,"isSensor",!1)}D.Body.setVelocity(this.player.body,{x:this.ship.body.velocity.x,y:this.ship.body.velocity.y})}else{const m=this.mousePosition.x-this.player.position.x,A=this.mousePosition.y-this.player.position.y,h=Math.atan2(A,m);let t=0,a=0;this.keysPressed.has("w")&&(t+=Math.cos(h)*5,a+=Math.sin(h)*5),this.keysPressed.has("s")&&(t-=Math.cos(h)*5,a-=Math.sin(h)*5),this.keysPressed.has("a")&&(t+=Math.cos(h-Math.PI/2)*5,a+=Math.sin(h-Math.PI/2)*5),this.keysPressed.has("d")&&(t+=Math.cos(h+Math.PI/2)*5,a+=Math.sin(h+Math.PI/2)*5),this.player.position.x+=t,this.player.position.y+=a,D.Body.setPosition(this.player.body,{x:this.player.position.x,y:this.player.position.y}),this.player.body.isSensor&&D.Body.set(this.player.body,"isSensor",!1)}this.playerOnShip&&this.keysPressed.has(" ")&&(this.ship.fireCannon(),this.keysPressed.delete(" "))}updateCamera(){this.viewport.x=this.player.position.x,this.viewport.y=this.player.position.y}render2D(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.save(),this.ctx.fillStyle="#87CEEB",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);const d=this.viewport.width/2,m=this.viewport.height/2;this.ctx.translate(d,m),this.ctx.scale(this.viewport.scale,this.viewport.scale),this.ctx.translate(-this.viewport.x,-this.viewport.y),this.ctx.fillStyle="#87CEEB";const A=this.viewport.width/this.viewport.scale,h=this.viewport.height/this.viewport.scale;if(this.ctx.fillRect(this.viewport.x-A,this.viewport.y-h,A*3,h*3),this.drawGrid(),this.ship.draw(this.ctx),this.ctx.fillStyle="#ffcc00",this.ctx.beginPath(),this.ctx.arc(this.player.position.x,this.player.position.y,15,0,Math.PI*2),this.ctx.fill(),!this.playerOnShip){const t=this.mousePosition.x-this.player.position.x,a=this.mousePosition.y-this.player.position.y,n=Math.atan2(a,t);this.ctx.strokeStyle="#ffffff",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(this.player.position.x,this.player.position.y),this.ctx.lineTo(this.player.position.x+Math.cos(n)*20,this.player.position.y+Math.sin(n)*20),this.ctx.stroke()}this.ctx.fillStyle="#ff3300";for(const t of this.enemies)this.ctx.beginPath(),this.ctx.arc(t.position.x,t.position.y,15,0,Math.PI*2),this.ctx.fill();this.debugMode&&(this.drawDebugShapes(),this.ship.testWalkableArea(this.ctx,15)),this.showWalkableTest&&!this.debugMode&&this.ship.testWalkableArea(this.ctx,20),this.ctx.restore(),this.drawHUD()}drawHUD(){this.ctx.fillStyle="#333",this.ctx.fillRect(20,20,200,20),this.ctx.fillStyle="#00cc00",this.ctx.fillRect(20,20,this.player.health*2,20),this.ctx.strokeStyle="#fff",this.ctx.strokeRect(20,20,200,20),this.playerOnShip&&(this.ctx.fillStyle="#333",this.ctx.fillRect(20,50,200,20),this.ctx.fillStyle="#33ccff",this.ctx.fillRect(20,50,this.ship.waterLevel*2,20),this.ctx.strokeStyle="#fff",this.ctx.strokeRect(20,50,200,20)),this.ctx.fillStyle="rgba(0, 0, 0, 0.5)",this.ctx.fillRect(20,this.playerOnShip?80:50,200,30),this.ctx.fillStyle="#ffffff",this.ctx.font="12px Arial";const d=Math.round(this.player.position.x),m=Math.round(this.player.position.y);let A="";if(this.playerOnShip&&(A=this.player.atShipWheel?" (At Wheel)":" (On Deck)"),this.ctx.fillText(`Coordinates: X: ${d} Y: ${m}${A}`,30,this.playerOnShip?100:70),this.debugMode&&this.playerOnShip){const l=this.ship.isPositionOnDeck(this.player.position.x,this.player.position.y);this.ctx.fillStyle=l?"#80ff80":"#ff8080",this.ctx.fillText(`On Deck: ${l?"YES":"NO"}`,150,this.playerOnShip?100:70),this.ctx.fillStyle="#ffffff"}this.ctx.strokeStyle="#fff",this.ctx.strokeRect(20,this.playerOnShip?80:50,200,30);const h=this.playerOnShip?120:90;if(this.ctx.fillStyle="rgba(0, 0, 0, 0.5)",this.ctx.fillRect(20,h,200,30),this.ctx.fillStyle="#ffffff",this.ctx.fillText(`Zoom: ${this.viewport.scale.toFixed(2)}x`,30,h+20),this.ctx.strokeStyle="#fff",this.ctx.strokeRect(20,h,200,30),this.playerOnShip){const l=h+40;let o=0,e=0,i=0;this.ship.modules.forEach(w=>{w.type==="sail"&&(o+=w.openness!==void 0?w.openness:0,e+=w.angle!==void 0?w.angle:0,i++)});const f=i>0?Math.round(o/i):0,u=i>0?Math.round(e/i):0;if(this.ctx.fillStyle="rgba(0, 0, 0, 0.5)",this.ctx.fillRect(20,l,200,80),this.ctx.fillStyle="#333",this.ctx.fillRect(30,l+15,180,10),this.ctx.fillStyle="#ffffff",this.ctx.fillRect(30,l+15,f*1.8,10),this.ctx.fillStyle="#ffffff",this.ctx.fillText(`Sails: ${f}% open (W/S to adjust)`,30,l+12),this.ctx.fillStyle="#ffffff",this.ctx.fillText(`Sail angle: ${u}° (Shift+A/D to rotate)`,30,l+35),this.ctx.fillText(`Rudder: ${Math.round(this.ship.rudderAngle)}° (A/D to steer)`,30,l+55),Array.from(this.ship.modules.values()).filter(w=>w.type==="sail").length>0){const w=this.ship.calculateSailEfficiency();w===0?(this.ctx.fillStyle="#ff5555",this.ctx.fillText("Wind power: 0% (Bad sail angle)",30,l+75)):(w>.7?this.ctx.fillStyle="#80ff80":w>.4?this.ctx.fillStyle="#ccff00":w>.2?this.ctx.fillStyle="#ffcc00":this.ctx.fillStyle="#ff8080",this.ctx.fillText(`Wind power: ${Math.round(w*100)}%`,30,l+75))}f===0&&(this.ctx.fillStyle="#ffcc00",this.ctx.fillText("(Ship won't move with closed sails)",30,l+75));const S=Math.max(30,100-this.ship.momentum*70);this.ctx.fillStyle=S>60?"#80ff80":S>40?"#ffcc00":"#ff8080",this.ctx.fillText(`Turning power: ${Math.floor(S)}% | Ship always moves forward when sails are open`,30,l+95),this.ctx.strokeStyle="#fff",this.ctx.strokeRect(20,l,200,100)}const t=this.world.getWindDirection(),a=this.world.getWindPower();this.ctx.save(),this.ctx.translate(this.canvas.width-80,80),this.ctx.fillStyle="rgba(0, 0, 0, 0.5)",this.ctx.beginPath(),this.ctx.arc(0,0,40,0,Math.PI*2),this.ctx.fill(),this.ctx.font="10px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillStyle="#ffffff",this.ctx.fillText("Wind From",0,-50),this.ctx.strokeStyle="rgba(255, 255, 255, 0.5)",this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.arc(0,0,35,0,Math.PI*2),this.ctx.stroke(),this.ctx.font="12px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillStyle="#ffffff",this.ctx.fillText("N",0,-30),this.ctx.fillText("E",30,0),this.ctx.fillText("S",0,30),this.ctx.fillText("W",-30,0),this.ctx.rotate(t);const n=20+10*a,s=this.ctx.createLinearGradient(0,n,0,-n);s.addColorStop(0,"#00ccff"),s.addColorStop(1,"#0066cc"),this.ctx.lineWidth=3,this.ctx.strokeStyle=s,this.ctx.fillStyle=s,this.ctx.beginPath(),this.ctx.moveTo(0,n),this.ctx.lineTo(0,-n),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(0,-n),this.ctx.lineTo(-8,-n+10),this.ctx.lineTo(8,-n+10),this.ctx.closePath(),this.ctx.fill(),this.ctx.save(),this.ctx.rotate(-t),this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillStyle="#ffffff",this.ctx.font="10px Arial";const c=Math.round(a*10);if(this.ctx.fillText(`${c}/10`,0,0),this.ctx.restore(),this.ctx.restore(),this.debugMode){const l=this.canvas.height-80;this.ctx.fillStyle="rgba(255, 0, 0, 0.7)",this.ctx.fillRect(20,l,160,30),this.ctx.fillStyle="#ffffff",this.ctx.font="12px Arial",this.ctx.fillText("DEBUG MODE: Press L to toggle",30,l+20)}const r=this.canvas.height-40;this.ctx.fillStyle="rgba(0, 0, 0, 0.5)",this.ctx.fillRect(20,r,500,30),this.ctx.fillStyle="#ffffff",this.ctx.font="12px Arial",this.playerOnShip?this.player.atShipWheel?this.ctx.fillText("W/S: Open/Close Sails | A/D: Steer | Shift+A/D: Rotate Sails | E: Leave Wheel | F: Exit Ship | SPACE: Fire Cannons | L: Debug",30,r+20):this.ctx.fillText("WASD: Move on Deck | E: Use Wheel (when near) | F: Exit Ship | SPACE: Fire Cannons | L: Debug",30,r+20):this.ctx.fillText("WASD: Move (Relative to Mouse) | F: Board Ship | L: Toggle Debug Mode",30,r+20)}drawGrid(){const m="rgba(255, 255, 255, 0.2)",A=this.viewport.width/this.viewport.scale,h=this.viewport.height/this.viewport.scale,t=Math.floor((this.viewport.x-A)/100)*100,a=Math.floor((this.viewport.y-h)/100)*100,n=t+A*4,s=a+h*4;this.ctx.strokeStyle=m,this.ctx.lineWidth=1;for(let c=t;c<=n;c+=100)this.ctx.beginPath(),this.ctx.moveTo(c,a),this.ctx.lineTo(c,s),this.ctx.stroke(),c%500===0&&(this.ctx.fillStyle=m,this.ctx.font="10px Arial",this.ctx.textAlign="center",this.ctx.fillText(c.toString(),c,a+15));0>=t&&0<=n&&(this.ctx.strokeStyle="rgba(255, 255, 255, 0.5)",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(0,a),this.ctx.lineTo(0,s),this.ctx.stroke(),this.ctx.strokeStyle=m,this.ctx.lineWidth=1);for(let c=a;c<=s;c+=100)this.ctx.beginPath(),this.ctx.moveTo(t,c),this.ctx.lineTo(n,c),this.ctx.stroke(),c%500===0&&(this.ctx.fillStyle=m,this.ctx.font="10px Arial",this.ctx.textAlign="left",this.ctx.fillText(c.toString(),t+5,c+15));0>=a&&0<=s&&(this.ctx.strokeStyle="rgba(255, 255, 255, 0.5)",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(t,0),this.ctx.lineTo(n,0),this.ctx.stroke(),this.ctx.strokeStyle=m,this.ctx.lineWidth=1)}drawDebugShapes(){}gameLoop(){requestAnimationFrame(()=>{this.update(),this.render2D(),this.gameLoop()})}update(){this.world.update();let d={x:0,y:0},m=!1;if(this.playerOnShip&&!this.player.atShipWheel){const A=this.worldToShipCoordinates(this.player.position.x,this.player.position.y);d.x=A.x,d.y=A.y,m=!0}if(this.ship.applyWindForce(this.world.getWindDirection(),this.world.getWindPower()),this.ship.update(),m){const A=this.shipToWorldCoordinates(d.x,d.y);if(this.ship.isPositionOnDeck(A.x,A.y))this.player.position.x=A.x,this.player.position.y=A.y,D.Body.setPosition(this.player.body,{x:A.x,y:A.y});else{const h=this.shipToWorldCoordinates(-50,0);this.player.position.x=h.x,this.player.position.y=h.y,D.Body.setPosition(this.player.body,{x:h.x,y:h.y})}D.Body.setVelocity(this.player.body,{x:this.ship.body.velocity.x,y:this.ship.body.velocity.y})}this.handlePlayerMovement();for(const A of this.enemies)Math.random()<.01&&A.moveTowards(this.player.position.x,this.player.position.y);this.updateCamera(),(this.screenMousePosition.x!==0||this.screenMousePosition.y!==0)&&(this.mousePosition=this.screenToWorldCoordinates(this.screenMousePosition.x,this.screenMousePosition.y))}}const Q=document.getElementById("game-canvas");Q.width=window.innerWidth;Q.height=window.innerHeight;const ct=D.Engine.create({gravity:{x:0,y:0,scale:0}}),et=new ft(ct);window.addEventListener("resize",()=>{Q.width=window.innerWidth,Q.height=window.innerHeight,et.updateViewportDimensions(window.innerWidth,window.innerHeight)});et.start();
//# sourceMappingURL=index-cd658ff0.js.map
