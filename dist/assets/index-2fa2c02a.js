var lt=Object.defineProperty;var ht=(O,d,y)=>d in O?lt(O,d,{enumerable:!0,configurable:!0,writable:!0,value:y}):O[d]=y;var b=(O,d,y)=>(ht(O,typeof d!="symbol"?d+"":d,y),y);(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))P(r);new MutationObserver(r=>{for(const t of r)if(t.type==="childList")for(const a of t.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&P(a)}).observe(document,{childList:!0,subtree:!0});function y(r){const t={};return r.integrity&&(t.integrity=r.integrity),r.referrerPolicy&&(t.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?t.credentials="include":r.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function P(r){if(r.ep)return;r.ep=!0;const t=y(r);fetch(r.href,t)}})();var _=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ft(O){return O&&O.__esModule&&Object.prototype.hasOwnProperty.call(O,"default")?O.default:O}var nt={exports:{}};/*!
 * matter-js 0.17.1 by @liabru
 * http://brm.io/matter-js/
 * License MIT
 * 
 * The MIT License (MIT)
 * 
 * Copyright (c) Liam Brummitt and contributors.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */(function(O,d){(function(P,r){O.exports=r()})(_,function(){return function(y){var P={};function r(t){if(P[t])return P[t].exports;var a=P[t]={i:t,l:!1,exports:{}};return y[t].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=y,r.c=P,r.d=function(t,a,i){r.o(t,a)||Object.defineProperty(t,a,{enumerable:!0,get:i})},r.r=function(t){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,a){if(a&1&&(t=r(t)),a&8||a&4&&typeof t=="object"&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),a&2&&typeof t!="string")for(var s in t)r.d(i,s,(function(c){return t[c]}).bind(null,s));return i},r.n=function(t){var a=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(a,"a",a),a},r.o=function(t,a){return Object.prototype.hasOwnProperty.call(t,a)},r.p="",r(r.s=22)}([function(y,P){var r={};y.exports=r,function(){r._nextId=0,r._seed=0,r._nowStartTime=+new Date,r._warnedOnce={},r._decomp=null,r.extend=function(a,i){var s,c;typeof i=="boolean"?(s=2,c=i):(s=1,c=!0);for(var l=s;l<arguments.length;l++){var h=arguments[l];if(h)for(var o in h)c&&h[o]&&h[o].constructor===Object&&(!a[o]||a[o].constructor===Object)?(a[o]=a[o]||{},r.extend(a[o],c,h[o])):a[o]=h[o]}return a},r.clone=function(a,i){return r.extend({},i,a)},r.keys=function(a){if(Object.keys)return Object.keys(a);var i=[];for(var s in a)i.push(s);return i},r.values=function(a){var i=[];if(Object.keys){for(var s=Object.keys(a),c=0;c<s.length;c++)i.push(a[s[c]]);return i}for(var l in a)i.push(a[l]);return i},r.get=function(a,i,s,c){i=i.split(".").slice(s,c);for(var l=0;l<i.length;l+=1)a=a[i[l]];return a},r.set=function(a,i,s,c,l){var h=i.split(".").slice(c,l);return r.get(a,i,0,-1)[h[h.length-1]]=s,s},r.shuffle=function(a){for(var i=a.length-1;i>0;i--){var s=Math.floor(r.random()*(i+1)),c=a[i];a[i]=a[s],a[s]=c}return a},r.choose=function(a){return a[Math.floor(r.random()*a.length)]},r.isElement=function(a){return typeof HTMLElement<"u"?a instanceof HTMLElement:!!(a&&a.nodeType&&a.nodeName)},r.isArray=function(a){return Object.prototype.toString.call(a)==="[object Array]"},r.isFunction=function(a){return typeof a=="function"},r.isPlainObject=function(a){return typeof a=="object"&&a.constructor===Object},r.isString=function(a){return toString.call(a)==="[object String]"},r.clamp=function(a,i,s){return a<i?i:a>s?s:a},r.sign=function(a){return a<0?-1:1},r.now=function(){if(typeof window<"u"&&window.performance){if(window.performance.now)return window.performance.now();if(window.performance.webkitNow)return window.performance.webkitNow()}return Date.now?Date.now():new Date-r._nowStartTime},r.random=function(a,i){return a=typeof a<"u"?a:0,i=typeof i<"u"?i:1,a+t()*(i-a)};var t=function(){return r._seed=(r._seed*9301+49297)%233280,r._seed/233280};r.colorToNumber=function(a){return a=a.replace("#",""),a.length==3&&(a=a.charAt(0)+a.charAt(0)+a.charAt(1)+a.charAt(1)+a.charAt(2)+a.charAt(2)),parseInt(a,16)},r.logLevel=1,r.log=function(){console&&r.logLevel>0&&r.logLevel<=3&&console.log.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},r.info=function(){console&&r.logLevel>0&&r.logLevel<=2&&console.info.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},r.warn=function(){console&&r.logLevel>0&&r.logLevel<=3&&console.warn.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},r.warnOnce=function(){var a=Array.prototype.slice.call(arguments).join(" ");r._warnedOnce[a]||(r.warn(a),r._warnedOnce[a]=!0)},r.deprecated=function(a,i,s){a[i]=r.chain(function(){r.warnOnce("🔅 deprecated 🔅",s)},a[i])},r.nextId=function(){return r._nextId++},r.indexOf=function(a,i){if(a.indexOf)return a.indexOf(i);for(var s=0;s<a.length;s++)if(a[s]===i)return s;return-1},r.map=function(a,i){if(a.map)return a.map(i);for(var s=[],c=0;c<a.length;c+=1)s.push(i(a[c]));return s},r.topologicalSort=function(a){var i=[],s=[],c=[];for(var l in a)!s[l]&&!c[l]&&r._topologicalSort(l,s,c,a,i);return i},r._topologicalSort=function(a,i,s,c,l){var h=c[a]||[];s[a]=!0;for(var o=0;o<h.length;o+=1){var e=h[o];s[e]||i[e]||r._topologicalSort(e,i,s,c,l)}s[a]=!1,i[a]=!0,l.push(a)},r.chain=function(){for(var a=[],i=0;i<arguments.length;i+=1){var s=arguments[i];s._chained?a.push.apply(a,s._chained):a.push(s)}var c=function(){for(var l,h=new Array(arguments.length),o=0,e=arguments.length;o<e;o++)h[o]=arguments[o];for(o=0;o<a.length;o+=1){var n=a[o].apply(l,h);typeof n<"u"&&(l=n)}return l};return c._chained=a,c},r.chainPathBefore=function(a,i,s){return r.set(a,i,r.chain(s,r.get(a,i)))},r.chainPathAfter=function(a,i,s){return r.set(a,i,r.chain(r.get(a,i),s))},r.setDecomp=function(a){r._decomp=a},r.getDecomp=function(){var a=r._decomp;try{!a&&typeof window<"u"&&(a=window.decomp),!a&&typeof _<"u"&&(a=_.decomp)}catch{a=null}return a}}()},function(y,P){var r={};y.exports=r,function(){r.create=function(t){var a={min:{x:0,y:0},max:{x:0,y:0}};return t&&r.update(a,t),a},r.update=function(t,a,i){t.min.x=1/0,t.max.x=-1/0,t.min.y=1/0,t.max.y=-1/0;for(var s=0;s<a.length;s++){var c=a[s];c.x>t.max.x&&(t.max.x=c.x),c.x<t.min.x&&(t.min.x=c.x),c.y>t.max.y&&(t.max.y=c.y),c.y<t.min.y&&(t.min.y=c.y)}i&&(i.x>0?t.max.x+=i.x:t.min.x+=i.x,i.y>0?t.max.y+=i.y:t.min.y+=i.y)},r.contains=function(t,a){return a.x>=t.min.x&&a.x<=t.max.x&&a.y>=t.min.y&&a.y<=t.max.y},r.overlaps=function(t,a){return t.min.x<=a.max.x&&t.max.x>=a.min.x&&t.max.y>=a.min.y&&t.min.y<=a.max.y},r.translate=function(t,a){t.min.x+=a.x,t.max.x+=a.x,t.min.y+=a.y,t.max.y+=a.y},r.shift=function(t,a){var i=t.max.x-t.min.x,s=t.max.y-t.min.y;t.min.x=a.x,t.max.x=a.x+i,t.min.y=a.y,t.max.y=a.y+s}}()},function(y,P){var r={};y.exports=r,function(){r.create=function(t,a){return{x:t||0,y:a||0}},r.clone=function(t){return{x:t.x,y:t.y}},r.magnitude=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},r.magnitudeSquared=function(t){return t.x*t.x+t.y*t.y},r.rotate=function(t,a,i){var s=Math.cos(a),c=Math.sin(a);i||(i={});var l=t.x*s-t.y*c;return i.y=t.x*c+t.y*s,i.x=l,i},r.rotateAbout=function(t,a,i,s){var c=Math.cos(a),l=Math.sin(a);s||(s={});var h=i.x+((t.x-i.x)*c-(t.y-i.y)*l);return s.y=i.y+((t.x-i.x)*l+(t.y-i.y)*c),s.x=h,s},r.normalise=function(t){var a=r.magnitude(t);return a===0?{x:0,y:0}:{x:t.x/a,y:t.y/a}},r.dot=function(t,a){return t.x*a.x+t.y*a.y},r.cross=function(t,a){return t.x*a.y-t.y*a.x},r.cross3=function(t,a,i){return(a.x-t.x)*(i.y-t.y)-(a.y-t.y)*(i.x-t.x)},r.add=function(t,a,i){return i||(i={}),i.x=t.x+a.x,i.y=t.y+a.y,i},r.sub=function(t,a,i){return i||(i={}),i.x=t.x-a.x,i.y=t.y-a.y,i},r.mult=function(t,a){return{x:t.x*a,y:t.y*a}},r.div=function(t,a){return{x:t.x/a,y:t.y/a}},r.perp=function(t,a){return a=a===!0?-1:1,{x:a*-t.y,y:a*t.x}},r.neg=function(t){return{x:-t.x,y:-t.y}},r.angle=function(t,a){return Math.atan2(a.y-t.y,a.x-t.x)},r._temp=[r.create(),r.create(),r.create(),r.create(),r.create(),r.create()]}()},function(y,P,r){var t={};y.exports=t;var a=r(2),i=r(0);(function(){t.create=function(s,c){for(var l=[],h=0;h<s.length;h++){var o=s[h],e={x:o.x,y:o.y,index:h,body:c,isInternal:!1};l.push(e)}return l},t.fromPath=function(s,c){var l=/L?\s*([-\d.e]+)[\s,]*([-\d.e]+)*/ig,h=[];return s.replace(l,function(o,e,n){h.push({x:parseFloat(e),y:parseFloat(n)})}),t.create(h,c)},t.centre=function(s){for(var c=t.area(s,!0),l={x:0,y:0},h,o,e,n=0;n<s.length;n++)e=(n+1)%s.length,h=a.cross(s[n],s[e]),o=a.mult(a.add(s[n],s[e]),h),l=a.add(l,o);return a.div(l,6*c)},t.mean=function(s){for(var c={x:0,y:0},l=0;l<s.length;l++)c.x+=s[l].x,c.y+=s[l].y;return a.div(c,s.length)},t.area=function(s,c){for(var l=0,h=s.length-1,o=0;o<s.length;o++)l+=(s[h].x-s[o].x)*(s[h].y+s[o].y),h=o;return c?l/2:Math.abs(l)/2},t.inertia=function(s,c){for(var l=0,h=0,o=s,e,n,f=0;f<o.length;f++)n=(f+1)%o.length,e=Math.abs(a.cross(o[n],o[f])),l+=e*(a.dot(o[n],o[n])+a.dot(o[n],o[f])+a.dot(o[f],o[f])),h+=e;return c/6*(l/h)},t.translate=function(s,c,l){var h;if(l)for(h=0;h<s.length;h++)s[h].x+=c.x*l,s[h].y+=c.y*l;else for(h=0;h<s.length;h++)s[h].x+=c.x,s[h].y+=c.y;return s},t.rotate=function(s,c,l){if(c!==0){for(var h=Math.cos(c),o=Math.sin(c),e=0;e<s.length;e++){var n=s[e],f=n.x-l.x,u=n.y-l.y;n.x=l.x+(f*h-u*o),n.y=l.y+(f*o+u*h)}return s}},t.contains=function(s,c){for(var l=0;l<s.length;l++){var h=s[l],o=s[(l+1)%s.length];if((c.x-h.x)*(o.y-h.y)+(c.y-h.y)*(h.x-o.x)>0)return!1}return!0},t.scale=function(s,c,l,h){if(c===1&&l===1)return s;h=h||t.centre(s);for(var o,e,n=0;n<s.length;n++)o=s[n],e=a.sub(o,h),s[n].x=h.x+e.x*c,s[n].y=h.y+e.y*l;return s},t.chamfer=function(s,c,l,h,o){typeof c=="number"?c=[c]:c=c||[8],l=typeof l<"u"?l:-1,h=h||2,o=o||14;for(var e=[],n=0;n<s.length;n++){var f=s[n-1>=0?n-1:s.length-1],u=s[n],x=s[(n+1)%s.length],w=c[n<c.length?n:c.length-1];if(w===0){e.push(u);continue}var S=a.normalise({x:u.y-f.y,y:f.x-u.x}),p=a.normalise({x:x.y-u.y,y:u.x-x.x}),v=Math.sqrt(2*Math.pow(w,2)),m=a.mult(i.clone(S),w),g=a.normalise(a.mult(a.add(S,p),.5)),M=a.sub(u,a.mult(g,v)),A=l;l===-1&&(A=Math.pow(w,.32)*1.75),A=i.clamp(A,h,o),A%2===1&&(A+=1);for(var T=Math.acos(a.dot(S,p)),C=T/A,I=0;I<A;I++)e.push(a.add(a.rotate(m,C*I),M))}return e},t.clockwiseSort=function(s){var c=t.mean(s);return s.sort(function(l,h){return a.angle(c,l)-a.angle(c,h)}),s},t.isConvex=function(s){var c=0,l=s.length,h,o,e,n;if(l<3)return null;for(h=0;h<l;h++)if(o=(h+1)%l,e=(h+2)%l,n=(s[o].x-s[h].x)*(s[e].y-s[o].y),n-=(s[o].y-s[h].y)*(s[e].x-s[o].x),n<0?c|=1:n>0&&(c|=2),c===3)return!1;return c!==0?!0:null},t.hull=function(s){var c=[],l=[],h,o;for(s=s.slice(0),s.sort(function(e,n){var f=e.x-n.x;return f!==0?f:e.y-n.y}),o=0;o<s.length;o+=1){for(h=s[o];l.length>=2&&a.cross3(l[l.length-2],l[l.length-1],h)<=0;)l.pop();l.push(h)}for(o=s.length-1;o>=0;o-=1){for(h=s[o];c.length>=2&&a.cross3(c[c.length-2],c[c.length-1],h)<=0;)c.pop();c.push(h)}return c.pop(),l.pop(),c.concat(l)}})()},function(y,P,r){var t={};y.exports=t;var a=r(0);(function(){t.on=function(i,s,c){for(var l=s.split(" "),h,o=0;o<l.length;o++)h=l[o],i.events=i.events||{},i.events[h]=i.events[h]||[],i.events[h].push(c);return c},t.off=function(i,s,c){if(!s){i.events={};return}typeof s=="function"&&(c=s,s=a.keys(i.events).join(" "));for(var l=s.split(" "),h=0;h<l.length;h++){var o=i.events[l[h]],e=[];if(c&&o)for(var n=0;n<o.length;n++)o[n]!==c&&e.push(o[n]);i.events[l[h]]=e}},t.trigger=function(i,s,c){var l,h,o,e,n=i.events;if(n&&a.keys(n).length>0){c||(c={}),l=s.split(" ");for(var f=0;f<l.length;f++)if(h=l[f],o=n[h],o){e=a.clone(c,!1),e.name=h,e.source=i;for(var u=0;u<o.length;u++)o[u].apply(i,[e])}}}})()},function(y,P,r){var t={};y.exports=t;var a=r(4),i=r(0),s=r(1),c=r(6);(function(){t.create=function(l){return i.extend({id:i.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite",plugin:{}},l)},t.setModified=function(l,h,o,e){if(l.isModified=h,o&&l.parent&&t.setModified(l.parent,h,o,e),e)for(var n=0;n<l.composites.length;n++){var f=l.composites[n];t.setModified(f,h,o,e)}},t.add=function(l,h){var o=[].concat(h);a.trigger(l,"beforeAdd",{object:h});for(var e=0;e<o.length;e++){var n=o[e];switch(n.type){case"body":if(n.parent!==n){i.warn("Composite.add: skipped adding a compound body part (you must add its parent instead)");break}t.addBody(l,n);break;case"constraint":t.addConstraint(l,n);break;case"composite":t.addComposite(l,n);break;case"mouseConstraint":t.addConstraint(l,n.constraint);break}}return a.trigger(l,"afterAdd",{object:h}),l},t.remove=function(l,h,o){var e=[].concat(h);a.trigger(l,"beforeRemove",{object:h});for(var n=0;n<e.length;n++){var f=e[n];switch(f.type){case"body":t.removeBody(l,f,o);break;case"constraint":t.removeConstraint(l,f,o);break;case"composite":t.removeComposite(l,f,o);break;case"mouseConstraint":t.removeConstraint(l,f.constraint);break}}return a.trigger(l,"afterRemove",{object:h}),l},t.addComposite=function(l,h){return l.composites.push(h),h.parent=l,t.setModified(l,!0,!0,!1),l},t.removeComposite=function(l,h,o){var e=i.indexOf(l.composites,h);if(e!==-1&&(t.removeCompositeAt(l,e),t.setModified(l,!0,!0,!1)),o)for(var n=0;n<l.composites.length;n++)t.removeComposite(l.composites[n],h,!0);return l},t.removeCompositeAt=function(l,h){return l.composites.splice(h,1),t.setModified(l,!0,!0,!1),l},t.addBody=function(l,h){return l.bodies.push(h),t.setModified(l,!0,!0,!1),l},t.removeBody=function(l,h,o){var e=i.indexOf(l.bodies,h);if(e!==-1&&(t.removeBodyAt(l,e),t.setModified(l,!0,!0,!1)),o)for(var n=0;n<l.composites.length;n++)t.removeBody(l.composites[n],h,!0);return l},t.removeBodyAt=function(l,h){return l.bodies.splice(h,1),t.setModified(l,!0,!0,!1),l},t.addConstraint=function(l,h){return l.constraints.push(h),t.setModified(l,!0,!0,!1),l},t.removeConstraint=function(l,h,o){var e=i.indexOf(l.constraints,h);if(e!==-1&&t.removeConstraintAt(l,e),o)for(var n=0;n<l.composites.length;n++)t.removeConstraint(l.composites[n],h,!0);return l},t.removeConstraintAt=function(l,h){return l.constraints.splice(h,1),t.setModified(l,!0,!0,!1),l},t.clear=function(l,h,o){if(o)for(var e=0;e<l.composites.length;e++)t.clear(l.composites[e],h,!0);return h?l.bodies=l.bodies.filter(function(n){return n.isStatic}):l.bodies.length=0,l.constraints.length=0,l.composites.length=0,t.setModified(l,!0,!0,!1),l},t.allBodies=function(l){for(var h=[].concat(l.bodies),o=0;o<l.composites.length;o++)h=h.concat(t.allBodies(l.composites[o]));return h},t.allConstraints=function(l){for(var h=[].concat(l.constraints),o=0;o<l.composites.length;o++)h=h.concat(t.allConstraints(l.composites[o]));return h},t.allComposites=function(l){for(var h=[].concat(l.composites),o=0;o<l.composites.length;o++)h=h.concat(t.allComposites(l.composites[o]));return h},t.get=function(l,h,o){var e,n;switch(o){case"body":e=t.allBodies(l);break;case"constraint":e=t.allConstraints(l);break;case"composite":e=t.allComposites(l).concat(l);break}return e?(n=e.filter(function(f){return f.id.toString()===h.toString()}),n.length===0?null:n[0]):null},t.move=function(l,h,o){return t.remove(l,h),t.add(o,h),l},t.rebase=function(l){for(var h=t.allBodies(l).concat(t.allConstraints(l)).concat(t.allComposites(l)),o=0;o<h.length;o++)h[o].id=i.nextId();return t.setModified(l,!0,!0,!1),l},t.translate=function(l,h,o){for(var e=o?t.allBodies(l):l.bodies,n=0;n<e.length;n++)c.translate(e[n],h);return t.setModified(l,!0,!0,!1),l},t.rotate=function(l,h,o,e){for(var n=Math.cos(h),f=Math.sin(h),u=e?t.allBodies(l):l.bodies,x=0;x<u.length;x++){var w=u[x],S=w.position.x-o.x,p=w.position.y-o.y;c.setPosition(w,{x:o.x+(S*n-p*f),y:o.y+(S*f+p*n)}),c.rotate(w,h)}return t.setModified(l,!0,!0,!1),l},t.scale=function(l,h,o,e,n){for(var f=n?t.allBodies(l):l.bodies,u=0;u<f.length;u++){var x=f[u],w=x.position.x-e.x,S=x.position.y-e.y;c.setPosition(x,{x:e.x+w*h,y:e.y+S*o}),c.scale(x,h,o)}return t.setModified(l,!0,!0,!1),l},t.bounds=function(l){for(var h=t.allBodies(l),o=[],e=0;e<h.length;e+=1){var n=h[e];o.push(n.bounds.min,n.bounds.max)}return s.create(o)}})()},function(y,P,r){var t={};y.exports=t;var a=r(3),i=r(2),s=r(7);r(16);var c=r(0),l=r(1),h=r(10);(function(){t._inertiaScale=4,t._nextCollidingGroupId=1,t._nextNonCollidingGroupId=-1,t._nextCategory=1,t.create=function(e){var n={id:c.nextId(),type:"body",label:"Body",parts:[],plugin:{},angle:0,vertices:a.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,opacity:1,strokeStyle:null,fillStyle:null,lineWidth:null,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0}},events:null,bounds:null,chamfer:null,circleRadius:0,positionPrev:null,anglePrev:0,parent:null,axes:null,area:0,mass:0,inertia:0,_original:null},f=c.extend(n,e);return o(f,e),f},t.nextGroup=function(e){return e?t._nextNonCollidingGroupId--:t._nextCollidingGroupId++},t.nextCategory=function(){return t._nextCategory=t._nextCategory<<1,t._nextCategory};var o=function(e,n){n=n||{},t.set(e,{bounds:e.bounds||l.create(e.vertices),positionPrev:e.positionPrev||i.clone(e.position),anglePrev:e.anglePrev||e.angle,vertices:e.vertices,parts:e.parts||[e],isStatic:e.isStatic,isSleeping:e.isSleeping,parent:e.parent||e}),a.rotate(e.vertices,e.angle,e.position),h.rotate(e.axes,e.angle),l.update(e.bounds,e.vertices,e.velocity),t.set(e,{axes:n.axes||e.axes,area:n.area||e.area,mass:n.mass||e.mass,inertia:n.inertia||e.inertia});var f=e.isStatic?"#14151f":c.choose(["#f19648","#f5d259","#f55a3c","#063e7b","#ececd1"]),u=e.isStatic?"#555":"#ccc",x=e.isStatic&&e.render.fillStyle===null?1:0;e.render.fillStyle=e.render.fillStyle||f,e.render.strokeStyle=e.render.strokeStyle||u,e.render.lineWidth=e.render.lineWidth||x,e.render.sprite.xOffset+=-(e.bounds.min.x-e.position.x)/(e.bounds.max.x-e.bounds.min.x),e.render.sprite.yOffset+=-(e.bounds.min.y-e.position.y)/(e.bounds.max.y-e.bounds.min.y)};t.set=function(e,n,f){var u;typeof n=="string"&&(u=n,n={},n[u]=f);for(u in n)if(Object.prototype.hasOwnProperty.call(n,u))switch(f=n[u],u){case"isStatic":t.setStatic(e,f);break;case"isSleeping":s.set(e,f);break;case"mass":t.setMass(e,f);break;case"density":t.setDensity(e,f);break;case"inertia":t.setInertia(e,f);break;case"vertices":t.setVertices(e,f);break;case"position":t.setPosition(e,f);break;case"angle":t.setAngle(e,f);break;case"velocity":t.setVelocity(e,f);break;case"angularVelocity":t.setAngularVelocity(e,f);break;case"parts":t.setParts(e,f);break;case"centre":t.setCentre(e,f);break;default:e[u]=f}},t.setStatic=function(e,n){for(var f=0;f<e.parts.length;f++){var u=e.parts[f];u.isStatic=n,n?(u._original={restitution:u.restitution,friction:u.friction,mass:u.mass,inertia:u.inertia,density:u.density,inverseMass:u.inverseMass,inverseInertia:u.inverseInertia},u.restitution=0,u.friction=1,u.mass=u.inertia=u.density=1/0,u.inverseMass=u.inverseInertia=0,u.positionPrev.x=u.position.x,u.positionPrev.y=u.position.y,u.anglePrev=u.angle,u.angularVelocity=0,u.speed=0,u.angularSpeed=0,u.motion=0):u._original&&(u.restitution=u._original.restitution,u.friction=u._original.friction,u.mass=u._original.mass,u.inertia=u._original.inertia,u.density=u._original.density,u.inverseMass=u._original.inverseMass,u.inverseInertia=u._original.inverseInertia,u._original=null)}},t.setMass=function(e,n){var f=e.inertia/(e.mass/6);e.inertia=f*(n/6),e.inverseInertia=1/e.inertia,e.mass=n,e.inverseMass=1/e.mass,e.density=e.mass/e.area},t.setDensity=function(e,n){t.setMass(e,n*e.area),e.density=n},t.setInertia=function(e,n){e.inertia=n,e.inverseInertia=1/e.inertia},t.setVertices=function(e,n){n[0].body===e?e.vertices=n:e.vertices=a.create(n,e),e.axes=h.fromVertices(e.vertices),e.area=a.area(e.vertices),t.setMass(e,e.density*e.area);var f=a.centre(e.vertices);a.translate(e.vertices,f,-1),t.setInertia(e,t._inertiaScale*a.inertia(e.vertices,e.mass)),a.translate(e.vertices,e.position),l.update(e.bounds,e.vertices,e.velocity)},t.setParts=function(e,n,f){var u;for(n=n.slice(0),e.parts.length=0,e.parts.push(e),e.parent=e,u=0;u<n.length;u++){var x=n[u];x!==e&&(x.parent=e,e.parts.push(x))}if(e.parts.length!==1){if(f=typeof f<"u"?f:!0,f){var w=[];for(u=0;u<n.length;u++)w=w.concat(n[u].vertices);a.clockwiseSort(w);var S=a.hull(w),p=a.centre(S);t.setVertices(e,S),a.translate(e.vertices,p)}var v=t._totalProperties(e);e.area=v.area,e.parent=e,e.position.x=v.centre.x,e.position.y=v.centre.y,e.positionPrev.x=v.centre.x,e.positionPrev.y=v.centre.y,t.setMass(e,v.mass),t.setInertia(e,v.inertia),t.setPosition(e,v.centre)}},t.setCentre=function(e,n,f){f?(e.positionPrev.x+=n.x,e.positionPrev.y+=n.y,e.position.x+=n.x,e.position.y+=n.y):(e.positionPrev.x=n.x-(e.position.x-e.positionPrev.x),e.positionPrev.y=n.y-(e.position.y-e.positionPrev.y),e.position.x=n.x,e.position.y=n.y)},t.setPosition=function(e,n){var f=i.sub(n,e.position);e.positionPrev.x+=f.x,e.positionPrev.y+=f.y;for(var u=0;u<e.parts.length;u++){var x=e.parts[u];x.position.x+=f.x,x.position.y+=f.y,a.translate(x.vertices,f),l.update(x.bounds,x.vertices,e.velocity)}},t.setAngle=function(e,n){var f=n-e.angle;e.anglePrev+=f;for(var u=0;u<e.parts.length;u++){var x=e.parts[u];x.angle+=f,a.rotate(x.vertices,f,e.position),h.rotate(x.axes,f),l.update(x.bounds,x.vertices,e.velocity),u>0&&i.rotateAbout(x.position,f,e.position,x.position)}},t.setVelocity=function(e,n){e.positionPrev.x=e.position.x-n.x,e.positionPrev.y=e.position.y-n.y,e.velocity.x=n.x,e.velocity.y=n.y,e.speed=i.magnitude(e.velocity)},t.setAngularVelocity=function(e,n){e.anglePrev=e.angle-n,e.angularVelocity=n,e.angularSpeed=Math.abs(e.angularVelocity)},t.translate=function(e,n){t.setPosition(e,i.add(e.position,n))},t.rotate=function(e,n,f){if(!f)t.setAngle(e,e.angle+n);else{var u=Math.cos(n),x=Math.sin(n),w=e.position.x-f.x,S=e.position.y-f.y;t.setPosition(e,{x:f.x+(w*u-S*x),y:f.y+(w*x+S*u)}),t.setAngle(e,e.angle+n)}},t.scale=function(e,n,f,u){var x=0,w=0;u=u||e.position;for(var S=0;S<e.parts.length;S++){var p=e.parts[S];a.scale(p.vertices,n,f,u),p.axes=h.fromVertices(p.vertices),p.area=a.area(p.vertices),t.setMass(p,e.density*p.area),a.translate(p.vertices,{x:-p.position.x,y:-p.position.y}),t.setInertia(p,t._inertiaScale*a.inertia(p.vertices,p.mass)),a.translate(p.vertices,{x:p.position.x,y:p.position.y}),S>0&&(x+=p.area,w+=p.inertia),p.position.x=u.x+(p.position.x-u.x)*n,p.position.y=u.y+(p.position.y-u.y)*f,l.update(p.bounds,p.vertices,e.velocity)}e.parts.length>1&&(e.area=x,e.isStatic||(t.setMass(e,e.density*x),t.setInertia(e,w))),e.circleRadius&&(n===f?e.circleRadius*=n:e.circleRadius=null)},t.update=function(e,n,f,u){var x=Math.pow(n*f*e.timeScale,2),w=1-e.frictionAir*f*e.timeScale,S=e.position.x-e.positionPrev.x,p=e.position.y-e.positionPrev.y;e.velocity.x=S*w*u+e.force.x/e.mass*x,e.velocity.y=p*w*u+e.force.y/e.mass*x,e.positionPrev.x=e.position.x,e.positionPrev.y=e.position.y,e.position.x+=e.velocity.x,e.position.y+=e.velocity.y,e.angularVelocity=(e.angle-e.anglePrev)*w*u+e.torque/e.inertia*x,e.anglePrev=e.angle,e.angle+=e.angularVelocity,e.speed=i.magnitude(e.velocity),e.angularSpeed=Math.abs(e.angularVelocity);for(var v=0;v<e.parts.length;v++){var m=e.parts[v];a.translate(m.vertices,e.velocity),v>0&&(m.position.x+=e.velocity.x,m.position.y+=e.velocity.y),e.angularVelocity!==0&&(a.rotate(m.vertices,e.angularVelocity,e.position),h.rotate(m.axes,e.angularVelocity),v>0&&i.rotateAbout(m.position,e.angularVelocity,e.position,m.position)),l.update(m.bounds,m.vertices,e.velocity)}},t.applyForce=function(e,n,f){e.force.x+=f.x,e.force.y+=f.y;var u={x:n.x-e.position.x,y:n.y-e.position.y};e.torque+=u.x*f.y-u.y*f.x},t._totalProperties=function(e){for(var n={mass:0,area:0,inertia:0,centre:{x:0,y:0}},f=e.parts.length===1?0:1;f<e.parts.length;f++){var u=e.parts[f],x=u.mass!==1/0?u.mass:1;n.mass+=x,n.area+=u.area,n.inertia+=u.inertia,n.centre=i.add(n.centre,i.mult(u.position,x))}return n.centre=i.div(n.centre,n.mass),n}})()},function(y,P,r){var t={};y.exports=t;var a=r(4);(function(){t._motionWakeThreshold=.18,t._motionSleepThreshold=.08,t._minBias=.9,t.update=function(i,s){for(var c=s*s*s,l=0;l<i.length;l++){var h=i[l],o=h.speed*h.speed+h.angularSpeed*h.angularSpeed;if(h.force.x!==0||h.force.y!==0){t.set(h,!1);continue}var e=Math.min(h.motion,o),n=Math.max(h.motion,o);h.motion=t._minBias*e+(1-t._minBias)*n,h.sleepThreshold>0&&h.motion<t._motionSleepThreshold*c?(h.sleepCounter+=1,h.sleepCounter>=h.sleepThreshold&&t.set(h,!0)):h.sleepCounter>0&&(h.sleepCounter-=1)}},t.afterCollisions=function(i,s){for(var c=s*s*s,l=0;l<i.length;l++){var h=i[l];if(h.isActive){var o=h.collision,e=o.bodyA.parent,n=o.bodyB.parent;if(!(e.isSleeping&&n.isSleeping||e.isStatic||n.isStatic)&&(e.isSleeping||n.isSleeping)){var f=e.isSleeping&&!e.isStatic?e:n,u=f===e?n:e;!f.isStatic&&u.motion>t._motionWakeThreshold*c&&t.set(f,!1)}}}},t.set=function(i,s){var c=i.isSleeping;s?(i.isSleeping=!0,i.sleepCounter=i.sleepThreshold,i.positionImpulse.x=0,i.positionImpulse.y=0,i.positionPrev.x=i.position.x,i.positionPrev.y=i.position.y,i.anglePrev=i.angle,i.speed=0,i.angularSpeed=0,i.motion=0,c||a.trigger(i,"sleepStart")):(i.isSleeping=!1,i.sleepCounter=0,c&&a.trigger(i,"sleepEnd"))}})()},function(y,P,r){var t={};y.exports=t;var a=r(3),i=r(2),s=r(7),c=r(1),l=r(10),h=r(0);(function(){t._warming=.4,t._torqueDampen=1,t._minLength=1e-6,t.create=function(o){var e=o;e.bodyA&&!e.pointA&&(e.pointA={x:0,y:0}),e.bodyB&&!e.pointB&&(e.pointB={x:0,y:0});var n=e.bodyA?i.add(e.bodyA.position,e.pointA):e.pointA,f=e.bodyB?i.add(e.bodyB.position,e.pointB):e.pointB,u=i.magnitude(i.sub(n,f));e.length=typeof e.length<"u"?e.length:u,e.id=e.id||h.nextId(),e.label=e.label||"Constraint",e.type="constraint",e.stiffness=e.stiffness||(e.length>0?1:.7),e.damping=e.damping||0,e.angularStiffness=e.angularStiffness||0,e.angleA=e.bodyA?e.bodyA.angle:e.angleA,e.angleB=e.bodyB?e.bodyB.angle:e.angleB,e.plugin={};var x={visible:!0,lineWidth:2,strokeStyle:"#ffffff",type:"line",anchors:!0};return e.length===0&&e.stiffness>.1?(x.type="pin",x.anchors=!1):e.stiffness<.9&&(x.type="spring"),e.render=h.extend(x,e.render),e},t.preSolveAll=function(o){for(var e=0;e<o.length;e+=1){var n=o[e],f=n.constraintImpulse;n.isStatic||f.x===0&&f.y===0&&f.angle===0||(n.position.x+=f.x,n.position.y+=f.y,n.angle+=f.angle)}},t.solveAll=function(o,e){for(var n=0;n<o.length;n+=1){var f=o[n],u=!f.bodyA||f.bodyA&&f.bodyA.isStatic,x=!f.bodyB||f.bodyB&&f.bodyB.isStatic;(u||x)&&t.solve(o[n],e)}for(n=0;n<o.length;n+=1)f=o[n],u=!f.bodyA||f.bodyA&&f.bodyA.isStatic,x=!f.bodyB||f.bodyB&&f.bodyB.isStatic,!u&&!x&&t.solve(o[n],e)},t.solve=function(o,e){var n=o.bodyA,f=o.bodyB,u=o.pointA,x=o.pointB;if(!(!n&&!f)){n&&!n.isStatic&&(i.rotate(u,n.angle-o.angleA,u),o.angleA=n.angle),f&&!f.isStatic&&(i.rotate(x,f.angle-o.angleB,x),o.angleB=f.angle);var w=u,S=x;if(n&&(w=i.add(n.position,u)),f&&(S=i.add(f.position,x)),!(!w||!S)){var p=i.sub(w,S),v=i.magnitude(p);v<t._minLength&&(v=t._minLength);var m=(v-o.length)/v,g=o.stiffness<1?o.stiffness*e:o.stiffness,M=i.mult(p,m*g),A=(n?n.inverseMass:0)+(f?f.inverseMass:0),T=(n?n.inverseInertia:0)+(f?f.inverseInertia:0),C=A+T,I,k,W,E,B;if(o.damping){var R=i.create();W=i.div(p,v),B=i.sub(f&&i.sub(f.position,f.positionPrev)||R,n&&i.sub(n.position,n.positionPrev)||R),E=i.dot(W,B)}n&&!n.isStatic&&(k=n.inverseMass/A,n.constraintImpulse.x-=M.x*k,n.constraintImpulse.y-=M.y*k,n.position.x-=M.x*k,n.position.y-=M.y*k,o.damping&&(n.positionPrev.x-=o.damping*W.x*E*k,n.positionPrev.y-=o.damping*W.y*E*k),I=i.cross(u,M)/C*t._torqueDampen*n.inverseInertia*(1-o.angularStiffness),n.constraintImpulse.angle-=I,n.angle-=I),f&&!f.isStatic&&(k=f.inverseMass/A,f.constraintImpulse.x+=M.x*k,f.constraintImpulse.y+=M.y*k,f.position.x+=M.x*k,f.position.y+=M.y*k,o.damping&&(f.positionPrev.x+=o.damping*W.x*E*k,f.positionPrev.y+=o.damping*W.y*E*k),I=i.cross(x,M)/C*t._torqueDampen*f.inverseInertia*(1-o.angularStiffness),f.constraintImpulse.angle+=I,f.angle+=I)}}},t.postSolveAll=function(o){for(var e=0;e<o.length;e++){var n=o[e],f=n.constraintImpulse;if(!(n.isStatic||f.x===0&&f.y===0&&f.angle===0)){s.set(n,!1);for(var u=0;u<n.parts.length;u++){var x=n.parts[u];a.translate(x.vertices,f),u>0&&(x.position.x+=f.x,x.position.y+=f.y),f.angle!==0&&(a.rotate(x.vertices,f.angle,n.position),l.rotate(x.axes,f.angle),u>0&&i.rotateAbout(x.position,f.angle,n.position,x.position)),c.update(x.bounds,x.vertices,n.velocity)}f.angle*=t._warming,f.x*=t._warming,f.y*=t._warming}}},t.pointAWorld=function(o){return{x:(o.bodyA?o.bodyA.position.x:0)+o.pointA.x,y:(o.bodyA?o.bodyA.position.y:0)+o.pointA.y}},t.pointBWorld=function(o){return{x:(o.bodyB?o.bodyB.position.x:0)+o.pointB.x,y:(o.bodyB?o.bodyB.position.y:0)+o.pointB.y}}})()},function(y,P,r){var t={};y.exports=t;var a=r(17);(function(){t.create=function(i,s){var c=i.bodyA,l=i.bodyB,h=i.parentA,o=i.parentB,e={id:t.id(c,l),bodyA:c,bodyB:l,contacts:{},activeContacts:[],separation:0,isActive:!0,confirmedActive:!0,isSensor:c.isSensor||l.isSensor,timeCreated:s,timeUpdated:s,inverseMass:h.inverseMass+o.inverseMass,friction:Math.min(h.friction,o.friction),frictionStatic:Math.max(h.frictionStatic,o.frictionStatic),restitution:Math.max(h.restitution,o.restitution),slop:Math.max(h.slop,o.slop)};return t.update(e,i,s),e},t.update=function(i,s,c){var l=i.contacts,h=s.supports,o=i.activeContacts,e=s.parentA,n=s.parentB;if(i.collision=s,i.inverseMass=e.inverseMass+n.inverseMass,i.friction=Math.min(e.friction,n.friction),i.frictionStatic=Math.max(e.frictionStatic,n.frictionStatic),i.restitution=Math.max(e.restitution,n.restitution),i.slop=Math.max(e.slop,n.slop),o.length=0,s.collided){for(var f=0;f<h.length;f++){var u=h[f],x=a.id(u),w=l[x];w?o.push(w):o.push(l[x]=a.create(u))}i.separation=s.depth,t.setActive(i,!0,c)}else i.isActive===!0&&t.setActive(i,!1,c)},t.setActive=function(i,s,c){s?(i.isActive=!0,i.timeUpdated=c):(i.isActive=!1,i.activeContacts.length=0)},t.id=function(i,s){return i.id<s.id?"A"+i.id+"B"+s.id:"A"+s.id+"B"+i.id}})()},function(y,P,r){var t={};y.exports=t;var a=r(2),i=r(0);(function(){t.fromVertices=function(s){for(var c={},l=0;l<s.length;l++){var h=(l+1)%s.length,o=a.normalise({x:s[h].y-s[l].y,y:s[l].x-s[h].x}),e=o.y===0?1/0:o.x/o.y;e=e.toFixed(3).toString(),c[e]=o}return i.values(c)},t.rotate=function(s,c){if(c!==0)for(var l=Math.cos(c),h=Math.sin(c),o=0;o<s.length;o++){var e=s[o],n;n=e.x*l-e.y*h,e.y=e.x*h+e.y*l,e.x=n}}})()},function(y,P,r){var t={};y.exports=t;var a=r(3),i=r(0),s=r(6),c=r(1),l=r(2);(function(){t.rectangle=function(h,o,e,n,f){f=f||{};var u={label:"Rectangle Body",position:{x:h,y:o},vertices:a.fromPath("L 0 0 L "+e+" 0 L "+e+" "+n+" L 0 "+n)};if(f.chamfer){var x=f.chamfer;u.vertices=a.chamfer(u.vertices,x.radius,x.quality,x.qualityMin,x.qualityMax),delete f.chamfer}return s.create(i.extend({},u,f))},t.trapezoid=function(h,o,e,n,f,u){u=u||{},f*=.5;var x=(1-f*2)*e,w=e*f,S=w+x,p=S+w,v;f<.5?v="L 0 0 L "+w+" "+-n+" L "+S+" "+-n+" L "+p+" 0":v="L 0 0 L "+S+" "+-n+" L "+p+" 0";var m={label:"Trapezoid Body",position:{x:h,y:o},vertices:a.fromPath(v)};if(u.chamfer){var g=u.chamfer;m.vertices=a.chamfer(m.vertices,g.radius,g.quality,g.qualityMin,g.qualityMax),delete u.chamfer}return s.create(i.extend({},m,u))},t.circle=function(h,o,e,n,f){n=n||{};var u={label:"Circle Body",circleRadius:e};f=f||25;var x=Math.ceil(Math.max(10,Math.min(f,e)));return x%2===1&&(x+=1),t.polygon(h,o,x,e,i.extend({},u,n))},t.polygon=function(h,o,e,n,f){if(f=f||{},e<3)return t.circle(h,o,n,f);for(var u=2*Math.PI/e,x="",w=u*.5,S=0;S<e;S+=1){var p=w+S*u,v=Math.cos(p)*n,m=Math.sin(p)*n;x+="L "+v.toFixed(3)+" "+m.toFixed(3)+" "}var g={label:"Polygon Body",position:{x:h,y:o},vertices:a.fromPath(x)};if(f.chamfer){var M=f.chamfer;g.vertices=a.chamfer(g.vertices,M.radius,M.quality,M.qualityMin,M.qualityMax),delete f.chamfer}return s.create(i.extend({},g,f))},t.fromVertices=function(h,o,e,n,f,u,x,w){var S=i.getDecomp(),p,v,m,g,M,A,T,C,I,k,W;for(p=!!(S&&S.quickDecomp),n=n||{},m=[],f=typeof f<"u"?f:!1,u=typeof u<"u"?u:.01,x=typeof x<"u"?x:10,w=typeof w<"u"?w:.01,i.isArray(e[0])||(e=[e]),k=0;k<e.length;k+=1)if(A=e[k],g=a.isConvex(A),M=!g,M&&!p&&i.warnOnce("Bodies.fromVertices: Install the 'poly-decomp' library and use Common.setDecomp or provide 'decomp' as a global to decompose concave vertices."),g||!p)g?A=a.clockwiseSort(A):A=a.hull(A),m.push({position:{x:h,y:o},vertices:A});else{var E=A.map(function(Y){return[Y.x,Y.y]});S.makeCCW(E),u!==!1&&S.removeCollinearPoints(E,u),w!==!1&&S.removeDuplicatePoints&&S.removeDuplicatePoints(E,w);var B=S.quickDecomp(E);for(T=0;T<B.length;T++){var R=B[T],V=R.map(function(Y){return{x:Y[0],y:Y[1]}});x>0&&a.area(V)<x||m.push({position:a.centre(V),vertices:V})}}for(T=0;T<m.length;T++)m[T]=s.create(i.extend(m[T],n));if(f){var N=5;for(T=0;T<m.length;T++){var H=m[T];for(C=T+1;C<m.length;C++){var F=m[C];if(c.overlaps(H.bounds,F.bounds)){var X=H.vertices,z=F.vertices;for(I=0;I<H.vertices.length;I++)for(W=0;W<F.vertices.length;W++){var $=l.magnitudeSquared(l.sub(X[(I+1)%X.length],z[W])),U=l.magnitudeSquared(l.sub(X[I],z[(W+1)%z.length]));$<N&&U<N&&(X[I].isInternal=!0,z[W].isInternal=!0)}}}}}return m.length>1?(v=s.create(i.extend({parts:m.slice(0)},n)),s.setPosition(v,{x:h,y:o}),v):m[0]}})()},function(y,P,r){var t={};y.exports=t;var a=r(0);(function(){t.create=function(i){var s={};return i||a.log("Mouse.create: element was undefined, defaulting to document.body","warn"),s.element=i||document.body,s.absolute={x:0,y:0},s.position={x:0,y:0},s.mousedownPosition={x:0,y:0},s.mouseupPosition={x:0,y:0},s.offset={x:0,y:0},s.scale={x:1,y:1},s.wheelDelta=0,s.button=-1,s.pixelRatio=parseInt(s.element.getAttribute("data-pixel-ratio"),10)||1,s.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null},s.mousemove=function(c){var l=t._getRelativeMousePosition(c,s.element,s.pixelRatio),h=c.changedTouches;h&&(s.button=0,c.preventDefault()),s.absolute.x=l.x,s.absolute.y=l.y,s.position.x=s.absolute.x*s.scale.x+s.offset.x,s.position.y=s.absolute.y*s.scale.y+s.offset.y,s.sourceEvents.mousemove=c},s.mousedown=function(c){var l=t._getRelativeMousePosition(c,s.element,s.pixelRatio),h=c.changedTouches;h?(s.button=0,c.preventDefault()):s.button=c.button,s.absolute.x=l.x,s.absolute.y=l.y,s.position.x=s.absolute.x*s.scale.x+s.offset.x,s.position.y=s.absolute.y*s.scale.y+s.offset.y,s.mousedownPosition.x=s.position.x,s.mousedownPosition.y=s.position.y,s.sourceEvents.mousedown=c},s.mouseup=function(c){var l=t._getRelativeMousePosition(c,s.element,s.pixelRatio),h=c.changedTouches;h&&c.preventDefault(),s.button=-1,s.absolute.x=l.x,s.absolute.y=l.y,s.position.x=s.absolute.x*s.scale.x+s.offset.x,s.position.y=s.absolute.y*s.scale.y+s.offset.y,s.mouseupPosition.x=s.position.x,s.mouseupPosition.y=s.position.y,s.sourceEvents.mouseup=c},s.mousewheel=function(c){s.wheelDelta=Math.max(-1,Math.min(1,c.wheelDelta||-c.detail)),c.preventDefault()},t.setElement(s,s.element),s},t.setElement=function(i,s){i.element=s,s.addEventListener("mousemove",i.mousemove),s.addEventListener("mousedown",i.mousedown),s.addEventListener("mouseup",i.mouseup),s.addEventListener("mousewheel",i.mousewheel),s.addEventListener("DOMMouseScroll",i.mousewheel),s.addEventListener("touchmove",i.mousemove),s.addEventListener("touchstart",i.mousedown),s.addEventListener("touchend",i.mouseup)},t.clearSourceEvents=function(i){i.sourceEvents.mousemove=null,i.sourceEvents.mousedown=null,i.sourceEvents.mouseup=null,i.sourceEvents.mousewheel=null,i.wheelDelta=0},t.setOffset=function(i,s){i.offset.x=s.x,i.offset.y=s.y,i.position.x=i.absolute.x*i.scale.x+i.offset.x,i.position.y=i.absolute.y*i.scale.y+i.offset.y},t.setScale=function(i,s){i.scale.x=s.x,i.scale.y=s.y,i.position.x=i.absolute.x*i.scale.x+i.offset.x,i.position.y=i.absolute.y*i.scale.y+i.offset.y},t._getRelativeMousePosition=function(i,s,c){var l=s.getBoundingClientRect(),h=document.documentElement||document.body.parentNode||document.body,o=window.pageXOffset!==void 0?window.pageXOffset:h.scrollLeft,e=window.pageYOffset!==void 0?window.pageYOffset:h.scrollTop,n=i.changedTouches,f,u;return n?(f=n[0].pageX-l.left-o,u=n[0].pageY-l.top-e):(f=i.pageX-l.left-o,u=i.pageY-l.top-e),{x:f/(s.clientWidth/(s.width||s.clientWidth)*c),y:u/(s.clientHeight/(s.height||s.clientHeight)*c)}}})()},function(y,P,r){var t={};y.exports=t;var a=r(14),i=r(9),s=r(1);(function(){t.collisions=function(c,l){for(var h=[],o=l.pairs.table,e=0;e<c.length;e++){var n=c[e][0],f=c[e][1];if(!((n.isStatic||n.isSleeping)&&(f.isStatic||f.isSleeping))&&t.canCollide(n.collisionFilter,f.collisionFilter)&&s.overlaps(n.bounds,f.bounds))for(var u=n.parts.length>1?1:0;u<n.parts.length;u++)for(var x=n.parts[u],w=f.parts.length>1?1:0;w<f.parts.length;w++){var S=f.parts[w];if(x===n&&S===f||s.overlaps(x.bounds,S.bounds)){var p=i.id(x,S),v=o[p],m;v&&v.isActive?m=v.collision:m=null;var g=a.collides(x,S,m);g.collided&&h.push(g)}}}return h},t.canCollide=function(c,l){return c.group===l.group&&c.group!==0?c.group>0:(c.mask&l.category)!==0&&(l.mask&c.category)!==0}})()},function(y,P,r){var t={};y.exports=t;var a=r(3),i=r(2);(function(){t.collides=function(s,c,l){var h,o,e,n,f=!1;if(l){var u=s.parent,x=c.parent,w=u.speed*u.speed+u.angularSpeed*u.angularSpeed+x.speed*x.speed+x.angularSpeed*x.angularSpeed;f=l&&l.collided&&w<.2,n=l}else n={collided:!1,bodyA:s,bodyB:c};if(l&&f){var S=n.axisBody,p=S===s?c:s,v=[S.axes[l.axisNumber]];if(e=t._overlapAxes(S.vertices,p.vertices,v),n.reused=!0,e.overlap<=0)return n.collided=!1,n}else{if(h=t._overlapAxes(s.vertices,c.vertices,s.axes),h.overlap<=0||(o=t._overlapAxes(c.vertices,s.vertices,c.axes),o.overlap<=0))return n.collided=!1,n;h.overlap<o.overlap?(e=h,n.axisBody=s):(e=o,n.axisBody=c),n.axisNumber=e.axisNumber}n.bodyA=s.id<c.id?s:c,n.bodyB=s.id<c.id?c:s,n.collided=!0,n.depth=e.overlap,n.parentA=n.bodyA.parent,n.parentB=n.bodyB.parent,s=n.bodyA,c=n.bodyB,i.dot(e.axis,i.sub(c.position,s.position))<0?n.normal={x:e.axis.x,y:e.axis.y}:n.normal={x:-e.axis.x,y:-e.axis.y},n.tangent=i.perp(n.normal),n.penetration=n.penetration||{},n.penetration.x=n.normal.x*n.depth,n.penetration.y=n.normal.y*n.depth;var m=t._findSupports(s,c,n.normal),g=[];if(a.contains(s.vertices,m[0])&&g.push(m[0]),a.contains(s.vertices,m[1])&&g.push(m[1]),g.length<2){var M=t._findSupports(c,s,i.neg(n.normal));a.contains(c.vertices,M[0])&&g.push(M[0]),g.length<2&&a.contains(c.vertices,M[1])&&g.push(M[1])}return g.length<1&&(g=[m[0]]),n.supports=g,n},t._overlapAxes=function(s,c,l){for(var h=i._temp[0],o=i._temp[1],e={overlap:Number.MAX_VALUE},n,f,u=0;u<l.length;u++){if(f=l[u],t._projectToAxis(h,s,f),t._projectToAxis(o,c,f),n=Math.min(h.max-o.min,o.max-h.min),n<=0)return e.overlap=n,e;n<e.overlap&&(e.overlap=n,e.axis=f,e.axisNumber=u)}return e},t._projectToAxis=function(s,c,l){for(var h=i.dot(c[0],l),o=h,e=1;e<c.length;e+=1){var n=i.dot(c[e],l);n>o?o=n:n<h&&(h=n)}s.min=h,s.max=o},t._findSupports=function(s,c,l){for(var h=Number.MAX_VALUE,o=i._temp[0],e=c.vertices,n=s.position,f,u,x,w,S=0;S<e.length;S++)u=e[S],o.x=u.x-n.x,o.y=u.y-n.y,f=-i.dot(l,o),f<h&&(h=f,x=u);var p=x.index-1>=0?x.index-1:e.length-1;u=e[p],o.x=u.x-n.x,o.y=u.y-n.y,h=-i.dot(l,o),w=u;var v=(x.index+1)%e.length;return u=e[v],o.x=u.x-n.x,o.y=u.y-n.y,f=-i.dot(l,o),f<h&&(w=u),[x,w]}})()},function(y,P,r){var t={};y.exports=t;var a=r(0);(function(){t._registry={},t.register=function(i){if(t.isPlugin(i)||a.warn("Plugin.register:",t.toString(i),"does not implement all required fields."),i.name in t._registry){var s=t._registry[i.name],c=t.versionParse(i.version).number,l=t.versionParse(s.version).number;c>l?(a.warn("Plugin.register:",t.toString(s),"was upgraded to",t.toString(i)),t._registry[i.name]=i):c<l?a.warn("Plugin.register:",t.toString(s),"can not be downgraded to",t.toString(i)):i!==s&&a.warn("Plugin.register:",t.toString(i),"is already registered to different plugin object")}else t._registry[i.name]=i;return i},t.resolve=function(i){return t._registry[t.dependencyParse(i).name]},t.toString=function(i){return typeof i=="string"?i:(i.name||"anonymous")+"@"+(i.version||i.range||"0.0.0")},t.isPlugin=function(i){return i&&i.name&&i.version&&i.install},t.isUsed=function(i,s){return i.used.indexOf(s)>-1},t.isFor=function(i,s){var c=i.for&&t.dependencyParse(i.for);return!i.for||s.name===c.name&&t.versionSatisfies(s.version,c.range)},t.use=function(i,s){if(i.uses=(i.uses||[]).concat(s||[]),i.uses.length===0){a.warn("Plugin.use:",t.toString(i),"does not specify any dependencies to install.");return}for(var c=t.dependencies(i),l=a.topologicalSort(c),h=[],o=0;o<l.length;o+=1)if(l[o]!==i.name){var e=t.resolve(l[o]);if(!e){h.push("❌ "+l[o]);continue}t.isUsed(i,e.name)||(t.isFor(e,i)||(a.warn("Plugin.use:",t.toString(e),"is for",e.for,"but installed on",t.toString(i)+"."),e._warned=!0),e.install?e.install(i):(a.warn("Plugin.use:",t.toString(e),"does not specify an install function."),e._warned=!0),e._warned?(h.push("🔶 "+t.toString(e)),delete e._warned):h.push("✅ "+t.toString(e)),i.used.push(e.name))}h.length>0&&a.info(h.join("  "))},t.dependencies=function(i,s){var c=t.dependencyParse(i),l=c.name;if(s=s||{},!(l in s)){i=t.resolve(i)||i,s[l]=a.map(i.uses||[],function(o){t.isPlugin(o)&&t.register(o);var e=t.dependencyParse(o),n=t.resolve(o);return n&&!t.versionSatisfies(n.version,e.range)?(a.warn("Plugin.dependencies:",t.toString(n),"does not satisfy",t.toString(e),"used by",t.toString(c)+"."),n._warned=!0,i._warned=!0):n||(a.warn("Plugin.dependencies:",t.toString(o),"used by",t.toString(c),"could not be resolved."),i._warned=!0),e.name});for(var h=0;h<s[l].length;h+=1)t.dependencies(s[l][h],s);return s}},t.dependencyParse=function(i){if(a.isString(i)){var s=/^[\w-]+(@(\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-]+)?))?$/;return s.test(i)||a.warn("Plugin.dependencyParse:",i,"is not a valid dependency string."),{name:i.split("@")[0],range:i.split("@")[1]||"*"}}return{name:i.name,range:i.range||i.version}},t.versionParse=function(i){var s=/^(\*)|(\^|~|>=|>)?\s*((\d+)\.(\d+)\.(\d+))(-[0-9A-Za-z-]+)?$/;s.test(i)||a.warn("Plugin.versionParse:",i,"is not a valid version or range.");var c=s.exec(i),l=Number(c[4]),h=Number(c[5]),o=Number(c[6]);return{isRange:!!(c[1]||c[2]),version:c[3],range:i,operator:c[1]||c[2]||"",major:l,minor:h,patch:o,parts:[l,h,o],prerelease:c[7],number:l*1e8+h*1e4+o}},t.versionSatisfies=function(i,s){s=s||"*";var c=t.versionParse(s),l=t.versionParse(i);if(c.isRange){if(c.operator==="*"||i==="*")return!0;if(c.operator===">")return l.number>c.number;if(c.operator===">=")return l.number>=c.number;if(c.operator==="~")return l.major===c.major&&l.minor===c.minor&&l.patch>=c.patch;if(c.operator==="^")return c.major>0?l.major===c.major&&l.number>=c.number:c.minor>0?l.minor===c.minor&&l.patch>=c.patch:l.patch===c.patch}return i===s||i==="*"}})()},function(y,P,r){var t={};y.exports=t;var a=r(0),i=r(5),s=r(1),c=r(4),l=r(2),h=r(12);(function(){var o,e;typeof window<"u"&&(o=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(p){window.setTimeout(function(){p(a.now())},1e3/60)},e=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),t._goodFps=30,t._goodDelta=1e3/60,t.create=function(p){var v={controller:t,engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,timing:{historySize:60,delta:0,deltaHistory:[],lastTime:0,lastTimestamp:0,lastElapsed:0,timestampElapsed:0,timestampElapsedHistory:[],engineDeltaHistory:[],engineElapsedHistory:[],elapsedHistory:[]},options:{width:800,height:600,pixelRatio:1,background:"#14151f",wireframeBackground:"#14151f",hasBounds:!!p.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showStats:!1,showPerformance:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},m=a.extend(v,p);return m.canvas&&(m.canvas.width=m.options.width||m.canvas.width,m.canvas.height=m.options.height||m.canvas.height),m.mouse=p.mouse,m.engine=p.engine,m.canvas=m.canvas||u(m.options.width,m.options.height),m.context=m.canvas.getContext("2d"),m.textures={},m.bounds=m.bounds||{min:{x:0,y:0},max:{x:m.canvas.width,y:m.canvas.height}},m.options.pixelRatio!==1&&t.setPixelRatio(m,m.options.pixelRatio),a.isElement(m.element)?m.element.appendChild(m.canvas):m.canvas.parentNode||a.log("Render.create: options.element was undefined, render.canvas was created but not appended","warn"),m},t.run=function(p){(function v(m){p.frameRequestId=o(v),n(p,m),t.world(p,m),(p.options.showStats||p.options.showDebug)&&t.stats(p,p.context,m),(p.options.showPerformance||p.options.showDebug)&&t.performance(p,p.context,m)})()},t.stop=function(p){e(p.frameRequestId)},t.setPixelRatio=function(p,v){var m=p.options,g=p.canvas;v==="auto"&&(v=x(g)),m.pixelRatio=v,g.setAttribute("data-pixel-ratio",v),g.width=m.width*v,g.height=m.height*v,g.style.width=m.width+"px",g.style.height=m.height+"px"},t.lookAt=function(p,v,m,g){g=typeof g<"u"?g:!0,v=a.isArray(v)?v:[v],m=m||{x:0,y:0};for(var M={min:{x:1/0,y:1/0},max:{x:-1/0,y:-1/0}},A=0;A<v.length;A+=1){var T=v[A],C=T.bounds?T.bounds.min:T.min||T.position||T,I=T.bounds?T.bounds.max:T.max||T.position||T;C&&I&&(C.x<M.min.x&&(M.min.x=C.x),I.x>M.max.x&&(M.max.x=I.x),C.y<M.min.y&&(M.min.y=C.y),I.y>M.max.y&&(M.max.y=I.y))}var k=M.max.x-M.min.x+2*m.x,W=M.max.y-M.min.y+2*m.y,E=p.canvas.height,B=p.canvas.width,R=B/E,V=k/W,N=1,H=1;V>R?H=V/R:N=R/V,p.options.hasBounds=!0,p.bounds.min.x=M.min.x,p.bounds.max.x=M.min.x+k*N,p.bounds.min.y=M.min.y,p.bounds.max.y=M.min.y+W*H,g&&(p.bounds.min.x+=k*.5-k*N*.5,p.bounds.max.x+=k*.5-k*N*.5,p.bounds.min.y+=W*.5-W*H*.5,p.bounds.max.y+=W*.5-W*H*.5),p.bounds.min.x-=m.x,p.bounds.max.x-=m.x,p.bounds.min.y-=m.y,p.bounds.max.y-=m.y,p.mouse&&(h.setScale(p.mouse,{x:(p.bounds.max.x-p.bounds.min.x)/p.canvas.width,y:(p.bounds.max.y-p.bounds.min.y)/p.canvas.height}),h.setOffset(p.mouse,p.bounds.min))},t.startViewTransform=function(p){var v=p.bounds.max.x-p.bounds.min.x,m=p.bounds.max.y-p.bounds.min.y,g=v/p.options.width,M=m/p.options.height;p.context.setTransform(p.options.pixelRatio/g,0,0,p.options.pixelRatio/M,0,0),p.context.translate(-p.bounds.min.x,-p.bounds.min.y)},t.endViewTransform=function(p){p.context.setTransform(p.options.pixelRatio,0,0,p.options.pixelRatio,0,0)},t.world=function(p,v){var m=a.now(),g=p.engine,M=g.world,A=p.canvas,T=p.context,C=p.options,I=p.timing,k=i.allBodies(M),W=i.allConstraints(M),E=C.wireframes?C.wireframeBackground:C.background,B=[],R=[],V,N={timestamp:g.timing.timestamp};if(c.trigger(p,"beforeRender",N),p.currentBackground!==E&&S(p,E),T.globalCompositeOperation="source-in",T.fillStyle="transparent",T.fillRect(0,0,A.width,A.height),T.globalCompositeOperation="source-over",C.hasBounds){for(V=0;V<k.length;V++){var H=k[V];s.overlaps(H.bounds,p.bounds)&&B.push(H)}for(V=0;V<W.length;V++){var F=W[V],X=F.bodyA,z=F.bodyB,$=F.pointA,U=F.pointB;X&&($=l.add(X.position,F.pointA)),z&&(U=l.add(z.position,F.pointB)),!(!$||!U)&&(s.contains(p.bounds,$)||s.contains(p.bounds,U))&&R.push(F)}t.startViewTransform(p),p.mouse&&(h.setScale(p.mouse,{x:(p.bounds.max.x-p.bounds.min.x)/p.options.width,y:(p.bounds.max.y-p.bounds.min.y)/p.options.height}),h.setOffset(p.mouse,p.bounds.min))}else R=W,B=k,p.options.pixelRatio!==1&&p.context.setTransform(p.options.pixelRatio,0,0,p.options.pixelRatio,0,0);!C.wireframes||g.enableSleeping&&C.showSleeping?t.bodies(p,B,T):(C.showConvexHulls&&t.bodyConvexHulls(p,B,T),t.bodyWireframes(p,B,T)),C.showBounds&&t.bodyBounds(p,B,T),(C.showAxes||C.showAngleIndicator)&&t.bodyAxes(p,B,T),C.showPositions&&t.bodyPositions(p,B,T),C.showVelocity&&t.bodyVelocity(p,B,T),C.showIds&&t.bodyIds(p,B,T),C.showSeparations&&t.separations(p,g.pairs.list,T),C.showCollisions&&t.collisions(p,g.pairs.list,T),C.showVertexNumbers&&t.vertexNumbers(p,B,T),C.showMousePosition&&t.mousePosition(p,p.mouse,T),t.constraints(R,T),C.showBroadphase&&t.grid(p,g.grid,T),C.hasBounds&&t.endViewTransform(p),c.trigger(p,"afterRender",N),I.lastElapsed=a.now()-m},t.stats=function(p,v,m){for(var g=p.engine,M=g.world,A=i.allBodies(M),T=0,C=55,I=44,k=0,W=0,E=0;E<A.length;E+=1)T+=A[E].parts.length;var B={Part:T,Body:A.length,Cons:i.allConstraints(M).length,Comp:i.allComposites(M).length,Pair:g.pairs.list.length};v.fillStyle="#0e0f19",v.fillRect(k,W,C*5.5,I),v.font="12px Arial",v.textBaseline="top",v.textAlign="right";for(var R in B){var V=B[R];v.fillStyle="#aaa",v.fillText(R,k+C,W+8),v.fillStyle="#eee",v.fillText(V,k+C,W+26),k+=C}},t.performance=function(p,v){var m=p.engine,g=p.timing,M=g.deltaHistory,A=g.elapsedHistory,T=g.timestampElapsedHistory,C=g.engineDeltaHistory,I=g.engineElapsedHistory,k=m.timing.lastDelta,W=f(M),E=f(A),B=f(C),R=f(I),V=f(T),N=V/W||0,H=1e3/W||0,F=4,X=12,z=60,$=34,U=10,Y=69;v.fillStyle="#0e0f19",v.fillRect(0,50,X*4+z*5+22,$),t.status(v,U,Y,z,F,M.length,Math.round(H)+" fps",H/t._goodFps,function(G){return M[G]/W-1}),t.status(v,U+X+z,Y,z,F,C.length,k.toFixed(2)+" dt",t._goodDelta/k,function(G){return C[G]/B-1}),t.status(v,U+(X+z)*2,Y,z,F,I.length,R.toFixed(2)+" ut",1-R/t._goodFps,function(G){return I[G]/R-1}),t.status(v,U+(X+z)*3,Y,z,F,A.length,E.toFixed(2)+" rt",1-E/t._goodFps,function(G){return A[G]/E-1}),t.status(v,U+(X+z)*4,Y,z,F,T.length,N.toFixed(2)+" x",N*N*N,function(G){return(T[G]/M[G]/N||0)-1})},t.status=function(p,v,m,g,M,A,T,C,I){p.strokeStyle="#888",p.fillStyle="#444",p.lineWidth=1,p.fillRect(v,m+7,g,1),p.beginPath(),p.moveTo(v,m+7-M*a.clamp(.4*I(0),-2,2));for(var k=0;k<g;k+=1)p.lineTo(v+k,m+7-(k<A?M*a.clamp(.4*I(k),-2,2):0));p.stroke(),p.fillStyle="hsl("+a.clamp(25+95*C,0,120)+",100%,60%)",p.fillRect(v,m-7,4,4),p.font="12px Arial",p.textBaseline="middle",p.textAlign="right",p.fillStyle="#eee",p.fillText(T,v+g,m-5)},t.constraints=function(p,v){for(var m=v,g=0;g<p.length;g++){var M=p[g];if(!(!M.render.visible||!M.pointA||!M.pointB)){var A=M.bodyA,T=M.bodyB,C,I;if(A?C=l.add(A.position,M.pointA):C=M.pointA,M.render.type==="pin")m.beginPath(),m.arc(C.x,C.y,3,0,2*Math.PI),m.closePath();else{if(T?I=l.add(T.position,M.pointB):I=M.pointB,m.beginPath(),m.moveTo(C.x,C.y),M.render.type==="spring")for(var k=l.sub(I,C),W=l.perp(l.normalise(k)),E=Math.ceil(a.clamp(M.length/5,12,20)),B,R=1;R<E;R+=1)B=R%2===0?1:-1,m.lineTo(C.x+k.x*(R/E)+W.x*B*4,C.y+k.y*(R/E)+W.y*B*4);m.lineTo(I.x,I.y)}M.render.lineWidth&&(m.lineWidth=M.render.lineWidth,m.strokeStyle=M.render.strokeStyle,m.stroke()),M.render.anchors&&(m.fillStyle=M.render.strokeStyle,m.beginPath(),m.arc(C.x,C.y,3,0,2*Math.PI),m.arc(I.x,I.y,3,0,2*Math.PI),m.closePath(),m.fill())}}},t.bodies=function(p,v,m){var g=m;p.engine;var M=p.options,A=M.showInternalEdges||!M.wireframes,T,C,I,k;for(I=0;I<v.length;I++)if(T=v[I],!!T.render.visible){for(k=T.parts.length>1?1:0;k<T.parts.length;k++)if(C=T.parts[k],!!C.render.visible){if(M.showSleeping&&T.isSleeping?g.globalAlpha=.5*C.render.opacity:C.render.opacity!==1&&(g.globalAlpha=C.render.opacity),C.render.sprite&&C.render.sprite.texture&&!M.wireframes){var W=C.render.sprite,E=w(p,W.texture);g.translate(C.position.x,C.position.y),g.rotate(C.angle),g.drawImage(E,E.width*-W.xOffset*W.xScale,E.height*-W.yOffset*W.yScale,E.width*W.xScale,E.height*W.yScale),g.rotate(-C.angle),g.translate(-C.position.x,-C.position.y)}else{if(C.circleRadius)g.beginPath(),g.arc(C.position.x,C.position.y,C.circleRadius,0,2*Math.PI);else{g.beginPath(),g.moveTo(C.vertices[0].x,C.vertices[0].y);for(var B=1;B<C.vertices.length;B++)!C.vertices[B-1].isInternal||A?g.lineTo(C.vertices[B].x,C.vertices[B].y):g.moveTo(C.vertices[B].x,C.vertices[B].y),C.vertices[B].isInternal&&!A&&g.moveTo(C.vertices[(B+1)%C.vertices.length].x,C.vertices[(B+1)%C.vertices.length].y);g.lineTo(C.vertices[0].x,C.vertices[0].y),g.closePath()}M.wireframes?(g.lineWidth=1,g.strokeStyle="#bbb",g.stroke()):(g.fillStyle=C.render.fillStyle,C.render.lineWidth&&(g.lineWidth=C.render.lineWidth,g.strokeStyle=C.render.strokeStyle,g.stroke()),g.fill())}g.globalAlpha=1}}},t.bodyWireframes=function(p,v,m){var g=m,M=p.options.showInternalEdges,A,T,C,I,k;for(g.beginPath(),C=0;C<v.length;C++)if(A=v[C],!!A.render.visible)for(k=A.parts.length>1?1:0;k<A.parts.length;k++){for(T=A.parts[k],g.moveTo(T.vertices[0].x,T.vertices[0].y),I=1;I<T.vertices.length;I++)!T.vertices[I-1].isInternal||M?g.lineTo(T.vertices[I].x,T.vertices[I].y):g.moveTo(T.vertices[I].x,T.vertices[I].y),T.vertices[I].isInternal&&!M&&g.moveTo(T.vertices[(I+1)%T.vertices.length].x,T.vertices[(I+1)%T.vertices.length].y);g.lineTo(T.vertices[0].x,T.vertices[0].y)}g.lineWidth=1,g.strokeStyle="#bbb",g.stroke()},t.bodyConvexHulls=function(p,v,m){var g=m,M,A,T;for(g.beginPath(),A=0;A<v.length;A++)if(M=v[A],!(!M.render.visible||M.parts.length===1)){for(g.moveTo(M.vertices[0].x,M.vertices[0].y),T=1;T<M.vertices.length;T++)g.lineTo(M.vertices[T].x,M.vertices[T].y);g.lineTo(M.vertices[0].x,M.vertices[0].y)}g.lineWidth=1,g.strokeStyle="rgba(255,255,255,0.2)",g.stroke()},t.vertexNumbers=function(p,v,m){var g=m,M,A,T;for(M=0;M<v.length;M++){var C=v[M].parts;for(T=C.length>1?1:0;T<C.length;T++){var I=C[T];for(A=0;A<I.vertices.length;A++)g.fillStyle="rgba(255,255,255,0.2)",g.fillText(M+"_"+A,I.position.x+(I.vertices[A].x-I.position.x)*.8,I.position.y+(I.vertices[A].y-I.position.y)*.8)}}},t.mousePosition=function(p,v,m){var g=m;g.fillStyle="rgba(255,255,255,0.8)",g.fillText(v.position.x+"  "+v.position.y,v.position.x+5,v.position.y-5)},t.bodyBounds=function(p,v,m){var g=m;p.engine;var M=p.options;g.beginPath();for(var A=0;A<v.length;A++){var T=v[A];if(T.render.visible)for(var C=v[A].parts,I=C.length>1?1:0;I<C.length;I++){var k=C[I];g.rect(k.bounds.min.x,k.bounds.min.y,k.bounds.max.x-k.bounds.min.x,k.bounds.max.y-k.bounds.min.y)}}M.wireframes?g.strokeStyle="rgba(255,255,255,0.08)":g.strokeStyle="rgba(0,0,0,0.1)",g.lineWidth=1,g.stroke()},t.bodyAxes=function(p,v,m){var g=m;p.engine;var M=p.options,A,T,C,I;for(g.beginPath(),T=0;T<v.length;T++){var k=v[T],W=k.parts;if(k.render.visible)if(M.showAxes)for(C=W.length>1?1:0;C<W.length;C++)for(A=W[C],I=0;I<A.axes.length;I++){var E=A.axes[I];g.moveTo(A.position.x,A.position.y),g.lineTo(A.position.x+E.x*20,A.position.y+E.y*20)}else for(C=W.length>1?1:0;C<W.length;C++)for(A=W[C],I=0;I<A.axes.length;I++)g.moveTo(A.position.x,A.position.y),g.lineTo((A.vertices[0].x+A.vertices[A.vertices.length-1].x)/2,(A.vertices[0].y+A.vertices[A.vertices.length-1].y)/2)}M.wireframes?(g.strokeStyle="indianred",g.lineWidth=1):(g.strokeStyle="rgba(255, 255, 255, 0.4)",g.globalCompositeOperation="overlay",g.lineWidth=2),g.stroke(),g.globalCompositeOperation="source-over"},t.bodyPositions=function(p,v,m){var g=m;p.engine;var M=p.options,A,T,C,I;for(g.beginPath(),C=0;C<v.length;C++)if(A=v[C],!!A.render.visible)for(I=0;I<A.parts.length;I++)T=A.parts[I],g.arc(T.position.x,T.position.y,3,0,2*Math.PI,!1),g.closePath();for(M.wireframes?g.fillStyle="indianred":g.fillStyle="rgba(0,0,0,0.5)",g.fill(),g.beginPath(),C=0;C<v.length;C++)A=v[C],A.render.visible&&(g.arc(A.positionPrev.x,A.positionPrev.y,2,0,2*Math.PI,!1),g.closePath());g.fillStyle="rgba(255,165,0,0.8)",g.fill()},t.bodyVelocity=function(p,v,m){var g=m;g.beginPath();for(var M=0;M<v.length;M++){var A=v[M];A.render.visible&&(g.moveTo(A.position.x,A.position.y),g.lineTo(A.position.x+(A.position.x-A.positionPrev.x)*2,A.position.y+(A.position.y-A.positionPrev.y)*2))}g.lineWidth=3,g.strokeStyle="cornflowerblue",g.stroke()},t.bodyIds=function(p,v,m){var g=m,M,A;for(M=0;M<v.length;M++)if(v[M].render.visible){var T=v[M].parts;for(A=T.length>1?1:0;A<T.length;A++){var C=T[A];g.font="12px Arial",g.fillStyle="rgba(255,255,255,0.5)",g.fillText(C.id,C.position.x+10,C.position.y-10)}}},t.collisions=function(p,v,m){var g=m,M=p.options,A,T,C,I;for(g.beginPath(),C=0;C<v.length;C++)if(A=v[C],!!A.isActive)for(T=A.collision,I=0;I<A.activeContacts.length;I++){var k=A.activeContacts[I],W=k.vertex;g.rect(W.x-1.5,W.y-1.5,3.5,3.5)}for(M.wireframes?g.fillStyle="rgba(255,255,255,0.7)":g.fillStyle="orange",g.fill(),g.beginPath(),C=0;C<v.length;C++)if(A=v[C],!!A.isActive&&(T=A.collision,A.activeContacts.length>0)){var E=A.activeContacts[0].vertex.x,B=A.activeContacts[0].vertex.y;A.activeContacts.length===2&&(E=(A.activeContacts[0].vertex.x+A.activeContacts[1].vertex.x)/2,B=(A.activeContacts[0].vertex.y+A.activeContacts[1].vertex.y)/2),T.bodyB===T.supports[0].body||T.bodyA.isStatic===!0?g.moveTo(E-T.normal.x*8,B-T.normal.y*8):g.moveTo(E+T.normal.x*8,B+T.normal.y*8),g.lineTo(E,B)}M.wireframes?g.strokeStyle="rgba(255,165,0,0.7)":g.strokeStyle="orange",g.lineWidth=1,g.stroke()},t.separations=function(p,v,m){var g=m,M=p.options,A,T,C,I,k;for(g.beginPath(),k=0;k<v.length;k++)if(A=v[k],!!A.isActive){T=A.collision,C=T.bodyA,I=T.bodyB;var W=1;!I.isStatic&&!C.isStatic&&(W=.5),I.isStatic&&(W=0),g.moveTo(I.position.x,I.position.y),g.lineTo(I.position.x-T.penetration.x*W,I.position.y-T.penetration.y*W),W=1,!I.isStatic&&!C.isStatic&&(W=.5),C.isStatic&&(W=0),g.moveTo(C.position.x,C.position.y),g.lineTo(C.position.x+T.penetration.x*W,C.position.y+T.penetration.y*W)}M.wireframes?g.strokeStyle="rgba(255,165,0,0.5)":g.strokeStyle="orange",g.stroke()},t.grid=function(p,v,m){var g=m,M=p.options;M.wireframes?g.strokeStyle="rgba(255,180,0,0.1)":g.strokeStyle="rgba(255,180,0,0.5)",g.beginPath();for(var A=a.keys(v.buckets),T=0;T<A.length;T++){var C=A[T];if(!(v.buckets[C].length<2)){var I=C.split(/C|R/);g.rect(.5+parseInt(I[1],10)*v.bucketWidth,.5+parseInt(I[2],10)*v.bucketHeight,v.bucketWidth,v.bucketHeight)}}g.lineWidth=1,g.stroke()},t.inspector=function(p,v){p.engine;var m=p.selected,g=p.render,M=g.options,A;if(M.hasBounds){var T=g.bounds.max.x-g.bounds.min.x,C=g.bounds.max.y-g.bounds.min.y,I=T/g.options.width,k=C/g.options.height;v.scale(1/I,1/k),v.translate(-g.bounds.min.x,-g.bounds.min.y)}for(var W=0;W<m.length;W++){var E=m[W].data;switch(v.translate(.5,.5),v.lineWidth=1,v.strokeStyle="rgba(255,165,0,0.9)",v.setLineDash([1,2]),E.type){case"body":A=E.bounds,v.beginPath(),v.rect(Math.floor(A.min.x-3),Math.floor(A.min.y-3),Math.floor(A.max.x-A.min.x+6),Math.floor(A.max.y-A.min.y+6)),v.closePath(),v.stroke();break;case"constraint":var B=E.pointA;E.bodyA&&(B=E.pointB),v.beginPath(),v.arc(B.x,B.y,10,0,2*Math.PI),v.closePath(),v.stroke();break}v.setLineDash([]),v.translate(-.5,-.5)}p.selectStart!==null&&(v.translate(.5,.5),v.lineWidth=1,v.strokeStyle="rgba(255,165,0,0.6)",v.fillStyle="rgba(255,165,0,0.1)",A=p.selectBounds,v.beginPath(),v.rect(Math.floor(A.min.x),Math.floor(A.min.y),Math.floor(A.max.x-A.min.x),Math.floor(A.max.y-A.min.y)),v.closePath(),v.stroke(),v.fill(),v.translate(-.5,-.5)),M.hasBounds&&v.setTransform(1,0,0,1,0,0)};var n=function(p,v){var m=p.engine,g=p.timing,M=g.historySize,A=m.timing.timestamp;g.delta=v-g.lastTime||t._goodDelta,g.lastTime=v,g.timestampElapsed=A-g.lastTimestamp||0,g.lastTimestamp=A,g.deltaHistory.unshift(g.delta),g.deltaHistory.length=Math.min(g.deltaHistory.length,M),g.engineDeltaHistory.unshift(m.timing.lastDelta),g.engineDeltaHistory.length=Math.min(g.engineDeltaHistory.length,M),g.timestampElapsedHistory.unshift(g.timestampElapsed),g.timestampElapsedHistory.length=Math.min(g.timestampElapsedHistory.length,M),g.engineElapsedHistory.unshift(m.timing.lastElapsed),g.engineElapsedHistory.length=Math.min(g.engineElapsedHistory.length,M),g.elapsedHistory.unshift(g.lastElapsed),g.elapsedHistory.length=Math.min(g.elapsedHistory.length,M)},f=function(p){for(var v=0,m=0;m<p.length;m+=1)v+=p[m];return v/p.length||0},u=function(p,v){var m=document.createElement("canvas");return m.width=p,m.height=v,m.oncontextmenu=function(){return!1},m.onselectstart=function(){return!1},m},x=function(p){var v=p.getContext("2d"),m=window.devicePixelRatio||1,g=v.webkitBackingStorePixelRatio||v.mozBackingStorePixelRatio||v.msBackingStorePixelRatio||v.oBackingStorePixelRatio||v.backingStorePixelRatio||1;return m/g},w=function(p,v){var m=p.textures[v];return m||(m=p.textures[v]=new Image,m.src=v,m)},S=function(p,v){var m=v;/(jpg|gif|png)$/.test(v)&&(m="url("+v+")"),p.canvas.style.background=m,p.canvas.style.backgroundSize="contain",p.currentBackground=v}})()},function(y,P){var r={};y.exports=r,function(){r.create=function(t){return{id:r.id(t),vertex:t,normalImpulse:0,tangentImpulse:0}},r.id=function(t){return t.body.id+"_"+t.index}}()},function(y,P,r){var t={};y.exports=t;var a=r(7),i=r(19),s=r(13),c=r(20),l=r(21),h=r(4),o=r(5),e=r(8),n=r(0),f=r(6);(function(){t.create=function(u){u=u||{};var x={positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],plugin:{},grid:null,gravity:{x:0,y:1,scale:.001},timing:{timestamp:0,timeScale:1,lastDelta:0,lastElapsed:0}},w=n.extend(x,u);return w.world=u.world||o.create({label:"World"}),w.grid=l.create(u.grid||u.broadphase),w.pairs=c.create(),w.world.gravity=w.gravity,w.broadphase=w.grid,w.metrics={},w},t.update=function(u,x,w){var S=n.now();x=x||1e3/60,w=w||1;var p=u.world,v=u.timing,m=u.grid,g=[],M;v.timestamp+=x*v.timeScale,v.lastDelta=x*v.timeScale;var A={timestamp:v.timestamp};h.trigger(u,"beforeUpdate",A);var T=o.allBodies(p),C=o.allConstraints(p);for(u.enableSleeping&&a.update(T,v.timeScale),t._bodiesApplyGravity(T,u.gravity),t._bodiesUpdate(T,x,v.timeScale,w,p.bounds),e.preSolveAll(T),M=0;M<u.constraintIterations;M++)e.solveAll(C,v.timeScale);e.postSolveAll(T),p.isModified&&l.clear(m),l.update(m,T,u,p.isModified),g=m.pairsList,p.isModified&&o.setModified(p,!1,!1,!0);var I=s.collisions(g,u),k=u.pairs,W=v.timestamp;for(c.update(k,I,W),c.removeOld(k,W),u.enableSleeping&&a.afterCollisions(k.list,v.timeScale),k.collisionStart.length>0&&h.trigger(u,"collisionStart",{pairs:k.collisionStart}),i.preSolvePosition(k.list),M=0;M<u.positionIterations;M++)i.solvePosition(k.list,v.timeScale);for(i.postSolvePosition(T),e.preSolveAll(T),M=0;M<u.constraintIterations;M++)e.solveAll(C,v.timeScale);for(e.postSolveAll(T),i.preSolveVelocity(k.list),M=0;M<u.velocityIterations;M++)i.solveVelocity(k.list,v.timeScale);return k.collisionActive.length>0&&h.trigger(u,"collisionActive",{pairs:k.collisionActive}),k.collisionEnd.length>0&&h.trigger(u,"collisionEnd",{pairs:k.collisionEnd}),t._bodiesClearForces(T),h.trigger(u,"afterUpdate",A),u.timing.lastElapsed=n.now()-S,u},t.merge=function(u,x){if(n.extend(u,x),x.world){u.world=x.world,t.clear(u);for(var w=o.allBodies(u.world),S=0;S<w.length;S++){var p=w[S];a.set(p,!1),p.id=n.nextId()}}},t.clear=function(u){var x=u.world,w=o.allBodies(x);c.clear(u.pairs),l.clear(u.grid),l.update(u.grid,w,u,!0)},t._bodiesClearForces=function(u){for(var x=0;x<u.length;x++){var w=u[x];w.force.x=0,w.force.y=0,w.torque=0}},t._bodiesApplyGravity=function(u,x){var w=typeof x.scale<"u"?x.scale:.001;if(!(x.x===0&&x.y===0||w===0))for(var S=0;S<u.length;S++){var p=u[S];p.isStatic||p.isSleeping||(p.force.y+=p.mass*x.y*w,p.force.x+=p.mass*x.x*w)}},t._bodiesUpdate=function(u,x,w,S,p){for(var v=0;v<u.length;v++){var m=u[v];m.isStatic||m.isSleeping||f.update(m,x,w,S)}}})()},function(y,P,r){var t={};y.exports=t;var a=r(3),i=r(2),s=r(0),c=r(1);(function(){t._restingThresh=4,t._restingThreshTangent=6,t._positionDampen=.9,t._positionWarming=.8,t._frictionNormalMultiplier=5,t.preSolvePosition=function(l){var h,o,e;for(h=0;h<l.length;h++)o=l[h],o.isActive&&(e=o.activeContacts.length,o.collision.parentA.totalContacts+=e,o.collision.parentB.totalContacts+=e)},t.solvePosition=function(l,h){var o,e,n,f,u,x,w,S,p,v=i._temp[0],m=i._temp[1],g=i._temp[2],M=i._temp[3];for(o=0;o<l.length;o++)e=l[o],!(!e.isActive||e.isSensor)&&(n=e.collision,f=n.parentA,u=n.parentB,x=n.normal,w=i.sub(i.add(u.positionImpulse,u.position,v),i.add(f.positionImpulse,i.sub(u.position,n.penetration,m),g),M),e.separation=i.dot(x,w));for(o=0;o<l.length;o++)e=l[o],!(!e.isActive||e.isSensor)&&(n=e.collision,f=n.parentA,u=n.parentB,x=n.normal,p=(e.separation-e.slop)*h,(f.isStatic||u.isStatic)&&(p*=2),f.isStatic||f.isSleeping||(S=t._positionDampen/f.totalContacts,f.positionImpulse.x+=x.x*p*S,f.positionImpulse.y+=x.y*p*S),u.isStatic||u.isSleeping||(S=t._positionDampen/u.totalContacts,u.positionImpulse.x-=x.x*p*S,u.positionImpulse.y-=x.y*p*S))},t.postSolvePosition=function(l){for(var h=0;h<l.length;h++){var o=l[h];if(o.totalContacts=0,o.positionImpulse.x!==0||o.positionImpulse.y!==0){for(var e=0;e<o.parts.length;e++){var n=o.parts[e];a.translate(n.vertices,o.positionImpulse),c.update(n.bounds,n.vertices,o.velocity),n.position.x+=o.positionImpulse.x,n.position.y+=o.positionImpulse.y}o.positionPrev.x+=o.positionImpulse.x,o.positionPrev.y+=o.positionImpulse.y,i.dot(o.positionImpulse,o.velocity)<0?(o.positionImpulse.x=0,o.positionImpulse.y=0):(o.positionImpulse.x*=t._positionWarming,o.positionImpulse.y*=t._positionWarming)}}},t.preSolveVelocity=function(l){var h,o,e,n,f,u,x,w,S,p,v,m,g,M,A=i._temp[0],T=i._temp[1];for(h=0;h<l.length;h++)if(e=l[h],!(!e.isActive||e.isSensor))for(n=e.activeContacts,f=e.collision,u=f.parentA,x=f.parentB,w=f.normal,S=f.tangent,o=0;o<n.length;o++)p=n[o],v=p.vertex,m=p.normalImpulse,g=p.tangentImpulse,(m!==0||g!==0)&&(A.x=w.x*m+S.x*g,A.y=w.y*m+S.y*g,u.isStatic||u.isSleeping||(M=i.sub(v,u.position,T),u.positionPrev.x+=A.x*u.inverseMass,u.positionPrev.y+=A.y*u.inverseMass,u.anglePrev+=i.cross(M,A)*u.inverseInertia),x.isStatic||x.isSleeping||(M=i.sub(v,x.position,T),x.positionPrev.x-=A.x*x.inverseMass,x.positionPrev.y-=A.y*x.inverseMass,x.anglePrev-=i.cross(M,A)*x.inverseInertia))},t.solveVelocity=function(l,h){for(var o=h*h,e=i._temp[0],n=i._temp[1],f=i._temp[2],u=i._temp[3],x=i._temp[4],w=i._temp[5],S=0;S<l.length;S++){var p=l[S];if(!(!p.isActive||p.isSensor)){var v=p.collision,m=v.parentA,g=v.parentB,M=v.normal,A=v.tangent,T=p.activeContacts,C=1/T.length;m.velocity.x=m.position.x-m.positionPrev.x,m.velocity.y=m.position.y-m.positionPrev.y,g.velocity.x=g.position.x-g.positionPrev.x,g.velocity.y=g.position.y-g.positionPrev.y,m.angularVelocity=m.angle-m.anglePrev,g.angularVelocity=g.angle-g.anglePrev;for(var I=0;I<T.length;I++){var k=T[I],W=k.vertex,E=i.sub(W,m.position,n),B=i.sub(W,g.position,f),R=i.add(m.velocity,i.mult(i.perp(E),m.angularVelocity),u),V=i.add(g.velocity,i.mult(i.perp(B),g.angularVelocity),x),N=i.sub(R,V,w),H=i.dot(M,N),F=i.dot(A,N),X=Math.abs(F),z=s.sign(F),$=(1+p.restitution)*H,U=s.clamp(p.separation+H,0,1)*t._frictionNormalMultiplier,Y=F,G=1/0;X>p.friction*p.frictionStatic*U*o&&(G=X,Y=s.clamp(p.friction*z*o,-G,G));var tt=i.cross(E,M),et=i.cross(B,M),it=C/(m.inverseMass+g.inverseMass+m.inverseInertia*tt*tt+g.inverseInertia*et*et);if($*=it,Y*=it,H<0&&H*H>t._restingThresh*o)k.normalImpulse=0;else{var at=k.normalImpulse;k.normalImpulse=Math.min(k.normalImpulse+$,0),$=k.normalImpulse-at}if(F*F>t._restingThreshTangent*o)k.tangentImpulse=0;else{var rt=k.tangentImpulse;k.tangentImpulse=s.clamp(k.tangentImpulse+Y,-G,G),Y=k.tangentImpulse-rt}e.x=M.x*$+A.x*Y,e.y=M.y*$+A.y*Y,m.isStatic||m.isSleeping||(m.positionPrev.x+=e.x*m.inverseMass,m.positionPrev.y+=e.y*m.inverseMass,m.anglePrev+=i.cross(E,e)*m.inverseInertia),g.isStatic||g.isSleeping||(g.positionPrev.x-=e.x*g.inverseMass,g.positionPrev.y-=e.y*g.inverseMass,g.anglePrev-=i.cross(B,e)*g.inverseInertia)}}}}})()},function(y,P,r){var t={};y.exports=t;var a=r(9),i=r(0);(function(){t._pairMaxIdleLife=1e3,t.create=function(s){return i.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},s)},t.update=function(s,c,l){var h=s.list,o=s.table,e=s.collisionStart,n=s.collisionEnd,f=s.collisionActive,u,x,w,S;for(e.length=0,n.length=0,f.length=0,S=0;S<h.length;S++)h[S].confirmedActive=!1;for(S=0;S<c.length;S++)u=c[S],u.collided&&(x=a.id(u.bodyA,u.bodyB),w=o[x],w?(w.isActive?f.push(w):e.push(w),a.update(w,u,l),w.confirmedActive=!0):(w=a.create(u,l),o[x]=w,e.push(w),h.push(w)));for(S=0;S<h.length;S++)w=h[S],w.isActive&&!w.confirmedActive&&(a.setActive(w,!1,l),n.push(w))},t.removeOld=function(s,c){var l=s.list,h=s.table,o=[],e,n,f,u;for(u=0;u<l.length;u++){if(e=l[u],n=e.collision,n.bodyA.isSleeping||n.bodyB.isSleeping){e.timeUpdated=c;continue}c-e.timeUpdated>t._pairMaxIdleLife&&o.push(u)}for(u=0;u<o.length;u++)f=o[u]-u,e=l[f],delete h[e.id],l.splice(f,1)},t.clear=function(s){return s.table={},s.list.length=0,s.collisionStart.length=0,s.collisionActive.length=0,s.collisionEnd.length=0,s}})()},function(y,P,r){var t={};y.exports=t;var a=r(9),i=r(0);(function(){t.create=function(s){var c={buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48};return i.extend(c,s)},t.update=function(s,c,l,h){var o,e,n,f=l.world,u=s.buckets,x,w,S=!1;for(o=0;o<c.length;o++){var p=c[o];if(!(p.isSleeping&&!h)&&!(f.bounds&&(p.bounds.max.x<f.bounds.min.x||p.bounds.min.x>f.bounds.max.x||p.bounds.max.y<f.bounds.min.y||p.bounds.min.y>f.bounds.max.y))){var v=t._getRegion(s,p);if(!p.region||v.id!==p.region.id||h){(!p.region||h)&&(p.region=v);var m=t._regionUnion(v,p.region);for(e=m.startCol;e<=m.endCol;e++)for(n=m.startRow;n<=m.endRow;n++){w=t._getBucketId(e,n),x=u[w];var g=e>=v.startCol&&e<=v.endCol&&n>=v.startRow&&n<=v.endRow,M=e>=p.region.startCol&&e<=p.region.endCol&&n>=p.region.startRow&&n<=p.region.endRow;!g&&M&&M&&x&&t._bucketRemoveBody(s,x,p),(p.region===v||g&&!M||h)&&(x||(x=t._createBucket(u,w)),t._bucketAddBody(s,x,p))}p.region=v,S=!0}}}S&&(s.pairsList=t._createActivePairsList(s))},t.clear=function(s){s.buckets={},s.pairs={},s.pairsList=[]},t._regionUnion=function(s,c){var l=Math.min(s.startCol,c.startCol),h=Math.max(s.endCol,c.endCol),o=Math.min(s.startRow,c.startRow),e=Math.max(s.endRow,c.endRow);return t._createRegion(l,h,o,e)},t._getRegion=function(s,c){var l=c.bounds,h=Math.floor(l.min.x/s.bucketWidth),o=Math.floor(l.max.x/s.bucketWidth),e=Math.floor(l.min.y/s.bucketHeight),n=Math.floor(l.max.y/s.bucketHeight);return t._createRegion(h,o,e,n)},t._createRegion=function(s,c,l,h){return{id:s+","+c+","+l+","+h,startCol:s,endCol:c,startRow:l,endRow:h}},t._getBucketId=function(s,c){return"C"+s+"R"+c},t._createBucket=function(s,c){var l=s[c]=[];return l},t._bucketAddBody=function(s,c,l){for(var h=0;h<c.length;h++){var o=c[h];if(!(l.id===o.id||l.isStatic&&o.isStatic)){var e=a.id(l,o),n=s.pairs[e];n?n[2]+=1:s.pairs[e]=[l,o,1]}}c.push(l)},t._bucketRemoveBody=function(s,c,l){c.splice(i.indexOf(c,l),1);for(var h=0;h<c.length;h++){var o=c[h],e=a.id(l,o),n=s.pairs[e];n&&(n[2]-=1)}},t._createActivePairsList=function(s){var c,l,h=[];c=i.keys(s.pairs);for(var o=0;o<c.length;o++)l=s.pairs[c[o]],l[2]>0?h.push(l):delete s.pairs[c[o]];return h}})()},function(y,P,r){var t=y.exports=r(23);t.Axes=r(10),t.Bodies=r(11),t.Body=r(6),t.Bounds=r(1),t.Common=r(0),t.Composite=r(5),t.Composites=r(24),t.Constraint=r(8),t.Contact=r(17),t.Detector=r(13),t.Engine=r(18),t.Events=r(4),t.Grid=r(21),t.Mouse=r(12),t.MouseConstraint=r(25),t.Pair=r(9),t.Pairs=r(20),t.Plugin=r(15),t.Query=r(26),t.Render=r(16),t.Resolver=r(19),t.Runner=r(27),t.SAT=r(14),t.Sleeping=r(7),t.Svg=r(28),t.Vector=r(2),t.Vertices=r(3),t.World=r(29),t.Engine.run=t.Runner.run,t.Common.deprecated(t.Engine,"run","Engine.run ➤ use Matter.Runner.run(engine) instead")},function(y,P,r){var t={};y.exports=t;var a=r(15),i=r(0);(function(){t.name="matter-js",t.version="0.17.1",t.uses=[],t.used=[],t.use=function(){a.use(t,Array.prototype.slice.call(arguments))},t.before=function(s,c){return s=s.replace(/^Matter./,""),i.chainPathBefore(t,s,c)},t.after=function(s,c){return s=s.replace(/^Matter./,""),i.chainPathAfter(t,s,c)}})()},function(y,P,r){var t={};y.exports=t;var a=r(5),i=r(8),s=r(0),c=r(6),l=r(11),h=s.deprecated;(function(){t.stack=function(o,e,n,f,u,x,w){for(var S=a.create({label:"Stack"}),p=o,v=e,m,g=0,M=0;M<f;M++){for(var A=0,T=0;T<n;T++){var C=w(p,v,T,M,m,g);if(C){var I=C.bounds.max.y-C.bounds.min.y,k=C.bounds.max.x-C.bounds.min.x;I>A&&(A=I),c.translate(C,{x:k*.5,y:I*.5}),p=C.bounds.max.x+u,a.addBody(S,C),m=C,g+=1}else p+=u}v+=A+x,p=o}return S},t.chain=function(o,e,n,f,u,x){for(var w=o.bodies,S=1;S<w.length;S++){var p=w[S-1],v=w[S],m=p.bounds.max.y-p.bounds.min.y,g=p.bounds.max.x-p.bounds.min.x,M=v.bounds.max.y-v.bounds.min.y,A=v.bounds.max.x-v.bounds.min.x,T={bodyA:p,pointA:{x:g*e,y:m*n},bodyB:v,pointB:{x:A*f,y:M*u}},C=s.extend(T,x);a.addConstraint(o,i.create(C))}return o.label+=" Chain",o},t.mesh=function(o,e,n,f,u){var x=o.bodies,w,S,p,v,m;for(w=0;w<n;w++){for(S=1;S<e;S++)p=x[S-1+w*e],v=x[S+w*e],a.addConstraint(o,i.create(s.extend({bodyA:p,bodyB:v},u)));if(w>0)for(S=0;S<e;S++)p=x[S+(w-1)*e],v=x[S+w*e],a.addConstraint(o,i.create(s.extend({bodyA:p,bodyB:v},u))),f&&S>0&&(m=x[S-1+(w-1)*e],a.addConstraint(o,i.create(s.extend({bodyA:m,bodyB:v},u)))),f&&S<e-1&&(m=x[S+1+(w-1)*e],a.addConstraint(o,i.create(s.extend({bodyA:m,bodyB:v},u))))}return o.label+=" Mesh",o},t.pyramid=function(o,e,n,f,u,x,w){return t.stack(o,e,n,f,u,x,function(S,p,v,m,g,M){var A=Math.min(f,Math.ceil(n/2)),T=g?g.bounds.max.x-g.bounds.min.x:0;if(!(m>A)){m=A-m;var C=m,I=n-1-m;if(!(v<C||v>I)){M===1&&c.translate(g,{x:(v+(n%2===1?1:-1))*T,y:0});var k=g?v*T:0;return w(o+k+v*u,p,v,m,g,M)}}})},t.newtonsCradle=function(o,e,n,f,u){for(var x=a.create({label:"Newtons Cradle"}),w=0;w<n;w++){var S=1.9,p=l.circle(o+w*(f*S),e+u,f,{inertia:1/0,restitution:1,friction:0,frictionAir:1e-4,slop:1}),v=i.create({pointA:{x:o+w*(f*S),y:e},bodyB:p});a.addBody(x,p),a.addConstraint(x,v)}return x},h(t,"newtonsCradle","Composites.newtonsCradle ➤ moved to newtonsCradle example"),t.car=function(o,e,n,f,u){var x=c.nextGroup(!0),w=20,S=-n*.5+w,p=n*.5-w,v=0,m=a.create({label:"Car"}),g=l.rectangle(o,e,n,f,{collisionFilter:{group:x},chamfer:{radius:f*.5},density:2e-4}),M=l.circle(o+S,e+v,u,{collisionFilter:{group:x},friction:.8}),A=l.circle(o+p,e+v,u,{collisionFilter:{group:x},friction:.8}),T=i.create({bodyB:g,pointB:{x:S,y:v},bodyA:M,stiffness:1,length:0}),C=i.create({bodyB:g,pointB:{x:p,y:v},bodyA:A,stiffness:1,length:0});return a.addBody(m,g),a.addBody(m,M),a.addBody(m,A),a.addConstraint(m,T),a.addConstraint(m,C),m},h(t,"car","Composites.car ➤ moved to car example"),t.softBody=function(o,e,n,f,u,x,w,S,p,v){p=s.extend({inertia:1/0},p),v=s.extend({stiffness:.2,render:{type:"line",anchors:!1}},v);var m=t.stack(o,e,n,f,u,x,function(g,M){return l.circle(g,M,S,p)});return t.mesh(m,n,f,w,v),m.label="Soft Body",m},h(t,"softBody","Composites.softBody ➤ moved to softBody and cloth examples")})()},function(y,P,r){var t={};y.exports=t;var a=r(3),i=r(7),s=r(12),c=r(4),l=r(13),h=r(8),o=r(5),e=r(0),n=r(1);(function(){t.create=function(f,u){var x=(f?f.mouse:null)||(u?u.mouse:null);x||(f&&f.render&&f.render.canvas?x=s.create(f.render.canvas):u&&u.element?x=s.create(u.element):(x=s.create(),e.warn("MouseConstraint.create: options.mouse was undefined, options.element was undefined, may not function as expected")));var w=h.create({label:"Mouse Constraint",pointA:x.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),S={type:"mouseConstraint",mouse:x,element:null,body:null,constraint:w,collisionFilter:{category:1,mask:4294967295,group:0}},p=e.extend(S,u);return c.on(f,"beforeUpdate",function(){var v=o.allBodies(f.world);t.update(p,v),t._triggerEvents(p)}),p},t.update=function(f,u){var x=f.mouse,w=f.constraint,S=f.body;if(x.button===0){if(w.bodyB)i.set(w.bodyB,!1),w.pointA=x.position;else for(var p=0;p<u.length;p++)if(S=u[p],n.contains(S.bounds,x.position)&&l.canCollide(S.collisionFilter,f.collisionFilter))for(var v=S.parts.length>1?1:0;v<S.parts.length;v++){var m=S.parts[v];if(a.contains(m.vertices,x.position)){w.pointA=x.position,w.bodyB=f.body=S,w.pointB={x:x.position.x-S.position.x,y:x.position.y-S.position.y},w.angleB=S.angle,i.set(S,!1),c.trigger(f,"startdrag",{mouse:x,body:S});break}}}else w.bodyB=f.body=null,w.pointB=null,S&&c.trigger(f,"enddrag",{mouse:x,body:S})},t._triggerEvents=function(f){var u=f.mouse,x=u.sourceEvents;x.mousemove&&c.trigger(f,"mousemove",{mouse:u}),x.mousedown&&c.trigger(f,"mousedown",{mouse:u}),x.mouseup&&c.trigger(f,"mouseup",{mouse:u}),s.clearSourceEvents(u)}})()},function(y,P,r){var t={};y.exports=t;var a=r(2),i=r(14),s=r(1),c=r(11),l=r(3);(function(){t.collides=function(h,o){for(var e=[],n=0;n<o.length;n++){var f=o[n];if(s.overlaps(f.bounds,h.bounds))for(var u=f.parts.length===1?0:1;u<f.parts.length;u++){var x=f.parts[u];if(s.overlaps(x.bounds,h.bounds)){var w=i.collides(x,h);if(w.collided){e.push(w);break}}}}return e},t.ray=function(h,o,e,n){n=n||1e-100;for(var f=a.angle(o,e),u=a.magnitude(a.sub(o,e)),x=(e.x+o.x)*.5,w=(e.y+o.y)*.5,S=c.rectangle(x,w,u,n,{angle:f}),p=t.collides(S,h),v=0;v<p.length;v+=1){var m=p[v];m.body=m.bodyB=m.bodyA}return p},t.region=function(h,o,e){for(var n=[],f=0;f<h.length;f++){var u=h[f],x=s.overlaps(u.bounds,o);(x&&!e||!x&&e)&&n.push(u)}return n},t.point=function(h,o){for(var e=[],n=0;n<h.length;n++){var f=h[n];if(s.contains(f.bounds,o))for(var u=f.parts.length===1?0:1;u<f.parts.length;u++){var x=f.parts[u];if(s.contains(x.bounds,o)&&l.contains(x.vertices,o)){e.push(f);break}}}return e}})()},function(y,P,r){var t={};y.exports=t;var a=r(4),i=r(18),s=r(0);(function(){var c,l;if(typeof window<"u"&&(c=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame,l=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),!c){var h;c=function(o){h=setTimeout(function(){o(s.now())},1e3/60)},l=function(){clearTimeout(h)}}t.create=function(o){var e={fps:60,correction:1,deltaSampleSize:60,counterTimestamp:0,frameCounter:0,deltaHistory:[],timePrev:null,timeScalePrev:1,frameRequestId:null,isFixed:!1,enabled:!0},n=s.extend(e,o);return n.delta=n.delta||1e3/n.fps,n.deltaMin=n.deltaMin||1e3/n.fps,n.deltaMax=n.deltaMax||1e3/(n.fps*.5),n.fps=1e3/n.delta,n},t.run=function(o,e){return typeof o.positionIterations<"u"&&(e=o,o=t.create()),function n(f){o.frameRequestId=c(n),f&&o.enabled&&t.tick(o,e,f)}(),o},t.tick=function(o,e,n){var f=e.timing,u=1,x,w={timestamp:f.timestamp};a.trigger(o,"beforeTick",w),o.isFixed?x=o.delta:(x=n-o.timePrev||o.delta,o.timePrev=n,o.deltaHistory.push(x),o.deltaHistory=o.deltaHistory.slice(-o.deltaSampleSize),x=Math.min.apply(null,o.deltaHistory),x=x<o.deltaMin?o.deltaMin:x,x=x>o.deltaMax?o.deltaMax:x,u=x/o.delta,o.delta=x),o.timeScalePrev!==0&&(u*=f.timeScale/o.timeScalePrev),f.timeScale===0&&(u=0),o.timeScalePrev=f.timeScale,o.correction=u,o.frameCounter+=1,n-o.counterTimestamp>=1e3&&(o.fps=o.frameCounter*((n-o.counterTimestamp)/1e3),o.counterTimestamp=n,o.frameCounter=0),a.trigger(o,"tick",w),a.trigger(o,"beforeUpdate",w),i.update(e,x,u),a.trigger(o,"afterUpdate",w),a.trigger(o,"afterTick",w)},t.stop=function(o){l(o.frameRequestId)},t.start=function(o,e){t.run(o,e)}})()},function(y,P,r){var t={};y.exports=t,r(1);var a=r(0);(function(){t.pathToVertices=function(i,s){typeof window<"u"&&!("SVGPathSeg"in window)&&a.warn("Svg.pathToVertices: SVGPathSeg not defined, a polyfill is required.");var c,l,h,o,e,n,f,u,x,w,S=[],p,v,m=0,g=0,M=0;s=s||15;var A=function(C,I,k){var W=k%2===1&&k>1;if(!x||C!=x.x||I!=x.y){x&&W?(p=x.x,v=x.y):(p=0,v=0);var E={x:p+C,y:v+I};(W||!x)&&(x=E),S.push(E),g=p+C,M=v+I}},T=function(C){var I=C.pathSegTypeAsLetter.toUpperCase();if(I!=="Z"){switch(I){case"M":case"L":case"T":case"C":case"S":case"Q":g=C.x,M=C.y;break;case"H":g=C.x;break;case"V":M=C.y;break}A(g,M,C.pathSegType)}};for(t._svgPathToAbsolute(i),h=i.getTotalLength(),n=[],c=0;c<i.pathSegList.numberOfItems;c+=1)n.push(i.pathSegList.getItem(c));for(f=n.concat();m<h;){if(w=i.getPathSegAtLength(m),e=n[w],e!=u){for(;f.length&&f[0]!=e;)T(f.shift());u=e}switch(e.pathSegTypeAsLetter.toUpperCase()){case"C":case"T":case"S":case"Q":case"A":o=i.getPointAtLength(m),A(o.x,o.y,0);break}m+=s}for(c=0,l=f.length;c<l;++c)T(f[c]);return S},t._svgPathToAbsolute=function(i){for(var s,c,l,h,o,e,n=i.pathSegList,f=0,u=0,x=n.numberOfItems,w=0;w<x;++w){var S=n.getItem(w),p=S.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(p))"x"in S&&(f=S.x),"y"in S&&(u=S.y);else switch("x1"in S&&(l=f+S.x1),"x2"in S&&(o=f+S.x2),"y1"in S&&(h=u+S.y1),"y2"in S&&(e=u+S.y2),"x"in S&&(f+=S.x),"y"in S&&(u+=S.y),p){case"m":n.replaceItem(i.createSVGPathSegMovetoAbs(f,u),w);break;case"l":n.replaceItem(i.createSVGPathSegLinetoAbs(f,u),w);break;case"h":n.replaceItem(i.createSVGPathSegLinetoHorizontalAbs(f),w);break;case"v":n.replaceItem(i.createSVGPathSegLinetoVerticalAbs(u),w);break;case"c":n.replaceItem(i.createSVGPathSegCurvetoCubicAbs(f,u,l,h,o,e),w);break;case"s":n.replaceItem(i.createSVGPathSegCurvetoCubicSmoothAbs(f,u,o,e),w);break;case"q":n.replaceItem(i.createSVGPathSegCurvetoQuadraticAbs(f,u,l,h),w);break;case"t":n.replaceItem(i.createSVGPathSegCurvetoQuadraticSmoothAbs(f,u),w);break;case"a":n.replaceItem(i.createSVGPathSegArcAbs(f,u,S.r1,S.r2,S.angle,S.largeArcFlag,S.sweepFlag),w);break;case"z":case"Z":f=s,u=c;break}(p=="M"||p=="m")&&(s=f,c=u)}}})()},function(y,P,r){var t={};y.exports=t;var a=r(5);r(0),function(){t.create=a.create,t.add=a.add,t.remove=a.remove,t.clear=a.clear,t.addComposite=a.addComposite,t.addBody=a.addBody,t.addConstraint=a.addConstraint}()}])})})(nt);var Z=nt.exports;const D=ft(Z);class ct{constructor(d,y){b(this,"position");b(this,"health");b(this,"body");b(this,"onShip");b(this,"atShipWheel");this.position={x:d,y},this.health=100,this.body=D.Bodies.circle(d,y,15,{label:"player",density:.002,frictionAir:.1}),this.onShip=!1,this.atShipWheel=!1}move(d,y){this.position.x+=d,this.position.y+=y}takeDamage(d){this.health-=d,this.health<0&&(this.health=0)}isAlive(){return this.health>0}setOnShip(d,y=!1){this.onShip=d,this.atShipWheel=y,D.Body.set(this.body,"isSensor",d&&y)}setAtShipWheel(d){this.onShip&&(this.atShipWheel=d,D.Body.set(this.body,"isSensor",d))}}class Q{constructor(d,y,P=0){b(this,"type");b(this,"position");b(this,"rotation");b(this,"health");b(this,"body");this.type=d,this.position={...y},this.rotation=P,this.health=100}update(){}use(){}takeDamage(d){this.health-=d,this.health<=0&&(this.health=0,this.onDestroy())}onDestroy(){}}class J extends Q{constructor(y,P=0){super("cannon",y,P);b(this,"turretAngle",0);b(this,"reloadTime",2e3);b(this,"lastFiredTime",0);b(this,"isLoaded",!0);b(this,"game",null)}setGame(y){this.game=y}update(){!this.isLoaded&&Date.now()-this.lastFiredTime>this.reloadTime&&(this.isLoaded=!0)}use(){this.isLoaded&&(this.isLoaded=!1,this.lastFiredTime=Date.now(),this.game&&this.game.createCannonball)}fire(y,P,r){const a=this.position.y<0?Math.PI:0,i=r+a+this.turretAngle;this.isLoaded=!1,this.lastFiredTime=Date.now();const s=40,c=y+Math.cos(i)*s,l=P+Math.sin(i)*s;return{x:c,y:l,angle:i}}}class K extends Q{constructor(y){super("sail",y,0);b(this,"openness",0);b(this,"angle",0)}setOpenness(y){this.openness=Math.max(0,Math.min(100,y))}open(y=10){this.setOpenness(this.openness+y)}close(y=10){this.setOpenness(this.openness-y)}rotate(y){this.angle=Math.max(-75,Math.min(75,this.angle+y))}centerAngle(y=1.25){this.angle>0?this.angle=Math.max(0,this.angle-y):this.angle<0&&(this.angle=Math.min(0,this.angle+y))}calculateEfficiency(y,P){const r=this.angle*Math.PI/180,t=P+r+Math.PI/2,a=Math.cos(t),i=Math.sin(t),s=Math.cos(y),c=Math.sin(y),l=s*a+c*i,o=Math.acos(Math.min(1,Math.max(-1,l)))*180/Math.PI;let e=0;o<=90?e=1-.65*o/90:e=.35;const n=this.openness/100;return e=Math.min(1,Math.max(.35,e))*n,e}update(){}use(){}}class st extends Q{constructor(y){super("wheel",y,0);b(this,"wheelAngle",0);b(this,"isPlayerControlling",!1)}setWheelAngle(y){this.wheelAngle=Math.max(-30,Math.min(30,y))}turnLeft(y=.5){this.setWheelAngle(this.wheelAngle-y)}turnRight(y=.5){this.setWheelAngle(this.wheelAngle+y)}centerWheel(y=.5){this.wheelAngle>0?this.wheelAngle=Math.max(0,this.wheelAngle-y):this.wheelAngle<0&&(this.wheelAngle=Math.min(0,this.wheelAngle+y))}setPlayerControlling(y){this.isPlayerControlling=y}update(){}use(){}}const L=class L{constructor(d,y,P,r,t){b(this,"position");b(this,"size");b(this,"speed");b(this,"health");b(this,"body");b(this,"modules",new Map);b(this,"cannons",new Map);b(this,"sails",new Map);b(this,"wheels",new Map);b(this,"planks",[]);b(this,"waterLevel",0);b(this,"rudderAngle",0);b(this,"sailsOpenness",0);b(this,"currentWindDirection",0);b(this,"currentWindPower",0);b(this,"forwardForce",0);b(this,"turningForce",0);b(this,"momentum",0);b(this,"path",null);b(this,"moduleVisualPositions",new Map);b(this,"playerAtWheel",!1);b(this,"game");this.position={x:d,y},this.speed=t,this.health=100,this.game=null,this.forwardForce=0,this.turningForce=0,this.momentum=0;const a=620;this.body=D.Bodies.rectangle(d,y,a,180,{label:"ship",density:5e-4,frictionAir:.05,friction:.03,restitution:.1,inertia:1/0,angle:0,sleepThreshold:15,slop:.05}),this.size={width:a,height:180},this.path=L.createHullPath(),this.createPlankStructure()}static createHullPath(){const d=L.HULL_POINTS,y=new Path2D;return y.moveTo(d.bow.x,d.bow.y),y.quadraticCurveTo(d.bowTip.x,d.bowTip.y,d.bow.x,d.bowBottom.y),y.lineTo(d.sternBottom.x,d.sternBottom.y),y.quadraticCurveTo(d.sternTip.x,d.sternTip.y,d.stern.x,d.stern.y),y.closePath(),y}createPlankStructure(){for(let y=0;y<40;y++){const P=y/40*Math.PI*2,r=225,t=90;this.addPlank(this.position.x+Math.cos(P)*r,this.position.y+Math.sin(P)*t)}for(let y=-150;y<=150;y+=50)this.addPlank(this.position.x+y,this.position.y),this.addPlank(this.position.x+y,this.position.y-40),this.addPlank(this.position.x+y,this.position.y+40)}addPlank(d,y){const r=D.Bodies.rectangle(d,y,15,15,{label:"plank",isSensor:!0,density:.001});this.planks.push({position:{x:d,y},health:100,body:r})}addModule(d,y){if(y instanceof Q){const r=y;return this.modules.set(d,r),r instanceof J?(this.cannons.set(d,r),r.setGame(this.game)):r instanceof K?this.sails.set(d,r):r instanceof st&&this.wheels.set(d,r),!0}const P=y;if(this.ensureModuleVisualPosition(d,P),this.modules.set(d,P),P.type==="cannon"){const r=new J(P.position,P.rotation);r.turretAngle=P.turretAngle||0,r.setGame(this.game),this.cannons.set(d,r)}else if(P.type==="sail"){const r=new K(P.position);r.openness=P.openness||0,r.angle=P.angle||0,this.sails.set(d,r)}else if(P.type==="wheel"){const r=new st(P.position);this.wheels.set(d,r)}return!0}ensureModuleVisualPosition(d,y){if(this.moduleVisualPositions.set(d,{...y.position}),y.type==="wheel"&&L.WHEEL.x===y.position.x&&L.WHEEL.y===y.position.y)y.position={x:L.WHEEL.x,y:L.WHEEL.y};else if(y.type==="sail"){const P=L.MASTS.find(r=>Math.abs(r.x-y.position.x)<20&&Math.abs(r.y-y.position.y)<20);P&&(y.position={x:P.x,y:P.y})}else if(y.type==="cannon"){const P=L.CANNONS.find(r=>Math.abs(r.x-y.position.x)<20&&Math.abs(r.y-y.position.y)<20);P&&(y.position={x:P.x,y:P.y})}}getModuleVisualPosition(d){if(this.moduleVisualPositions.has(d))return this.moduleVisualPositions.get(d);const y=this.modules.get(d);return y?y.position:{x:0,y:0}}removeModule(d){return this.modules.has(d)?(this.modules.delete(d),!0):!1}updateModules(){this.cannons.forEach(d=>d.update()),this.sails.forEach(d=>d.update()),this.wheels.forEach(d=>d.update()),this.modules.forEach((d,y)=>{d instanceof Q||(this.moduleVisualPositions.has(y)&&(d.type==="sail"||d.type==="cannon"||d.type==="wheel")&&this.ensureModuleVisualPosition(y,d),d.update())})}calculateWaterIntake(){let d=0;for(const y of this.planks)y.health<50&&d++;return d*.05}updateWaterLevel(){const d=this.calculateWaterIntake();this.waterLevel+=d,this.waterLevel>=100&&this.sink()}sink(){}damagePlank(d,y){d>=0&&d<this.planks.length&&(this.planks[d].health-=y,this.planks[d].health<0&&(this.planks[d].health=0))}applyRudder(d){const P=Math.sqrt(this.body.velocity.x**2+this.body.velocity.y**2);this.momentum=Math.min(1,this.momentum*.95+P*.01);const t=.5*(.5+Math.min(.7,P/3));switch(d){case"left":this.rudderAngle=Math.max(-30,this.rudderAngle-t);break;case"right":this.rudderAngle=Math.min(30,this.rudderAngle+t);break;case"center":this.rudderAngle>0?this.rudderAngle=Math.max(0,this.rudderAngle-t):this.rudderAngle<0&&(this.rudderAngle=Math.min(0,this.rudderAngle+t));break}if(this.wheels.size>0){const o=this.wheels.values().next().value;o&&o.setWheelAngle(this.rudderAngle)}let a=0,i=0;this.sails.forEach(o=>{o.openness>0&&(a+=o.openness,i+=1)});const s=i>0?a/(i*100):0,c=15e-6,l=Math.max(.3,1-this.momentum*.7),h=.3+.7*s;this.turningForce=this.rudderAngle*c*l*h,(P>.05||s>0)&&D.Body.setAngularVelocity(this.body,this.body.angularVelocity+this.turningForce),this.position.x=this.body.position.x,this.position.y=this.body.position.y}calculateSailEfficiency(){let d=0,y=0;return this.sails.forEach(P=>{if(P.openness>0){const r=P.angle,t=r*Math.PI/180,a=this.body.angle+t+Math.PI/2,i=Math.cos(a),s=Math.sin(a),c=this.currentWindDirection,l=Math.cos(c),h=Math.sin(c),o=l*i+h*s;let e=Math.acos(Math.min(1,Math.max(-1,o))),n=0;const f=e*180/Math.PI;f<=90?n=1-.65*f/90:n=.35,n=Math.min(1,Math.max(.35,n));const u=P.openness/100;let x=0;n>0&&(x=Math.min(.2,Math.abs(r)/75*.2)),d+=(n+x)*u,y++}}),y>0?Math.min(1.5,d/y):0}rotateSails(d){this.sails.forEach(P=>{switch(d){case"left":P.rotate(-1.25);break;case"right":P.rotate(1.25);break;case"center":P.centerAngle(1.25);break}})}fireCannon(d){this.cannons.size!==0&&this.cannons.forEach(y=>{if(y.use(),d){const P=L.CANNONS.find(h=>h.x===y.position.x&&h.y===y.position.y);if(!P)return;const t=P.y<0?Math.PI:0,a={x:this.position.x+Math.cos(this.body.angle)*y.position.x-Math.sin(this.body.angle)*y.position.y,y:this.position.y+Math.sin(this.body.angle)*y.position.x+Math.cos(this.body.angle)*y.position.y},i=40,s=this.body.angle+t+y.turretAngle,c=a.x+Math.cos(s)*i,l=a.y+Math.sin(s)*i;this.createCannonball(c,l,s)}})}createCannonball(d,y,P){this.game&&this.game.addCannonball?this.game.addCannonball(d,y,P,10):console.log(`Fired cannonball at (${d}, ${y}) with angle ${P}`)}takeDamage(d){this.health-=d,this.health<=0&&this.destroy()}setGame(d){this.game=d}applyWindForce(d,y){this.currentWindDirection=d,this.currentWindPower=y;let P=0,r=0,t=!1;this.sails.forEach(c=>{const l=c.openness;P+=l,r++,l>0&&(t=!0)});const a=r>0?P/r:0,i=Math.min(.05,this.momentum*.05),s=t?.85+a/100*.13+i:.85;if(D.Body.setVelocity(this.body,{x:this.body.velocity.x*s,y:this.body.velocity.y*s}),!t&&Math.abs(this.body.velocity.x)<.05&&Math.abs(this.body.velocity.y)<.05&&(D.Body.setVelocity(this.body,{x:0,y:0}),this.momentum=0),t){const c=this.calculateSailEfficiency(),l=d,h=Math.cos(l),o=Math.sin(l),e=Math.cos(this.body.angle),n=Math.sin(this.body.angle),f=Math.atan2(o*e-h*n,h*e+o*n),x=Math.max(.35,c);this.forwardForce=y*x*.024;const S=Math.abs(f)*180/Math.PI;let p=1;S<=90?p=1-.65*S/90:p=.35*Math.max(0,1-(S-90)/90),p=Math.max(.1,p);const v=c>0?this.forwardForce*p:0,m={x:e*v,y:n*v};D.Body.applyForce(this.body,this.body.position,m)}}adjustSails(d){this.sails.forEach(y=>{y.setOpenness(d)})}openSails(){this.sails.forEach(d=>{d.open(10)})}closeSails(){this.sails.forEach(d=>{d.close(10)})}isPositionOnDeck(d,y,P){const r=d-this.position.x,t=y-this.position.y,a=Math.cos(-this.body.angle),i=Math.sin(-this.body.angle),s=r*a-t*i,c=r*i+t*a;if(this.path&&P){if(!P.isPointInPath(this.path,s,c))return!1}else if(s<-345||s>415||c<-90||c>90)return!1;for(const n of L.MASTS){const f=s-n.x,u=c-n.y;if(f*f+u*u<n.r*n.r)return!1}const l=L.WHEEL.x,h=L.WHEEL.y,o=L.WHEEL.w,e=L.WHEEL.h;if(s>l-o/2&&s<l+o/2&&c>h-e/2&&c<h+e/2)return!1;for(const n of L.CANNONS)if(s>n.x-n.w/2&&s<n.x+n.w/2&&c>n.y-n.h/2&&c<n.y+n.h/2)return!1;for(const[n,f]of this.modules.entries()){if(f.type==="wheel"&&f.position.x===L.WHEEL.x&&f.position.y===L.WHEEL.y||f.type==="cannon"&&L.CANNONS.some(w=>w.x===f.position.x&&w.y===f.position.y))continue;const u=this.getModuleVisualPosition(n),x=20;if(s>u.x-x/2&&s<u.x+x/2&&c>u.y-x/2&&c<u.y+x/2)return!1}return!0}draw(d){d.save(),d.translate(this.position.x,this.position.y),d.rotate(this.body.angle),this.path||(this.path=L.createHullPath()),d.fillStyle="#D2B48C",d.strokeStyle="#8B4513",d.lineWidth=10,d.fill(this.path),d.stroke(this.path);for(const y of L.CANNONS)this.drawCannon(d,y.x,y.y,y.y>0?0:Math.PI);for(const y of L.MASTS)this.drawMastAndSail(d,y.x,y.y,this.getSailOpennessAt(y.x,y.y));this.drawSteeringWheel(d,L.WHEEL.x,L.WHEEL.y),d.restore()}drawDebugCollision(d){}drawDebugCollisionBox(d){}drawMastAndSail(d,y,P,r){let t=0;for(const[a,i]of this.sails.entries()){const s=this.getModuleVisualPosition(a);if(s.x===y&&s.y===P){t=i.angle;break}}if(t===0){for(const[a,i]of this.modules.entries())if(!(i instanceof K)&&i.type==="sail"){const s=this.getModuleVisualPosition(a);if(s.x===y&&s.y===P){t=i.angle||0;break}}}if(d.save(),d.translate(y,P),d.beginPath(),d.arc(0,0,15,0,Math.PI*2),d.fillStyle="#D2B48C",d.strokeStyle="#8B4513",d.lineWidth=4,d.fill(),d.stroke(),r>0){d.save(),d.rotate(t*Math.PI/180),d.beginPath(),d.moveTo(0,130);const a=10+r*90;d.quadraticCurveTo(a,0,0,-130),d.closePath();let i=.35;const s=this.currentWindDirection,l=this.body.angle+t*Math.PI/180+Math.PI/2,h=Math.cos(l),o=Math.sin(l),e=Math.cos(s),n=Math.sin(s),f=e*h+n*o,u=Math.acos(Math.min(1,Math.max(-1,f)))*180/Math.PI;u<=90&&(i=1-.65*u/90);const x=Math.floor(255*(1-i)),w=Math.floor(255*i),S=Math.floor(255*.8),p=`rgba(${x}, ${w}, ${S}, 0.8)`,v=d.createLinearGradient(-a/2,0,a/2,0);v.addColorStop(0,"white"),v.addColorStop(.5,p),v.addColorStop(1,"white"),d.fillStyle=v,d.strokeStyle="#000000",d.lineWidth=2,d.fill(),d.stroke(),d.strokeStyle="rgba(255, 255, 255, 0.8)",d.lineWidth=1.5;for(let m=1;m<=4;m++){const g=m/5;d.beginPath();const M=130-260*g;d.moveTo(0,M);const A=a*(1-g*.5);d.quadraticCurveTo(A,0,0,-M),d.stroke()}d.restore()}d.restore()}drawSteeringWheel(d,y,P){d.save(),d.translate(y,P);const r=new Path2D;r.moveTo(-10,-20),r.lineTo(10,-20),r.lineTo(10,20),r.lineTo(-10,20),r.closePath(),d.fillStyle="#8B4513",d.fill(r),d.beginPath(),d.arc(0,0,15,0,Math.PI*2),d.fillStyle="#654321",d.fill(),d.restore()}drawCannon(d,y,P,r){d.save(),d.translate(y,P),d.rotate(r);let t=0;for(const[a,i]of this.cannons.entries()){const s=this.getModuleVisualPosition(a);if(s.x===y&&s.y===P){t=i.turretAngle;break}}if(t===0){for(const[a,i]of this.modules.entries())if(!(i instanceof J)&&i.type==="cannon"){const s=this.getModuleVisualPosition(a);if(s.x===y&&s.y===P){t=i.turretAngle||0;break}}}d.fillStyle="#8B4513",d.strokeStyle="#000000",d.lineWidth=2,d.fillRect(-15,-10,30,20),d.strokeRect(-15,-10,30,20),d.fillStyle="#654321",d.beginPath(),d.arc(-10,10,5,0,Math.PI*2),d.fill(),d.beginPath(),d.arc(10,10,5,0,Math.PI*2),d.fill(),d.save(),d.rotate(t),d.fillStyle="#333333",d.beginPath(),d.moveTo(-8,0),d.lineTo(-8,-40),d.lineTo(8,-40),d.lineTo(8,0),d.closePath(),d.fill(),d.restore(),d.restore()}testWalkableArea(d,y){d.save(),d.translate(this.position.x,this.position.y),d.rotate(this.body.angle);const P=this.size.width*1.1,r=this.size.height*1.1;this.path||(this.path=L.createHullPath()),d.fillStyle="rgba(200, 200, 255, 0.15)",d.fill(this.path),d.strokeStyle="rgba(255, 255, 255, 0.8)",d.lineWidth=3,d.stroke(this.path),d.strokeStyle="rgba(255, 255, 0, 0.4)",d.lineWidth=1,d.strokeRect(-this.size.width/2,-this.size.height/2,this.size.width,this.size.height);const t=P/2,a=r/2,i=Math.max(2,y/4);for(let o=-t;o<=t;o+=y)for(let e=-a;e<=a;e+=y){const n=this.position.x+o*Math.cos(this.body.angle)-e*Math.sin(this.body.angle),f=this.position.y+o*Math.sin(this.body.angle)+e*Math.cos(this.body.angle),u=d.isPointInPath(this.path,o,e),x=this.isPositionOnDeck(n,f,d);x?d.fillStyle="rgba(0, 220, 0, 0.85)":u?d.fillStyle="rgba(255, 0, 0, 0.85)":d.fillStyle="rgba(0, 0, 255, 0.05)",d.beginPath(),d.arc(o,e,i,0,Math.PI*2),d.fill(),x&&(d.strokeStyle="rgba(0, 100, 0, 0.8)",d.lineWidth=1,d.stroke())}d.fillStyle="rgba(139, 69, 19, 0.7)";for(const o of L.MASTS)d.beginPath(),d.arc(o.x,o.y,o.r,0,Math.PI*2),d.fill(),d.fillStyle="white",d.font="12px Arial",d.fillText("Mast",o.x-15,o.y),d.fillStyle="rgba(139, 69, 19, 0.7)";const s=L.WHEEL.x,c=L.WHEEL.y,l=L.WHEEL.w,h=L.WHEEL.h;d.fillStyle="rgba(255, 215, 0, 0.7)",d.fillRect(s-l/2,c-h/2,l,h),d.fillStyle="white",d.font="12px Arial",d.fillText("Wheel",s-20,c),d.fillStyle="rgba(169, 169, 169, 0.7)";for(const o of L.CANNONS)d.fillRect(o.x-o.w/2,o.y-o.h/2,o.w,o.h);this.modules.forEach((o,e)=>{if(!(o.type==="wheel"&&o.position.x===L.WHEEL.x&&o.position.y===L.WHEEL.y||o.type==="cannon"&&L.CANNONS.some(f=>f.x===o.position.x&&f.y===o.position.y))){d.fillStyle="rgba(255, 0, 255, 0.7)";const f=20,u=this.getModuleVisualPosition(e);d.fillRect(u.x-f/2,u.y-f/2,f,f),d.fillStyle="white",d.font="10px Arial",d.fillText(o.type,u.x-15,u.y)}}),d.restore()}findSafeDismountPosition(d,y,P){if(this.isPositionOnDeck(d,y,P))return{x:d,y};const r=d-this.position.x,t=y-this.position.y,a=Math.cos(-this.body.angle),i=Math.sin(-this.body.angle),s=r*a-t*i,c=r*i+t*a,l=60,h=8,o=5;for(let e=1;e<=o;e++){const n=l*e/o;for(let f=0;f<h;f++){const u=f/h*Math.PI*2,x=s+Math.cos(u)*n,w=c+Math.sin(u)*n,S=this.position.x+x*Math.cos(this.body.angle)-w*Math.sin(this.body.angle),p=this.position.y+x*Math.sin(this.body.angle)+w*Math.cos(this.body.angle);if(this.isPositionOnDeck(S,p,P))return{x:S,y:p}}}return{x:this.position.x,y:this.position.y}}getSailOpennessAt(d,y){for(const[P,r]of this.sails.entries()){const t=this.getModuleVisualPosition(P);if(t.x===d&&t.y===y)return r.openness/100}for(const[P,r]of this.modules.entries())if(!(r instanceof K)&&r.type==="sail"){const t=this.getModuleVisualPosition(P);if(t.x===d&&t.y===y)return(r.openness||0)/100}return 0}destroy(){this.cannons.forEach(d=>{d.onDestroy()}),this.sails.forEach(d=>{d.onDestroy()}),this.wheels.forEach(d=>{d.onDestroy()}),this.modules.forEach(d=>{d instanceof Q||d.update()}),this.cannons.clear(),this.sails.clear(),this.wheels.clear(),this.modules.clear(),this.body&&this.game&&typeof this.game.removeBody=="function"&&this.game.removeBody(this.body),this.health=0}togglePlayerAtWheel(d){this.playerAtWheel=d}setPlayerOnBoard(d,y=!1){this.playerAtWheel=y,d?D.Body.set(this.body,{collisionFilter:{...this.body.collisionFilter,group:-1}}):(D.Body.set(this.body,{collisionFilter:{...this.body.collisionFilter,group:0}}),this.playerAtWheel=!1)}update(){D.Body.setVelocity(this.body,{x:this.body.velocity.x*.85,y:this.body.velocity.y*.85}),Math.abs(this.body.velocity.x)<.005&&Math.abs(this.body.velocity.y)<.005&&(D.Body.setVelocity(this.body,{x:0,y:0}),this.momentum=0),this.updateWaterLevel(),this.updateModules()}};b(L,"HULL_POINTS",{bow:{x:190,y:90},bowTip:{x:415,y:0},bowBottom:{x:190,y:-90},sternBottom:{x:-260,y:-90},sternTip:{x:-345,y:0},stern:{x:-260,y:90}}),b(L,"MASTS",[{x:165,y:0,r:30},{x:-35,y:0,r:30},{x:-235,y:0,r:30}]),b(L,"WHEEL",{x:-90,y:0,w:20,h:40}),b(L,"CANNONS",[{x:-35,y:75,w:30,h:30},{x:65,y:75,w:30,h:30},{x:-135,y:75,w:30,h:30},{x:-35,y:-75,w:30,h:30},{x:65,y:-75,w:30,h:30},{x:-135,y:-75,w:30,h:30}]);let j=L;class ut{constructor(d,y,P,r,t){b(this,"position");b(this,"health");b(this,"speed");b(this,"aiBehavior");b(this,"body");this.position={x:d,y},this.health=P,this.speed=r,this.aiBehavior=t,this.body=D.Bodies.circle(d,y,15,{label:"enemy",density:.002,frictionAir:.05})}moveTowards(d,y){const P=d-this.position.x,r=y-this.position.y,t=Math.sqrt(P*P+r*r);if(t>0){const a=P/t,i=r/t;this.position.x+=a*this.speed,this.position.y+=i*this.speed,D.Body.setPosition(this.body,{x:this.position.x,y:this.position.y})}}attack(){}takeDamage(d){this.health-=d,this.health<=0&&this.die()}die(){}}class dt{constructor(){b(this,"engine");b(this,"world");b(this,"windDirection",0);b(this,"windPower",1);b(this,"islands",[]);b(this,"boundaries",[]);b(this,"windSystemStartTime",Date.now());this.engine=D.Engine.create(),this.world=this.engine.world,this.setupWorld()}setupWorld(){this.setupBoundaries(),this.generateIslands(5),this.setupWind()}setupBoundaries(){const P=D.Bodies.rectangle(2500,-25,5e3,50,{isStatic:!0}),r=D.Bodies.rectangle(5e3/2,5e3+50/2,5e3,50,{isStatic:!0}),t=D.Bodies.rectangle(-50/2,5e3/2,50,5e3,{isStatic:!0}),a=D.Bodies.rectangle(5e3+50/2,5e3/2,50,5e3,{isStatic:!0});this.boundaries=[P,r,t,a],D.World.add(this.world,this.boundaries)}generateIslands(d){for(let P=0;P<d;P++){const r={width:200+Math.random()*400,height:200+Math.random()*400},t={x:500+Math.random()*(5e3-1e3),y:500+Math.random()*(5e3-1e3)},a=D.Bodies.rectangle(t.x,t.y,r.width,r.height,{isStatic:!0,label:"island"});this.islands.push({position:t,size:r,body:a}),D.World.add(this.world,a)}}setupWind(){this.windDirection=Math.random()*Math.PI*2,this.windPower=1,this.windSystemStartTime=Date.now()}updateWind(){const y=Date.now()-this.windSystemStartTime,P=5*60*1e3,r=y%P/P;for(this.windDirection=r*Math.PI*2;this.windDirection<0;)this.windDirection+=Math.PI*2;for(;this.windDirection>=Math.PI*2;)this.windDirection-=Math.PI*2;const a=1-Math.min(Math.abs(this.windDirection%Math.PI),Math.abs((this.windDirection-Math.PI)%Math.PI))/(Math.PI/2),i=1.5;this.windPower=i+a*(2-i),this.windPower+=(Math.random()-.5)*.1,this.windPower<1.5&&(this.windPower=1.5),this.windPower>2&&(this.windPower=2)}getWindDirection(){return this.windDirection}getWindPower(){return this.windPower}update(){D.Engine.update(this.engine),this.updateWind()}addEntity(d){D.World.add(this.world,d)}removeEntity(d){D.World.remove(this.world,d)}getEngine(){return this.engine}getIslands(){return this.islands}}class pt{constructor(d,y,P,r=10){b(this,"position");b(this,"velocity");b(this,"angle");b(this,"radius");b(this,"body");b(this,"lifetime");b(this,"maxLifetime");b(this,"damage");this.position={x:d,y},this.angle=P,this.radius=5,this.damage=10,this.velocity={x:Math.cos(P)*r,y:Math.sin(P)*r},this.body=D.Bodies.circle(d,y,this.radius,{label:"cannonball",frictionAir:.001,friction:.1,restitution:.6,density:.1,collisionFilter:{category:8,mask:7}}),D.Body.setVelocity(this.body,this.velocity),this.lifetime=0,this.maxLifetime=180}update(){return this.position.x=this.body.position.x,this.position.y=this.body.position.y,this.lifetime++,this.lifetime<this.maxLifetime}draw(d){d.save(),d.fillStyle="#333333",d.beginPath(),d.arc(this.position.x,this.position.y,this.radius,0,Math.PI*2),d.fill(),d.fillStyle="rgba(0, 0, 0, 0.3)",d.beginPath(),d.arc(this.position.x+2,this.position.y+2,this.radius,0,Math.PI*2),d.fill(),d.restore()}handleCollision(d){d.health!==void 0&&d.takeDamage(this.damage)}}class yt{constructor(d){b(this,"engine");b(this,"player");b(this,"ship");b(this,"enemies",[]);b(this,"world");b(this,"canvas");b(this,"ctx");b(this,"keysPressed",new Set);b(this,"playerOnShip",!1);b(this,"mousePosition",{x:0,y:0});b(this,"screenMousePosition",{x:0,y:0});b(this,"cannonballs",[]);b(this,"debugMode",!1);b(this,"showWalkableTest",!1);b(this,"viewport",{x:0,y:0,width:window.innerWidth,height:window.innerHeight,scale:1});this.engine=d,this.canvas=document.getElementById("game-canvas"),this.ctx=this.canvas.getContext("2d"),this.debugMode=!1,this.viewport.width=this.canvas.width,this.viewport.height=this.canvas.height,this.world=new dt,this.player=new ct(400,300),this.player.setOnShip(this.playerOnShip),this.ship=new j(400,350,450,180,1),this.ship.setGame(this),this.addInitialShipModules(),this.setupInputHandlers()}updateViewportDimensions(d,y){this.viewport.width=d,this.viewport.height=y}addInitialShipModules(){this.ship.addModule("wheel",{type:"wheel",position:{x:-50,y:0},rotation:0,health:100,update(){},use(){}}),this.ship.addModule("sail1",{type:"sail",position:{x:165,y:0},rotation:0,health:100,openness:0,angle:0,update(){},use(){}}),this.ship.addModule("sail2",{type:"sail",position:{x:-35,y:0},rotation:0,health:100,openness:0,angle:0,update(){},use(){}}),this.ship.addModule("sail3",{type:"sail",position:{x:-235,y:0},rotation:0,health:100,openness:0,angle:0,update(){},use(){}}),this.ship.addModule("cannon1",{type:"cannon",position:{x:-35,y:75},rotation:0,health:100,update(){},use(){}}),this.ship.addModule("cannon2",{type:"cannon",position:{x:65,y:75},rotation:0,health:100,update(){},use(){}}),this.ship.addModule("cannon3",{type:"cannon",position:{x:-135,y:75},rotation:0,health:100,update(){},use(){}}),this.ship.addModule("cannon4",{type:"cannon",position:{x:-35,y:-75},rotation:Math.PI,health:100,update(){},use(){}}),this.ship.addModule("cannon5",{type:"cannon",position:{x:65,y:-75},rotation:Math.PI,health:100,update(){},use(){}}),this.ship.addModule("cannon6",{type:"cannon",position:{x:-135,y:-75},rotation:Math.PI,health:100,update(){},use(){}})}setupInputHandlers(){document.addEventListener("keydown",d=>{this.keysPressed.add(d.key.toLowerCase())}),document.addEventListener("keyup",d=>{this.keysPressed.delete(d.key.toLowerCase())}),this.canvas.addEventListener("mousemove",d=>{const y=this.canvas.getBoundingClientRect(),P=d.clientX-y.left,r=d.clientY-y.top;this.screenMousePosition={x:P,y:r},this.mousePosition=this.screenToWorldCoordinates(P,r),this.playerOnShip&&this.updateCannonAiming()}),this.canvas.addEventListener("mousedown",d=>{this.playerOnShip&&d.button===0&&(this.ship.fireCannon(this.mousePosition),d.preventDefault())}),this.canvas.addEventListener("contextmenu",d=>{d.preventDefault(),this.playerOnShip&&this.updateCannonAiming()}),this.canvas.addEventListener("wheel",d=>{d.preventDefault();const y=d.deltaY>0?.9:1.1,P=Math.max(.5,Math.min(2,this.viewport.scale*y));P!==this.viewport.scale&&(this.viewport.scale=P,this.mousePosition=this.screenToWorldCoordinates(this.screenMousePosition.x,this.screenMousePosition.y))},{passive:!1}),document.addEventListener("keypress",d=>{d.key.toLowerCase()==="f"?this.togglePlayerOnShip():d.key.toLowerCase()==="e"?this.togglePlayerAtWheel():d.key.toLowerCase()==="l"?this.debugMode=!this.debugMode:d.key.toLowerCase()==="g"&&(this.showWalkableTest=!this.showWalkableTest)})}screenToWorldCoordinates(d,y){return{x:this.viewport.x+(d-this.viewport.width/2)/this.viewport.scale,y:this.viewport.y+(y-this.viewport.height/2)/this.viewport.scale}}worldToShipCoordinates(d,y){const P=d-this.ship.position.x,r=y-this.ship.position.y,t=-this.ship.body.angle,a=P*Math.cos(t)-r*Math.sin(t),i=P*Math.sin(t)+r*Math.cos(t);return{x:a,y:i}}shipToWorldCoordinates(d,y){const P=this.ship.body.angle,r=this.ship.position.x+d*Math.cos(P)-y*Math.sin(P),t=this.ship.position.y+d*Math.sin(P)+y*Math.cos(P);return{x:r,y:t}}togglePlayerOnShip(){const d=this.player.position.x-this.ship.position.x,y=this.player.position.y-this.ship.position.y,P=Math.sqrt(d*d+y*y);if(this.playerOnShip){this.playerOnShip=!1,this.player.setOnShip(!1,!1),this.ship.setPlayerOnBoard(!1,!1);const r=this.worldToShipCoordinates(this.player.position.x,this.player.position.y),t=Math.sqrt(r.x*r.x+r.y*r.y),a=t>0?r.x/t:1,i=t>0?r.y/t:0,s=this.ship.size.width,c=this.ship.size.height,l=Math.max(s,c)*.75,h=this.ship.position.x+a*l,o=this.ship.position.y+i*l;this.player.position.x=h,this.player.position.y=o,D.Body.setPosition(this.player.body,{x:h,y:o}),D.Body.set(this.player.body,{collisionFilter:{...this.player.body.collisionFilter,group:0}});return}if(P<200){this.playerOnShip=!0,this.player.setOnShip(!0,!1),this.ship.setPlayerOnBoard(!0,!1);const r=d/P,t=y/P,a=this.ship.size.width,i=this.ship.size.height,s=this.ship.position.x+r*(a/2*.8),c=this.ship.position.y+t*(i/2*.8),l=this.ship.findSafeDismountPosition(s,c);this.player.position.x=l.x,this.player.position.y=l.y,D.Body.setPosition(this.player.body,{x:this.player.position.x,y:this.player.position.y}),D.Body.set(this.player.body,{collisionFilter:{...this.player.body.collisionFilter,group:-1}})}}togglePlayerAtWheel(){if(!this.playerOnShip)return;const d=this.ship.position.x-90,y=this.ship.position.y,P=this.player.position.x-d,r=this.player.position.y-y,t=Math.sqrt(P*P+r*r);this.player.atShipWheel?(this.player.setAtShipWheel(!1),this.ship.togglePlayerAtWheel(!1)):t<50&&(this.player.setAtShipWheel(!0),this.ship.togglePlayerAtWheel(!0),this.player.position.x=d,this.player.position.y=y,D.Body.setPosition(this.player.body,{x:this.player.position.x,y:this.player.position.y}))}start(){this.setupWorld();const d=D.Runner.create();D.Runner.run(d,this.engine),this.gameLoop()}setupWorld(){D.Body.set(this.player.body,{collisionFilter:{category:2,mask:1}}),D.Body.set(this.ship.body,{collisionFilter:{category:4,mask:3}}),Z.World.add(this.engine.world,[this.player.body,this.ship.body]),this.spawnEnemies(3)}spawnEnemies(d){for(let y=0;y<d;y++){const P=500+Math.random()*1e3,r=500+Math.random()*1e3,t=new ut(P,r,100,.5,"aggressive");this.enemies.push(t),Z.World.add(this.engine.world,t.body)}}handlePlayerMovement(){if(this.playerOnShip)if(this.player.atShipWheel){this.keysPressed.has("w")&&!this.keysPressed.has("s")?(this.ship.openSails(),this.keysPressed.delete("w")):this.keysPressed.has("s")&&!this.keysPressed.has("w")&&(this.ship.closeSails(),this.keysPressed.delete("s")),this.keysPressed.has("a")&&!this.keysPressed.has("d")&&!this.keysPressed.has("shift")?this.ship.applyRudder("left"):this.keysPressed.has("d")&&!this.keysPressed.has("a")&&!this.keysPressed.has("shift")?this.ship.applyRudder("right"):!this.keysPressed.has("a")&&!this.keysPressed.has("d")&&this.ship.applyRudder("center"),this.keysPressed.has("shift")&&(this.keysPressed.has("a")&&!this.keysPressed.has("d")?this.ship.rotateSails("left"):this.keysPressed.has("d")&&!this.keysPressed.has("a")&&this.ship.rotateSails("right"));const y=this.shipToWorldCoordinates(-90,0),P=y.x,r=y.y;this.player.position.x=P,this.player.position.y=r,D.Body.setPosition(this.player.body,{x:P,y:r}),D.Body.setVelocity(this.player.body,{x:this.ship.body.velocity.x,y:this.ship.body.velocity.y}),this.player.body.isSensor||D.Body.set(this.player.body,"isSensor",!0)}else{const y=this.mousePosition.x-this.player.position.x,P=this.mousePosition.y-this.player.position.y,r=Math.atan2(P,y);let t=0,a=0;if(this.keysPressed.has("w")&&(t+=Math.cos(r)*5,a+=Math.sin(r)*5),this.keysPressed.has("s")&&(t-=Math.cos(r)*5,a-=Math.sin(r)*5),this.keysPressed.has("a")&&(t+=Math.cos(r-Math.PI/2)*5,a+=Math.sin(r-Math.PI/2)*5),this.keysPressed.has("d")&&(t+=Math.cos(r+Math.PI/2)*5,a+=Math.sin(r+Math.PI/2)*5),t!==0||a!==0){const i=this.player.position.x+t,s=this.player.position.y+a;if(this.ship.isPositionOnDeck(i,s))this.player.position.x=i,this.player.position.y=s,D.Body.setPosition(this.player.body,{x:i,y:s});else{const c={x:this.player.position.x+t,y:this.player.position.y};this.ship.isPositionOnDeck(c.x,c.y)&&(this.player.position.x=c.x,D.Body.setPosition(this.player.body,{x:c.x,y:this.player.position.y}));const l={x:this.player.position.x,y:this.player.position.y+a};this.ship.isPositionOnDeck(l.x,l.y)&&(this.player.position.y=l.y,D.Body.setPosition(this.player.body,{x:this.player.position.x,y:l.y}))}this.player.body.isSensor&&D.Body.set(this.player.body,"isSensor",!1)}D.Body.setVelocity(this.player.body,{x:this.ship.body.velocity.x,y:this.ship.body.velocity.y})}else{const y=this.mousePosition.x-this.player.position.x,P=this.mousePosition.y-this.player.position.y,r=Math.atan2(P,y);let t=0,a=0;this.keysPressed.has("w")&&(t+=Math.cos(r)*5,a+=Math.sin(r)*5),this.keysPressed.has("s")&&(t-=Math.cos(r)*5,a-=Math.sin(r)*5),this.keysPressed.has("a")&&(t+=Math.cos(r-Math.PI/2)*5,a+=Math.sin(r-Math.PI/2)*5),this.keysPressed.has("d")&&(t+=Math.cos(r+Math.PI/2)*5,a+=Math.sin(r+Math.PI/2)*5),this.player.position.x+=t,this.player.position.y+=a,D.Body.setPosition(this.player.body,{x:this.player.position.x,y:this.player.position.y}),this.player.body.isSensor&&D.Body.set(this.player.body,"isSensor",!1)}this.playerOnShip&&this.keysPressed.has(" ")&&(this.ship.fireCannon(),this.keysPressed.delete(" "))}updateCamera(){this.viewport.x=this.player.position.x,this.viewport.y=this.player.position.y}render2D(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.save(),this.ctx.fillStyle="#87CEEB",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);const d=this.viewport.width/2,y=this.viewport.height/2;this.ctx.translate(d,y),this.ctx.scale(this.viewport.scale,this.viewport.scale),this.ctx.translate(-this.viewport.x,-this.viewport.y),this.ctx.fillStyle="#87CEEB";const P=this.viewport.width/this.viewport.scale,r=this.viewport.height/this.viewport.scale;if(this.ctx.fillRect(this.viewport.x-P,this.viewport.y-r,P*3,r*3),this.drawGrid(),this.ship.draw(this.ctx),this.ctx.fillStyle="#ffcc00",this.ctx.beginPath(),this.ctx.arc(this.player.position.x,this.player.position.y,15,0,Math.PI*2),this.ctx.fill(),!this.playerOnShip){const t=this.mousePosition.x-this.player.position.x,a=this.mousePosition.y-this.player.position.y,i=Math.atan2(a,t);this.ctx.strokeStyle="#ffffff",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(this.player.position.x,this.player.position.y),this.ctx.lineTo(this.player.position.x+Math.cos(i)*20,this.player.position.y+Math.sin(i)*20),this.ctx.stroke()}this.ctx.fillStyle="#ff3300";for(const t of this.enemies)this.ctx.beginPath(),this.ctx.arc(t.position.x,t.position.y,15,0,Math.PI*2),this.ctx.fill();this.debugMode&&(this.drawDebugShapes(),this.ship.testWalkableArea(this.ctx,15)),this.showWalkableTest&&!this.debugMode&&this.ship.testWalkableArea(this.ctx,20),this.ctx.restore(),this.drawHUD(),this.drawCannonballs()}drawHUD(){this.ctx.fillStyle="#333",this.ctx.fillRect(20,20,200,20),this.ctx.fillStyle="#00cc00",this.ctx.fillRect(20,20,this.player.health*2,20),this.ctx.strokeStyle="#fff",this.ctx.strokeRect(20,20,200,20),this.playerOnShip&&(this.ctx.fillStyle="#333",this.ctx.fillRect(20,50,200,20),this.ctx.fillStyle="#33ccff",this.ctx.fillRect(20,50,this.ship.waterLevel*2,20),this.ctx.strokeStyle="#fff",this.ctx.strokeRect(20,50,200,20)),this.ctx.fillStyle="rgba(0, 0, 0, 0.5)",this.ctx.fillRect(20,this.playerOnShip?80:50,200,30),this.ctx.fillStyle="#ffffff",this.ctx.font="12px Arial";const d=Math.round(this.player.position.x),y=Math.round(this.player.position.y);let P="";if(this.playerOnShip&&(P=this.player.atShipWheel?" (At Wheel)":" (On Deck)"),this.ctx.fillText(`Coordinates: X: ${d} Y: ${y}${P}`,30,this.playerOnShip?100:70),this.debugMode&&this.playerOnShip){const h=this.ship.isPositionOnDeck(this.player.position.x,this.player.position.y);this.ctx.fillStyle=h?"#80ff80":"#ff8080",this.ctx.fillText(`On Deck: ${h?"YES":"NO"}`,150,this.playerOnShip?100:70),this.ctx.fillStyle="#ffffff"}this.ctx.strokeStyle="#fff",this.ctx.strokeRect(20,this.playerOnShip?80:50,200,30);const r=this.playerOnShip?120:90;if(this.ctx.fillStyle="rgba(0, 0, 0, 0.5)",this.ctx.fillRect(20,r,200,30),this.ctx.fillStyle="#ffffff",this.ctx.fillText(`Zoom: ${this.viewport.scale.toFixed(2)}x`,30,r+20),this.ctx.strokeStyle="#fff",this.ctx.strokeRect(20,r,200,30),this.playerOnShip){const h=r+40;let o=0,e=0,n=0;this.ship.modules.forEach(S=>{if(S.type==="sail"){if(S instanceof K)o+=S.openness,e+=S.angle;else{const p=S;o+=p.openness!==void 0?p.openness:0,e+=p.angle!==void 0?p.angle:0}n++}});const f=n>0?Math.round(o/n):0,u=n>0?Math.round(e/n):0;if(this.ctx.fillStyle="rgba(0, 0, 0, 0.5)",this.ctx.fillRect(20,h,200,80),this.ctx.fillStyle="#333",this.ctx.fillRect(30,h+15,180,10),this.ctx.fillStyle="#ffffff",this.ctx.fillRect(30,h+15,f*1.8,10),this.ctx.fillStyle="#ffffff",this.ctx.fillText(`Sails: ${f}% open (W/S to adjust)`,30,h+12),this.ctx.fillStyle="#ffffff",this.ctx.fillText(`Sail angle: ${u}° (Shift+A/D to rotate)`,30,h+35),this.ctx.fillText(`Rudder: ${Math.round(this.ship.rudderAngle)}° (A/D to steer)`,30,h+55),Array.from(this.ship.modules.values()).filter(S=>S.type==="sail").length>0){const S=this.ship.calculateSailEfficiency();S===0?(this.ctx.fillStyle="#ff5555",this.ctx.fillText("Wind power: 0% (Bad sail angle)",30,h+75)):(S>.7?this.ctx.fillStyle="#80ff80":S>.4?this.ctx.fillStyle="#ccff00":S>.2?this.ctx.fillStyle="#ffcc00":this.ctx.fillStyle="#ff8080",this.ctx.fillText(`Wind power: ${Math.round(S*100)}%`,30,h+75))}f===0&&(this.ctx.fillStyle="#ffcc00",this.ctx.fillText("(Ship won't move with closed sails)",30,h+75));const w=Math.max(30,100-this.ship.momentum*70);this.ctx.fillStyle=w>60?"#80ff80":w>40?"#ffcc00":"#ff8080",this.ctx.fillText(`Turning power: ${Math.floor(w)}% | Ship always moves forward when sails are open`,30,h+95),this.ctx.strokeStyle="#fff",this.ctx.strokeRect(20,h,200,100)}const t=this.world.getWindDirection(),a=this.world.getWindPower();this.ctx.save(),this.ctx.translate(this.canvas.width-80,80),this.ctx.fillStyle="rgba(0, 0, 0, 0.5)",this.ctx.beginPath(),this.ctx.arc(0,0,40,0,Math.PI*2),this.ctx.fill(),this.ctx.font="10px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillStyle="#ffffff",this.ctx.fillText("Wind From",0,-50),this.ctx.strokeStyle="rgba(255, 255, 255, 0.5)",this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.arc(0,0,35,0,Math.PI*2),this.ctx.stroke(),this.ctx.font="12px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillStyle="#ffffff",this.ctx.fillText("N",0,-30),this.ctx.fillText("E",30,0),this.ctx.fillText("S",0,30),this.ctx.fillText("W",-30,0),this.ctx.rotate(t);const i=20+10*a,s=this.ctx.createLinearGradient(0,i,0,-i);s.addColorStop(0,"#00ccff"),s.addColorStop(1,"#0066cc"),this.ctx.lineWidth=3,this.ctx.strokeStyle=s,this.ctx.fillStyle=s,this.ctx.beginPath(),this.ctx.moveTo(0,i),this.ctx.lineTo(0,-i),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(0,-i),this.ctx.lineTo(-8,-i+10),this.ctx.lineTo(8,-i+10),this.ctx.closePath(),this.ctx.fill(),this.ctx.save(),this.ctx.rotate(-t),this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillStyle="#ffffff",this.ctx.font="10px Arial";const c=Math.round(a*10);if(this.ctx.fillText(`${c}/10`,0,0),this.ctx.restore(),this.ctx.restore(),this.debugMode){const h=this.canvas.height-80;this.ctx.fillStyle="rgba(255, 0, 0, 0.7)",this.ctx.fillRect(20,h,160,30),this.ctx.fillStyle="#ffffff",this.ctx.font="12px Arial",this.ctx.fillText("DEBUG MODE: Press L to toggle",30,h+20)}const l=this.canvas.height-40;this.ctx.fillStyle="rgba(0, 0, 0, 0.5)",this.ctx.fillRect(20,l,500,30),this.ctx.fillStyle="#ffffff",this.ctx.font="12px Arial",this.playerOnShip?this.player.atShipWheel?this.ctx.fillText("W/S: Open/Close Sails | A/D: Steer | Shift+A/D: Rotate Sails | E: Leave Wheel | F: Exit Ship | SPACE: Fire Cannons | L: Debug",30,l+20):this.ctx.fillText("WASD: Move on Deck | E: Use Wheel (when near) | F: Exit Ship | SPACE: Fire Cannons | L: Debug",30,l+20):this.ctx.fillText("WASD: Move (Relative to Mouse) | F: Board Ship | L: Toggle Debug Mode",30,l+20)}drawGrid(){const y="rgba(255, 255, 255, 0.2)",P=this.viewport.width/this.viewport.scale,r=this.viewport.height/this.viewport.scale,t=Math.floor((this.viewport.x-P)/100)*100,a=Math.floor((this.viewport.y-r)/100)*100,i=t+P*4,s=a+r*4;this.ctx.strokeStyle=y,this.ctx.lineWidth=1;for(let c=t;c<=i;c+=100)this.ctx.beginPath(),this.ctx.moveTo(c,a),this.ctx.lineTo(c,s),this.ctx.stroke(),c%500===0&&(this.ctx.fillStyle=y,this.ctx.font="10px Arial",this.ctx.textAlign="center",this.ctx.fillText(c.toString(),c,a+15));0>=t&&0<=i&&(this.ctx.strokeStyle="rgba(255, 255, 255, 0.5)",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(0,a),this.ctx.lineTo(0,s),this.ctx.stroke(),this.ctx.strokeStyle=y,this.ctx.lineWidth=1);for(let c=a;c<=s;c+=100)this.ctx.beginPath(),this.ctx.moveTo(t,c),this.ctx.lineTo(i,c),this.ctx.stroke(),c%500===0&&(this.ctx.fillStyle=y,this.ctx.font="10px Arial",this.ctx.textAlign="left",this.ctx.fillText(c.toString(),t+5,c+15));0>=a&&0<=s&&(this.ctx.strokeStyle="rgba(255, 255, 255, 0.5)",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(t,0),this.ctx.lineTo(i,0),this.ctx.stroke(),this.ctx.strokeStyle=y,this.ctx.lineWidth=1)}drawDebugShapes(){this.ctx.lineWidth=2,this.ctx.strokeStyle="rgba(0, 255, 0, 0.7)",this.drawPhysicsBody(this.player.body),this.ctx.strokeStyle="rgba(255, 165, 0, 0.7)";for(const d of this.enemies)this.drawPhysicsBody(d.body);this.drawShipDeckArea(),this.drawWheelInteractionZone(),this.drawDebugInfo()}drawPhysicsBody(d){const y=d.vertices;if(!(!y||y.length===0)){this.ctx.beginPath(),this.ctx.moveTo(y[0].x,y[0].y);for(let P=1;P<y.length;P++)this.ctx.lineTo(y[P].x,y[P].y);this.ctx.lineTo(y[0].x,y[0].y),this.ctx.stroke(),this.ctx.fillStyle="rgba(255, 255, 255, 0.8)",this.ctx.beginPath(),this.ctx.arc(d.position.x,d.position.y,4,0,Math.PI*2),this.ctx.fill()}}drawShipDeckArea(){this.ctx.save(),this.ctx.translate(this.ship.position.x,this.ship.position.y),this.ctx.rotate(this.ship.body.angle),this.ship.path||(this.ship.path=j.createHullPath()),this.ctx.fillStyle="rgba(0, 100, 255, 0.1)",this.ctx.fill(this.ship.path),this.ctx.strokeStyle="rgba(255, 255, 255, 0.3)",this.ctx.lineWidth=1,this.ctx.stroke(this.ship.path),this.ctx.restore()}drawWheelInteractionZone(){this.ctx.save(),this.ctx.translate(this.ship.position.x,this.ship.position.y),this.ctx.rotate(this.ship.body.angle);const d=[{x:165,y:0,name:"Front Mast"},{x:-35,y:0,name:"Middle Mast"},{x:-235,y:0,name:"Back Mast"},{x:-90,y:0,name:"Wheel"}],P=.15*(this.ship.size.width/2*.95);for(const r of d)r.name==="Wheel"?(this.ctx.fillStyle="rgba(255, 255, 0, 0.2)",this.ctx.strokeStyle="rgba(255, 255, 0, 0.7)"):(this.ctx.fillStyle="rgba(139, 69, 19, 0.2)",this.ctx.strokeStyle="rgba(139, 69, 19, 0.7)"),this.ctx.beginPath(),this.ctx.arc(r.x,r.y,P,0,Math.PI*2),this.ctx.fill(),this.ctx.stroke(),r.name==="Wheel"&&(this.ctx.strokeStyle="rgba(255, 255, 0, 0.7)",this.ctx.setLineDash([5,5]),this.ctx.beginPath(),this.ctx.arc(r.x,r.y,50,0,Math.PI*2),this.ctx.stroke(),this.ctx.setLineDash([]),this.ctx.font="12px Arial",this.ctx.fillStyle="white",this.ctx.fillText("Wheel",r.x-15,r.y-20));this.ctx.restore()}drawDebugInfo(){this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(10,10,300,60),this.ctx.fillStyle="#ffffff",this.ctx.font="12px monospace",this.ctx.fillText(`Ship Position: ${Math.round(this.ship.position.x)}, ${Math.round(this.ship.position.y)}`,20,30);const d=this.shipToWorldCoordinates(-90,0);this.ctx.fillText(`Wheel Position: ${Math.round(d.x)}, ${Math.round(d.y)}`,20,50),this.ctx.restore()}updateCannonAiming(){if(!this.playerOnShip)return;const d=Array.from(this.ship.modules.values()).filter(P=>P.type==="cannon"),y=this.worldToShipCoordinates(this.mousePosition.x,this.mousePosition.y);d.forEach(P=>{const r=y.x-P.position.x,t=y.y-P.position.y;let a=Math.atan2(t,r)-Math.PI/2,i=a-P.rotation;for(;i>Math.PI;)i-=Math.PI*2;for(;i<-Math.PI;)i+=Math.PI*2;const s=Math.PI/4;if((i<-s||i>s)&&(i>=0?i=s:i=-s),a=i+Math.PI,P instanceof J)P.turretAngle=a;else{const c=P;c.turretAngle=a}})}addCannonball(d,y,P,r=10){const t=new pt(d,y,P,r);this.cannonballs.push(t),Z.World.add(this.engine.world,t.body)}updateCannonballs(){for(let d=this.cannonballs.length-1;d>=0;d--){const y=this.cannonballs[d];y.update()||(Z.World.remove(this.engine.world,y.body),this.cannonballs.splice(d,1))}}drawCannonballs(){for(const d of this.cannonballs)d.draw(this.ctx)}gameLoop(){requestAnimationFrame(()=>{this.update(),this.render2D(),this.gameLoop()})}update(){this.world.update();let d={x:0,y:0},y=!1,P=!1;if(this.playerOnShip)if(this.player.atShipWheel)d.x=-90,d.y=0,P=!0;else{const r=this.worldToShipCoordinates(this.player.position.x,this.player.position.y);d.x=r.x,d.y=r.y,y=!0}if(this.ship.applyWindForce(this.world.getWindDirection(),this.world.getWindPower()),this.ship.update(),y||P){const r=this.shipToWorldCoordinates(d.x,d.y);if(P)this.player.position.x=r.x,this.player.position.y=r.y,D.Body.setPosition(this.player.body,{x:r.x,y:r.y});else if(this.ship.isPositionOnDeck(r.x,r.y))this.player.position.x=r.x,this.player.position.y=r.y,D.Body.setPosition(this.player.body,{x:r.x,y:r.y});else{const t=this.ship.findSafeDismountPosition(this.player.position.x,this.player.position.y);this.player.position.x=t.x,this.player.position.y=t.y,D.Body.setPosition(this.player.body,{x:t.x,y:t.y})}D.Body.setVelocity(this.player.body,{x:this.ship.body.velocity.x,y:this.ship.body.velocity.y})}this.handlePlayerMovement();for(const r of this.enemies)Math.random()<.01&&r.moveTowards(this.player.position.x,this.player.position.y);this.updateCamera(),(this.screenMousePosition.x!==0||this.screenMousePosition.y!==0)&&(this.mousePosition=this.screenToWorldCoordinates(this.screenMousePosition.x,this.screenMousePosition.y)),this.updateCannonballs()}}const q=document.getElementById("game-canvas");q.width=window.innerWidth;q.height=window.innerHeight;const gt=D.Engine.create({gravity:{x:0,y:0,scale:0}}),ot=new yt(gt);window.addEventListener("resize",()=>{q.width=window.innerWidth,q.height=window.innerHeight,ot.updateViewportDimensions(window.innerWidth,window.innerHeight)});ot.start();
//# sourceMappingURL=index-2fa2c02a.js.map
